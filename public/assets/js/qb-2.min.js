/*! qb 29-09-2019 */

function initializeJS(){function a(a,c){var d=$("#cicode_"+a).val();jQuery.ajax("/async/getComboItemDetails",{type:"POST",data:$("#comboBillEntry").serialize(),beforeSend:function(){""!==d&&($("#inameTd_"+a).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#qtyavaTd_"+a).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#mrpTd_"+a).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#grossAmountTd_"+a).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$(".grossAmount").html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$(".roundOff").html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$(".netPay").html('<img src="/assets/img/wait.gif" alt="Wait.." />'))},success:function(d){if("success"===d.status){var e=(roundOff=netPay=roundedNetPay=0,d.response.comboItemAvaQtys),f=d.response.comboItemMrps,g=d.response.comboItemDiscounts,h=d.response.comboItemNames,j=d.response.comboItemAmounts;for(i=0;i<6;i++)if(i in h&&""!==h[i])if($("#iname_"+i).val(h[i]),$("#inameTd_"+i).text(h[i]),$("#qtyava_"+i).val(e[i]),$("#qtyavaTd_"+i).html('<i class="fa fa-cubes" aria-hidden="true"></i> '+e[i]),$("#mrp_"+i).val(f[i]),$("#mrpTd_"+i).html('<i class="fa fa-inr" aria-hidden="true"></i> '+parseFloat(f[i]).toFixed(2)),$("#discount_"+i).val(g[i]),$("#grossAmountTd_"+i).html('<i class="fa fa-inr" aria-hidden="true"></i> '+parseFloat(j[i]).toFixed(2)),netPay+=parseFloat(j[i]),roundedNetPay=Math.round(netPay),roundOff=parseFloat(roundedNetPay)-netPay,$(".grossAmount").text(netPay.toFixed(2)),$(".roundOff").text(roundOff.toFixed(2)),$(".netPay").text(roundedNetPay.toFixed(2)),"fromQty"===c){var k=parseInt(a)+1;$("#cicode_"+k).focus()}else $("#qty_"+a).focus();else b(i)}},error:function(b){$("#inameTd_"+a).html(""),$("#qtyavaTd_"+a).html(""),$("#mrpTd_"+a).html(""),$("#grossAmountTd_"+a).html(""),alert("Item code not found in the Selected store.")}})}function b(a){$("#inameTd_"+a).text(""),$("#qtyavaTd_"+a).text(""),$("#mrpTd_"+a).text(""),$("#grossAmountTd_"+a).text(""),$("#iname_"+a).val(""),$("#qtyava_"+a).val(""),$("#mrp_"+a).val(""),$("#discount_"+a).val(""),$("#qty_"+a).val("")}function c(a,b){var c=a.itemName,d=0,e=a.lotNo,f=a.mrp,g=a.taxPercent,h=a.availableQty,i=$("#tBodyowItems tr").length,j=(a.upp,a.mOq),l=a.cno,m=a.hsnSacCode,n=a.discountAmount,o=(1*parseFloat(j)).toFixed(2),p=$("#customerType").val();if($("#editKey").length>0)var q=$("#editKey").val();else var q=0;if($("#dKey").length>0)var r=$("#dKey").val();else var r=1;if($("#paymentMethodWindow, #customerWindow, #owItemsTable, #saveWindow, #tFootowItems, #remarksWindow").show(),"b2c"===p?$("#siOtherInfoWindow").hide():"b2b"===p?$("#siOtherInfoWindow").show():$("#siOtherInfoWindow").hide(),$("#tr_"+b).length>0){var s=$("#tr_"+b+" .saleItemQty").val(),t=parseFloat(s)+parseFloat(o),u=$("#tr_"+b).attr("index");$("#tr_"+b+" .saleItemQty").val(t.toFixed(2)),k(u)}else{d=0==i?1:i+1;var v=taxableAmount=parseFloat(1*f).toFixed(2),w='<tr id="tr_'+b+'" class="bcRow" index="'+d+'">',x='<td align="right" style="vertical-align:middle;" class="itemSlno">'+d+"</td>",y='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemName][]" id="iname_'+d+'" class="saleItem noEnterKey" index="'+d+'"  value="'+c+'" style="width:190px;" readonly/></td>',z='<td style="vertical-align:middle;"><input type="text" class="form-control lotNo" name="itemDetails[lotNo][]" id="lotNo_'+d+'" index="'+d+'" value="'+e+'"  readonly />';z+=""!==l?'<span style="font-size:11px;text-align:center;font-weight:bold;color:#FC4445">CASE: '+l+"</span></td>":"</td>";var A='<td style="vertical-align:middle;"><input type="text" class="qtyAvailable text-right noEnterKey" name="itemDetails[itemAvailQty][]" id="qtyava_'+d+'" index="'+d+'" value="'+h+'"  readonly  size="10" /></td>',B='<td style="vertical-align:middle;"><input type="text" class="form-control saleItemQty noEnterKey" name="itemDetails[itemSoldQty][]" id="qty_'+d+'" index="'+d+'" value="'+o+'" style="text-align:right;font-weight:bold;font-size:14px;border:1px dashed;" /></td>',C='<td style="vertical-align:middle;"><input type="text" class="mrp text-right noEnterKey" name="itemDetails[itemRate][]" id="mrp_'+d+'" index="'+d+'" value="'+f+'" size="10"';0===parseInt(q)&&(C+=" readonly"),C+=" /></td>";var v='<td class="grossAmount" id="grossAmount_'+d+'" index="'+d+'" style="vertical-align:middle;text-align:right;">'+v+"</td>",D='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemDiscount][]" id="discount_'+d+'" size="10" class="saDiscount noEnterKey" index="'+d+'" value="'+n+'"';0===parseInt(r)&&(D+=" readonly"),D+=" /></td>";var E='<td class="taxableAmt text-right" id="taxableAmt_'+d+'" index="'+d+'" style="vertical-align:middle;text-align:right;">'+taxableAmount+"</td>",F='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemTaxPercent][]" id="saItemTax_'+d+'" size="10" class="form-control saItemTax noEnterKey"  index="'+d+'" value="'+g+'"  /></td>',G='<td style="vertical-align:middle;text-align:center;"><div class="btn-actions-group"><a class="btn btn-danger deleteOwItem" href="javascript:void(0)" title="Delete Row" id="delrow_'+b+'"><i class="fa fa-times"></i></a></div></td>',H='<input type="hidden" class="taxAmount" id="taxAmount_'+d+'" value="" />',I='<input type="hidden" class="itemType" id="itemType_'+d+'" value="" />',J='<input type="hidden" class="hsnSacCode" id="hsnSac_'+d+'" value="'+m+'" />',K=w+x+y+z+A+B+C+v+D+E+F+G+H+I+J+"</tr>";$("#tBodyowItems").append(K)}k(d)}function d(){var a=totalAmount=0;$(".saleItemQty").each(function(b,c){a+=returnNumber(parseFloat($(this).val()))}),$(".grossAmount").each(function(a,b){totalAmount+=returnNumber(parseFloat($(this).text()))}),a=a.toFixed(2),totalAmount=totalAmount.toFixed(2),$("#totalItems, #indentScannedQty").text(a),$("#grossAmount").text(totalAmount)}function e(a,b){var c=a.itemName,e=0,f=a.lotNo,g=a.mrp,h=(a.taxPercent,a.lc),i=(a.upp,a.mOq),j=(1*parseFloat(i)).toFixed(2);if($("#loc_"+h).length>0)var k=$("#loc_"+h).val();else var k="";var l=(a.availableQty,$("#tBodyowItems tr").length);if($("#customerWindow, #owItemsTable, #saveWindow, #tFootowItems").show(),$("#tr_"+b).length>0){var m=$("#tr_"+b).attr("index"),n=$("#tr_"+b+" .saleItemQty").val(),o=parseFloat(n)+parseFloat(j),p=parseFloat(parseFloat(o)*parseFloat(g)).toFixed(2);$("#tr_"+b+" .saleItemQty").val(o),$("#grossAmount_"+m).text(p)}else{e=0==l?1:l+1;var p=taxableAmount=parseFloat(g*i).toFixed(2),q='<tr id="tr_'+b+'" class="bcRow" index="'+e+'">',r='<td align="right" style="vertical-align:middle;" class="itemSlno">'+e+"</td>",s='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemName][]" id="iname_'+e+'" class="saleItem noEnterKey" index="'+e+'"  value="'+c+'" size="30" readonly/></td>',t='<td style="vertical-align:middle;"><input type="text" class="form-control lotNo" name="itemDetails[lotNo][]" id="lotNo_'+e+'" index="'+e+'" value="'+f+'"  readonly /></td>',u='<td style="vertical-align:middle;"><input type="text" class="form-control saleItemQty noEnterKey" name="itemDetails[itemSoldQty][]" id="qty_'+e+'" index="'+e+'" value="'+j+'" style="text-align:right;font-weight:bold;font-size:14px;border:1px dashed;" readonly="readonly" /></td>',v='<td style="vertical-align:middle;text-align:center;"><input type="text" class="mrp text-right noEnterKey" name="itemDetails[itemRate][]" id="mrp_'+e+'" index="'+e+'" value="'+g+'" size="10" /></td>',p='<td class="grossAmount" id="grossAmount_'+e+'" index="'+e+'" style="vertical-align:middle;text-align:right;">'+p+"</td>",w='<td style="vertical-align:middle;text-align:center;"><div class="btn-actions-group"><a class="btn btn-danger deleteOwItem" href="javascript:void(0)" title="Delete Row" id="delrow_'+b+'"><i class="fa fa-times"></i></a></div></td>',x='<input type="hidden" class="noEnterKey" name="itemDetails[barcode][]" id="barcode_'+e+'" index="'+e+'" value="'+b+'" size="13" />',y=q+r+s+t+u+v+p+w+x+"</tr>";$("#tBodyowItems").append(y)}$("#locationCode").val(k),d()}function f(a){var b=(totTaxAmount=0,roundedNetPay=netPay=0,parseFloat(returnNumber(jQuery("#qty_"+a).val()))),c=parseFloat(returnNumber(jQuery("#mrp_"+a).val())),d=parseFloat(returnNumber(jQuery("#saItemTax_"+a).val())),e=parseFloat(c*b).toFixed(2),f=(e*d/100).toFixed(2);$("#itemType_"+a).val();$("#taxAmount_"+a).val(f),$("#grossAmount_"+a).text(e),$("#saItemTax_"+a+' option[value="'+d+'"]').attr("selected","selected"),g()}function g(){var a=totTaxableAmount=totDiscount=totTaxAmount=0,b=(roundedNetPay=netPay=0,insuranceCharges=otherCharges=0),c=totTransferQty=0,d=$("#taxCalcOption").val();jQuery(".grossAmount").each(function(b,c){iTotal=returnNumber(parseFloat(jQuery(this).text())),a+=iTotal}),jQuery(".qtyAvailable").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),c+=iTotal}),jQuery(".saleItemQty").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totTransferQty+=iTotal}),"i"===d?totTaxAmount=0:jQuery(".taxAmount").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totTaxAmount+=iTotal}),$("#grossAmount").text(parseFloat(a).toFixed(2)),$("#gstAmount").text(parseFloat(totTaxAmount).toFixed(2)),$(".stAvaQty").text(parseFloat(c).toFixed(2)),$(".stTraQty").text(parseFloat(totTransferQty).toFixed(2)),netPay=parseFloat(a+totTaxAmount+b+insuranceCharges+otherCharges),roundedNetPay=Math.round(netPay),roundOff=(parseFloat(roundedNetPay)-netPay).toFixed(2),$("#roundOff").text(roundOff),$("#netPayTop").val(roundedNetPay.toFixed(2)),$("#netPayBottom").text(roundedNetPay.toFixed(2))}function h(a){var b=totalTaxAmount=finalAmount=0,c=roundedNetPay=0,d=parseFloat(returnNumber($("#inwRcvdQty_"+a).val())),e=parseFloat(returnNumber($("#inwFreeQty_"+a).val())),f=parseFloat(returnNumber($("#inwItemRate_"+a).val())),g=parseFloat(returnNumber($("#inwItemDiscount_"+a).val())),h=parseFloat(returnNumber($("#inwItemTax_"+a).val())),i=parseFloat(returnNumber($("#packed_"+a).val())),k=(d-e)*i,l=parseFloat(returnNumber(k*f)),m=parseFloat(returnNumber(l-g)),n=parseFloat(m*h/100).toFixed(2),o=returnNumber(parseFloat($("#packingCharges").val())),p=returnNumber(parseFloat($("#shippingCharges").val())),q=returnNumber(parseFloat($("#insuranceCharges").val())),r=returnNumber(parseFloat($("#otherCharges").val()));$("#inwBillQty_"+a).val(k),$("#inwItemGrossAmount_"+a).val(l),$("#inwItemAmount_"+a).val(m),$("#inwItemTaxAmt_"+a).val(n),jQuery(".inwItemAmount").each(function(a,c){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(b+=iTotal)}),jQuery(".inwItemTaxAmount").each(function(a,b){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(totalTaxAmount+=iTotal)}),c=parseFloat(b+totalTaxAmount)+parseFloat(o)+parseFloat(p)+parseFloat(q)+parseFloat(r),roundedNetPay=Math.round(c),finalAmount=c-parseFloat(roundedNetPay.toFixed(2)),$("#inwItemsTotal").text(b.toFixed(2)),$("#inwItemTaxAmount").text(totalTaxAmount.toFixed(2)),$("#roundOff").text(finalAmount.toFixed(2)),$("#inwNetPay").text(roundedNetPay),j()}function j(){jQuery(".inwTaxPercents").each(function(a,b){var c=$(this).val(),d=$(this).attr("id"),e=totalTaxable=0;if($("input[data-rate='"+c+"']").each(function(a,b){if(parseFloat(returnNumber($(this).val()))>0){var c=$(this).attr("id").split("_"),d=c[1],f=$("#inwItemAmount_"+d).val();totalTaxable=(parseFloat(totalTaxable)+parseFloat(f)).toFixed(2),e=(parseFloat(e)+parseFloat($(this).val())).toFixed(2)}}),$("#taxAmount_"+d).val(parseFloat(e).toFixed(2)),"inter"===$("#supplyType").val())$("#taxable_"+d+"_igst_value").text(parseFloat(e).toFixed(2)),$("#taxable_"+d+"_cgst_value").text(""),$("#taxable_"+d+"_sgst_value").text("");else{var f=parseFloat(e/2).toFixed(2);$("#taxable_"+d+"_cgst_value").text(f),$("#taxable_"+d+"_sgst_value").text(f),$("#taxable_"+d+"_igst_value").text("")}$("#taxable_"+d+"_amount").text(totalTaxable)})}function k(a){var b=(totTaxableAmount=totDiscount=totTaxAmount=0,roundedNetPay=netPay=0,parseFloat(returnNumber(jQuery("#qty_"+a).val()))),c=parseFloat(returnNumber(jQuery("#mrp_"+a).val())),d=parseFloat(returnNumber(jQuery("#discount_"+a).val())),e=parseFloat(returnNumber(jQuery("#saItemTax_"+a).val())),f=parseFloat(c*b).toFixed(2),g=parseFloat(f-d).toFixed(2),h=(g*e/100).toFixed(2);$("#itemType_"+a).val();$("#taxAmount_"+a).val(h),$("#grossAmount_"+a).text(f),$("#taxableAmt_"+a).text(g),l(a,g,b),m()}function l(a,b,c){if(parseFloat(c)>0){var d=$("#hsnSac_"+a).val();jQuery.ajax("/async/get-tax-percent?taxableValue="+b+"&reqQty="+c+"&hsn="+d+"&dm=cl",{success:function(b){if("success"===b.status){var c=parseFloat(b.taxPercent).toFixed(2);$("#saItemTax_"+a).val(c)}},error:function(a){alert("Unable to update applicable tax percent.")}})}}function m(){var a=totTaxableAmount=totDiscount=totTaxAmount=0,b=(roundedNetPay=netPay=0,0),c=e=f=0,d=returnNumber(parseFloat($("#packingCharges").val())),c=returnNumber(parseFloat($("#shippingCharges").val())),e=returnNumber(parseFloat($("#insuranceCharges").val())),f=returnNumber(parseFloat($("#otherCharges").val())),g=$("#taxCalcOption").val();jQuery(".grossAmount").each(function(b,c){iTotal=returnNumber(parseFloat(jQuery(this).text())),a+=iTotal}),jQuery(".saDiscount").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totDiscount+=iTotal}),jQuery(".taxableAmt").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).text())),totTaxableAmount+=iTotal}),jQuery(".saleItemQty").each(function(a,c){var d=jQuery(this).attr("index");""!==$("#iname_"+d).val()&&(qTotal=returnNumber(parseFloat(jQuery(this).val())),b+=qTotal)}),"i"===g?totTaxAmount=0:jQuery(".taxAmount").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totTaxAmount+=iTotal}),$("#grossAmount").text(parseFloat(a).toFixed(2)),$("#totDiscount").text(parseFloat(totDiscount).toFixed(2)),$("#taxableAmount").text(parseFloat(totTaxableAmount).toFixed(2)),$("#gstAmount").text(parseFloat(totTaxAmount).toFixed(2)),netPay=parseFloat(totTaxableAmount+totTaxAmount+d+c+e+f),roundedNetPay=Math.round(netPay),roundOff=(parseFloat(roundedNetPay)-netPay).toFixed(2),$("#roundOff").text(roundOff),$("#netPayTop").val(roundedNetPay.toFixed(2)),$("#netPayBottom").text(roundedNetPay.toFixed(2)),$("#totalItems").text(b.toFixed(2))}function n(){var a=roundOff=netPay=0;jQuery(".itemReturnValue").each(function(b,c){iTotal=jQuery(this).text(),parseFloat(iTotal)>0&&(a+=parseFloat(iTotal))}),roundOff=parseFloat(Math.round(a)-a),netPay=parseFloat(a+roundOff),jQuery(".totalAmount").text(a.toFixed(2)),jQuery(".roundOff").text(roundOff.toFixed(2)),jQuery(".netPay").text(netPay.toFixed(2))}if(jQuery(".date").datepicker(),jQuery(".date").datepicker({format:"dd/mm/yyyy"}).on("changeDate",function(a){jQuery(this).datepicker("hide")}),jQuery("#timepicker1").timepicker(),jQuery(".tooltips").tooltip(),jQuery(".popovers").popover(),jQuery("html").niceScroll({styler:"fb",cursorcolor:"#007AFF",cursorwidth:"6",cursorborderradius:"10px",background:"#F7F7F7",cursorborder:"",zindex:"1000"}),jQuery("#sidebar").niceScroll({styler:"fb",cursorcolor:"#007AFF",cursorwidth:"3",cursorborderradius:"10px",background:"#F7F7F7",cursorborder:""}),jQuery(".scroll-panel").niceScroll({styler:"fb",cursorcolor:"#007AFF",cursorwidth:"3",cursorborderradius:"10px",background:"#F7F7F7",cursorborder:""}),jQuery("#sidebar .sub-menu > a").click(function(){var a=jQuery(".sub-menu.open",jQuery("#sidebar"));jQuery(this).find(".menu-arrow").removeClass("arrow_carrot-right"),jQuery(".sub",a).slideUp(200);var b=jQuery(this).next();b.is(":visible")?(jQuery(this).find(".menu-arrow").addClass("arrow_carrot-right"),b.slideUp(200)):(jQuery(this).find(".menu-arrow").addClass("arrow_carrot-down"),b.slideDown(200));var c=jQuery(this).offset();diff=200-c.top,diff>0?jQuery("#sidebar").scrollTo("-="+Math.abs(diff),500):jQuery("#sidebar").scrollTo("+="+Math.abs(diff),500)}),jQuery(function(){function a(){var a=jQuery(window).width();a<=768&&(jQuery("#container").addClass("sidebar-close"),jQuery("#sidebar > ul").hide()),a>768&&(jQuery("#container").removeClass("sidebar-close"),jQuery("#sidebar > ul").show())}jQuery(window).on("load",a),jQuery(window).on("resize",a)}),jQuery(".toggle-nav").click(function(){!0===jQuery("#sidebar > ul").is(":visible")?(jQuery("#main-content").css({"margin-left":"0px"}),jQuery("#sidebar").css({"margin-left":"-180px"}),jQuery("#sidebar > ul").hide(),jQuery("#container").addClass("sidebar-closed")):(jQuery("#main-content").css({"margin-left":"180px"}),jQuery("#sidebar > ul").show(),jQuery("#sidebar").css({"margin-left":"0"}),jQuery("#container").removeClass("sidebar-closed"))}),$(document).on("keypress keydown keyup",".noEnterKey",function(a){if(13==a.keyCode)return a.preventDefault(),!1}),$(".postSc2CB").length>0&&$(".postSc2CB").on("click",function(a){var b=$(this).attr("id"),c=b.split("_")[1];if($("#dt_"+c).length>0&&$("#amt_"+c).length>0){var d=$("#dt_"+c).val(),e=$("#amt_"+c).val(),f=$("#locationCode").val(),g="dt="+d+"&amt="+e+"&locationCode="+f;if(""===f)return bootbox.alert({message:"Invalid location code."}),!1;jQuery.ajax("/fin/post-sales2cb",{type:"POST",data:g,beforeSend:function(){$("#ps_"+c).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#vn_"+c).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#vd_"+c).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$(".postSc2CB").attr("disabled",!0)},success:function(a){$(".postSc2CB").attr("disabled",!1),a.status?(bootbox.alert({message:"Transaction posted successfully with Voucher No. `"+a.vocNo+"`"}),$("#ps_"+c).html('<span style="color:green;font-weight:bold;font-size:14px;">Posted</span>'),$("#vn_"+c).html('<span style="color:green;font-weight:bold;font-size:14px;">'+a.vocNo+"</span>"),$("#vd_"+c).html(""),$("#btn_"+c).remove()):(bootbox.alert({message:a.errorMessage}),$("#ps_"+c).html(""),$("#vn_"+c).html(""),$("#vd_"+c).html(""))},error:function(a){$(".postSc2CB").attr("disabled",!1),bootbox.alert({message:"Unable to process your request."})}})}a.preventDefault()}),$("#comboBillEntry").length>0&&($("#SaveCombo").on("click",function(a){a.preventDefault(),$(this).attr("disabled",!0),$(".cancelButton").attr("disabled",!0),$("#comboBillEntry").submit()}),$("#comboDiscount").on("keypress",function(b){13==b.keyCode&&(a(0),b.preventDefault())}),$("#comPaymentMethod").on("change",function(){var a=parseInt(returnNumber($(this).val()));1===a?($("#comboCardDetails").show(),$("#comboWalletDetails, #comboSplitPaymentMethods").hide(),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentWallet, #splitPaymentCn, #cnNo, #walletID, #walletRefNo").val("")):2===a?($("#comboSplitPaymentMethods").show(),$("#comboWalletDetails, #comboCardDetails").hide(),$("#cardNo, #authCode, #walletID, #walletRefNo").val("")):4===a?($("#comboWalletDetails").show(),$("#comboCardDetails, #comboSplitPaymentMethods").hide(),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentWallet, #splitPaymentCn, #cnNo, #cardNo, #authCode").val("")):($("#comboCardDetails, #comboSplitPaymentMethods, #comboWalletDetails").hide(),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentWallet, #splitPaymentCn, #cnNo, #walletID, #walletRefNo, #cardNo, #authCode").val(""))}),$(".comboItemCode").on("keypress",function(c){if(13==c.keyCode){var d=$(this).attr("id").split("_")[1],e=$(this).val();if(""===e)return!1;if(e.length>0){$("#cbarcode_"+d).attr("disabled",!0),e.length<2?(e="0"+e,$(this).val(e)):b(d),$("#rowError_"+d).hide();var d=($("#locationCode").val(),$(this).attr("id").split("_")[1]);returnNumber($("#qty_"+d).val())<=0&&$(".comboItemCode").each(function(a,b){var c=$(this).val(),f=$(this).attr("id").split("_")[1];if(c==e&&f!==d){var g=parseInt(returnNumber($("#qty_"+f).val())),h=parseInt(g)+1;return $("#qty_"+f).val(h),$("#cicode_"+d).val(""),d=f,!1}}),a(d),c.preventDefault()}}}),$(".comboItemCode").on("keyup",function(c){if(8==c.keyCode){if($(this).val().length<=0){var d=$(this).attr("id").split("_")[1];b(d),a(d)}}}),$(".comboItemQty").on("keypress",function(b){var c=$(this).attr("id").split("_")[1];if(13==b.keyCode){var d=parseFloat(returnNumber($(this).val()));parseInt(c);if(!(d>0))return!1;a(c,"fromQty"),b.preventDefault()}})),$("#dfyDashboard").length>0&&$.post("/async/finyDefault",$("#dfyDashboard").serialize()),$("#checkAllOpBarcodes").length>0&&$("#checkAllOpBarcodes").on("click",function(a){var b=this;$(".requestedItem").each(function(a,c){$(b).prop("checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)})}),$("#changeMrpForm").length>0&&$(".itemnames").Tabledit({url:"/async/change-mrp",editButton:!1,deleteButton:!1,hideIdentifier:!1,columns:{identifier:[1,"lotAndItem"],editable:[[2,"newMrp"]]},onDraw:function(){$('[name="newMrp"]').length>0&&$('[name="newMrp"]').attr("title","Add new MRP and Hit Enter to Save.")},onAjax:function(a,b){var c=new URLSearchParams(b),d=returnNumber(parseFloat(c.get("newMrp")));if(d>0){var e=c.get("lotAndItem");return d>returnNumber(parseFloat($("#om__"+e).text()))||(bootbox.alert({message:"New MRP should be greater than old MRP. If you want to reduce the current MRP, please use Promocodes or Discount option."}),!1)}},onSuccess:function(a,b,c){if("success"===a.status)var d=a.response.updateMessage;else if("failed"===a.status)var d="Error: "+a.errorcode+", "+a.errortext;else var d="Unknown Error.";bootbox.alert({message:d})}}),$("#discountForm").length>0&&$(".itemdiscounts").length>0&&$(".itemdiscounts").Tabledit({url:"/async/sdiscount",deleteButton:!1,hideIdentifier:!1,columns:{identifier:[1,"inLotNo"],editable:[[5,"discountPercent"],[7,"endDate"]]},onDraw:function(){},onAjax:function(a,b){var c=new URLSearchParams(b),d=c.get("inLotNo"),e=d.split("____")[1],f=returnNumber(parseFloat(c.get("discountPercent"))),g=(returnNumber(parseFloat(c.get("discountAmount"))),c.get("endDate"),returnNumber(parseFloat($("#mrp_"+e).text())));if(!(f>0&&f<=100))return bootbox.alert({message:"Please add a valid discount percent."}),!1;var h=(g*f/100).toFixed(2);if(!(h>0))return bootbox.alert({message:"Invalid Discount Percent. Must be between 1 - 100 !"}),!1;$("#da_"+e).text(h)},onSuccess:function(a,b,c){if("success"===a.status)var d="Discount added successfully.";else if("failed"===a.status)var d="Error: "+a.errorcode+", "+a.errortext;else var d="Unknown Error.";bootbox.alert({message:d})}}),$("#stockAuditItems").length>0&&($("#itemnames").Tabledit({url:"/async/auditQty?locationCode="+$("#locationCode").val()+"&aC="+$("#aC").val(),editButton:!1,deleteButton:!1,hideIdentifier:!1,columns:{identifier:[1,"itemName"],editable:[[5,"phyQty"]]}}),$(".tabledit-input").on("keypress keydown keyup",function(a){13==a.keyCode&&a.preventDefault()}),$("#saLockSubmit").on("click",function(a){a.preventDefault(),bootbox.confirm("Are you sure. You want to Lock and Submit the Audit?",function(a){!0===a&&($("#stockAuditItems").append('<input type="hidden" name="op" value="saLockSubmit" />'),$(this).attr("disabled",!0),$("#stockAuditItems").submit())})}),$("#saPhyQty").on("click",function(a){a.preventDefault(),$("#stockAuditItems").append('<input type="hidden" name="op" value="saPhyQty" />'),$(this).html('<i class="fa fa-recycle"></i> Processing, Please Wait....'),$(this).attr("disabled",!0),$("#filterSubmit, #filterReset, #printAuditReport").attr("disabled",!0),$("#stockAuditItems").submit()}),$("#printAuditReport").on("click",function(a){a.preventDefault();var b=$("#aC").val();window.location.href="/stock-audit/print/"+b})),$("#owBarcode").length>0&&($("#customerType").on("change",function(a){if($("#tBodyowItems tr").length>0){var b=$(this).val();"b2c"===b?($("#siOtherInfoWindow").hide(),$("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").val("")):"b2b"===b?($("#siOtherInfoWindow").show(),$("#name").addClass("cnameAc")):($("#siOtherInfoWindow").hide(),$("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").val(""))}else $(this).val("b2c"),alert("Scan Barcode first.")}),$("#owBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val();if(b.length>13)return alert("Invalid barcode"),!1;var d=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+b+"&locationCode="+d,{success:function(a){if("success"===a.status){Object.keys(a.response.bcDetails).length>0?(jQuery.each(a.response,function(a,b){o[b.lotNo]=b}),c(a.response.bcDetails,b),$("#owBarcode").val("")):alert("Barcode not found")}},error:function(a){alert("Barcode not found in the Selected store.")}}),a.preventDefault()}}),$("#tBodyowItems").on("click","a.deleteOwItem",function(a){var b=$(this).attr("id");bootbox.confirm("Are you sure. You want to remove this item?",function(a){if(!0===a&&""!==b){var c=b.split("_")[1],d=$("#tr_"+c);if(d.length>0)if(d.remove(),$("#tBodyowItems tr").length>0){var e=1;$(".itemSlno").each(function(a,b){$(this).text(e),e++}),$(".saleItemQty").trigger("change")}else $("#totalItems, #grossAmount, #totDiscount, #taxableAmount, #gstAmount, #roundOff, #netPayBottom").text(""),$("#paymentMethodWindow, #customerWindow, #splitPaymentWindow, #saveWindow, #owItemsTable, #siOtherInfoWindow, #remarksWindow").hide(),$("#owBarcode").val("")}})})),$("#addAdjEntryFrm").length>0&&($("#adjBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val(),c=$("#locationCode").val();if(13!==b.length)return alert("Invalid barcode"),!1;if(""===c)return alert("Choose a Store first."),!1;var c=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+b+"&locationCode="+c,{success:function(a){if("success"===a.status){if(Object.keys(a.response.bcDetails).length>0){console.log(a);var b=a.response.bcDetails.itemName,c=parseFloat(a.response.bcDetails.availableQty).toFixed(2),d=a.response.bcDetails.lotNo;$("#itemName").val(b),$("#lotNo").val(d),$("#adjQty").val(c),$("#adjBarcode").val(""),$("#adjBarcode").focus()}else alert("Barcode not found")}},error:function(a){alert("Barcode not found in the Selected store.")}})}a.preventDefault()}),$("#adjSave").on("click",function(a){$(this).attr("disabled",!0),$("#adjSave, #adjCancel").attr("disabled",!0),$("#addAdjEntryFrm").submit()})),$(".transBarcode").length>0&&($(".transBarcode").on("blur",function(a){var b=$(this).val(),c=$(this).attr("id"),d=c.split("_")[1];""===b&&$("#iname_"+d).removeAttr("readonly")}),$(".transBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val(),c=$(this).attr("id"),d=parseInt(c.split("_")[1]);if(13!==b.length)return alert("Invalid barcode"),!1;var e=$("#fromLocation").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+b+"&locationCode="+e,{success:function(a){if("success"===a.status){if(Object.keys(a.response.bcDetails).length>0){var b=a.response.bcDetails.itemName,c=parseFloat(a.response.bcDetails.availableQty).toFixed(2),e=a.response.bcDetails.lotNo,g=a.response.bcDetails.cno,h=parseFloat(a.response.bcDetails.mOq).toFixed(2),i=parseFloat(a.response.bcDetails.taxPercent).toFixed(2),j=parseFloat(a.response.bcDetails.mrp).toFixed(2),k=parseFloat(1*h).toFixed(2),l=parseFloat(j*k).toFixed(2),m=$("#lotNo_"+d),n=!1,o=null,p=selectedLotNo=null;if(jQuery(".lotNo").each(function(a,b){selectedLotNo=$(this).val(),p=$(this).attr("id"),selectedLotNo===e&&d!==a&&(n=!0,o=a)}),n){$("#barcode_"+d).focus().val("");var q=o,r=parseFloat($("#qty_"+q).val()),s=parseFloat(k)+parseFloat(r),l=parseFloat(j*s).toFixed(2);parseFloat($("#qtyava_"+q).val());if(!(s<=c))return alert("Available  Qty. is less than Transfer Qty!! Please check."),!1;$("#qty_"+q).val(s),$("#grossAmount_"+q).text(l),f(q)}else{$("#iname_"+d).attr("readonly","readonly"),$("#iname_"+d).val(b),$("#qtyava_"+d).val(c),$("#cno_"+d).text(g),$("#qty_"+d).val(k),$("#mrp_"+d).val(j),$("#grossAmount_"+d).text(l),$("#saItemTax_"+d+' option[value="'+i+'"]').attr("selected","selected"),$("#qtyava_"+d).attr("readonly","readonly"),$("#mrp_"+d).attr("readonly","readonly"),jQuery(m).html(jQuery("<option></option>").attr("value",e).text(e)),f(d);var t=d+1;$("#barcode_"+t).focus()}}else alert("Barcode not found")}},error:function(a){alert("Barcode not found in the Selected store.")}}),a.preventDefault()}})),$("#stBarcode").length>0&&$("#stBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val();if(13!==b.length)return alert("Invalid barcode"),!1;var c=$("#locationCode").val(),d=$("#transferCode").val(),e=0,f=parseFloat($("#trTransQty").text());e<f?jQuery.ajax("/async/getTrDetailsByCode?barcode="+b+"&locationCode="+c+"&transferCode="+d,{beforeSend:function(){$("#stBarcode").attr("disabled",!0),$("#stBarcode").val("Validating Barcode. Please wait...")},success:function(a){if("success"===a.status){e+=parseFloat(a.qty),f=parseFloat($("#trTransQty").text());var b=parseFloat(f-e);if(0==b)$("#stBarcode").attr("disabled",!0),bootbox.alert({message:"Scanning completed. Click on Save Button / స్కానింగ్ పూర్తి ఐనది. ఈ బదిలీ సేవ్ చేయటానికి అంగీకరణ బటన్ ప్రెస్ చెయ్యండి."}),$("#stBarcode").val(""),$("#trScannedQty").text(e.toFixed(2)),$("#trDiff").text(b.toFixed(2));else if(b<0){$("#stBarcode").attr("disabled",!0);alert("Scanned Qty. is more than actual Transfer Qty. and it is invalid. Please Rescan Again / స్కాన్ చేసిన సరుకు అసలు ట్రాన్స్ఫర్ చేయబడిన సరుకు కన్నా ఎక్కువగా ఉన్నది. ఇది చెల్లదు. మీరు మరల సరి చూసుకొని స్కాన్ చేయ గలరు."),$("#transferCode").length>0?window.location.href="/stock-transfer/validate/"+$("#transferCode").val():window.location.href="/stock-transfer/list"}else $("#trScannedQty").text(e.toFixed(2)),$("#trDiff").text(b.toFixed(2)),$("#stBarcode").attr("disabled",!1),$("#stBarcode").val(""),$("#stBarcode").focus()}else bootbox.alert({message:a.error}),$("#stBarcode").attr("disabled",!1),$("#stBarcode").val(""),$("#stBarcode").focus()},error:function(a){bootbox.alert({message:"Barcode not found in this transfer. Please check. / మీరు స్కాన్ చేసిన బార్ కోడ్ ఈ ట్రాన్స్ఫర్ ఆర్డర్  లో లేదు. దయచేసి సరి చూసుకోండి."}),$("#stBarcode").attr("disabled",!1),$("#stBarcode").val(""),$("#stBarcode").focus()}}):bootbox.alert({message:"Scanning completed already. Click on Save Button / స్కానింగ్ పూర్తి ఐనది. ఈ బదిలీ సేవ్ చేయటానికి అంగీకరణ బటన్ ప్రెస్ చెయ్యండి."}),a.preventDefault()}}),$("#indentBarcode").length>0&&($(".messageContainer").length>0&&$(".messageContainer").fadeOut(5e3),$("#indentBarcode").on("keypress",function(a){if(13==a.keyCode){var b=parseInt($(this).val());if(isNaN(b))return alert("Invalid Barcode format..."),!1;var c=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+b+"&locationCode="+c+"&sl=true&ind=true",{success:function(a){if("success"===a.status){if(Object.keys(a.response.bcDetails).length>0){if(a.response.bcDetails.availableQty<=0)return alert("Qty. not available"),$("#indentBarcode").focus(),$("#indentBarcode").val(""),!1;e(a.response.bcDetails,b),$("#indentBarcode").val("")}else alert("Barcode not found")}else{var c=a.reason;alert("[ "+b+" ] "+c),$("#indentBarcode").focus(),$("#indentBarcode").val("")}},error:function(a){alert("An error occurred while fetching Barcode")}}),a.preventDefault()}}),$("#tBodyowItems").on("click","a.deleteOwItem",function(a){var b=$(this).attr("id");bootbox.confirm("Are you sure. You want to remove this item?",function(a){if(!0===a&&""!==b){var c=b.split("_")[1],e=$("#tr_"+c);if(e.length>0)if(e.remove(),$("#tBodyowItems tr").length>0){var f=1;$(".itemSlno").each(function(a,b){$(this).text(f),f++}),d()}else $("#totalItems, #grossAmount, #totDiscount, #taxableAmount, #gstAmount, #roundOff, #netPayBottom").text(""),$("#paymentMethodWindow, #customerWindow, #splitPaymentWindow, #saveWindow, #owItemsTable").hide(),$("#owBarcode").val("")}})})),$("#salesIndentMobileV").length>0){var o=[];$("#mobileIndentItem").on("click",function(a){a.preventDefault();var b=jQuery("#itemName").val(),c=jQuery("<option></option>").attr("value","").text("Choose");if(""!==b){var d={itemName:b};jQuery.ajax("/async/getItemBatchesByCode",{data:d,method:"POST",success:function(a){if("success"===a.status){
var b=Object.keys(a).length,d=jQuery("#lotNo");b>0&&(d.empty().append(c),jQuery.each(a.response.bcDetails,function(a,b){o[b.lotNo]=b,jQuery(d).append(jQuery("<option></option>").attr("value",b.lotNo).text(b.mOq+" [ Available: "+b.availableQty+" ]"))}),$(".itemOtherInfo, .formButtons").show())}else alert("Item not available.")},error:function(a){alert("An error occurred while fetching Available Qty.")}})}else 0===parseInt(b.length)&&alert("Item name required.")}),$(".indentOrderQty").on("blur",function(a){var b=jQuery("#lotNo").val(),c=returnNumber(parseFloat($("#orderQty").val()));if(b in o&&c>0){var d=returnNumber(parseFloat(o[b].availableQty)),e=returnNumber(parseFloat(o[b].mOq)),f=returnNumber(parseFloat(o[b].mrp));if((c=returnNumber(parseFloat(c*e).toFixed(2)))>d)return alert("Order Qty. must be less than or equal to available Qty."),$(this).val(""),$(this).focus(),!1;$("#mrp").val(f),$("#orderQty").val(c)}})}if($(".cancelButton").on("click",function(a){a.preventDefault(),$(this).attr("disabled",!0),$(".cancelOp").attr("disabled",!0);var b=$(this).attr("id");"stoCancel"===b?window.location.href="/stock-transfer/choose-location":"inwBulkUploadCancel"===b?window.location.href="/inward-entry/bulk-upload":"seWithBarcode"===b?window.location.href="/sales/entry-with-barcode":"seWoBarcode"===b?window.location.href="/sales/entry":"scombos"===b?window.location.href="/sales-entry/combos":"ieWithBarcode"===b?window.location.href="/sales-indent/create":"uploadCustomers"===b?window.location.href="/upload-debtors":"uploadSuppliers"===b?window.location.href="/upload-creditors":"validateStButton"===b?window.location.href="/stock-transfer/register":"shippingPage"===b?window.location.href="/sales/list":"stransfer"===b?window.location.href="/stock-transfer/register":"comboCancel"===b?window.location.href="/sales-combo/add":"adjCancel"===b&&(window.location.href="/inventory/stock-adjustment")}),jQuery(".delPcVoucher").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this Voucher?",function(a){!0===a&&(window.location.href=b)})}),$(".delAdjEntry").length>0&&jQuery(".delAdjEntry").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this adjustment entry?",function(a){!0===a&&(window.location.href=b)})}),$(".delStransfer").length>0&&jQuery(".delStransfer").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this Stock transfer?",function(a){!0===a&&(window.location.href=b)})}),$(".delDiscount").length>0&&jQuery(".delDiscount").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this Discount entry?",function(a){!0===a&&(window.location.href=b)})}),$("#searchPurchaseBills").length>0&&$("#searchBy").on("change",function(a){"itemname"===$(this).val()?($("#svProducts").show(),$("#svAll").hide()):($("#svProducts").hide(),$("#svAll").show()),$("#searchValue, #searchValueP").val("")}),$("#stockOutForm").length>0){var o=[];$("#transferSubmitBtn").on("click",function(a){$(this).attr("disabled",!0),$("#stransfer").attr("disabled",!0),$("#stockOutForm").submit()}),jQuery(".saleItem").on("blur",function(a){var b=jQuery(this).val(),c=jQuery(this).attr("index"),d=$("#lotNo_"+c),e=jQuery("<option></option>").attr("value","").text("Choose");if(""!==b){var f=$("#fromLocation").val(),g={itemname:b,locationCode:f};jQuery.ajax("/async/getAvailableQty",{data:g,method:"POST",success:function(a){if("success"===a.status){Object.keys(a).length>0?(jQuery(d).empty().append(e),jQuery.each(a.response,function(a,b){var c=b.cno,e=b.lotNo;""!==c&&(e+=" [ CASE: "+c+" ]"),o[b.lotNo]=b,jQuery(d).append(jQuery("<option></option>").attr("value",b.lotNo).text(e))})):jQuery(uppElement).text("")}},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}else 0===parseInt(b.length)&&(jQuery(d).empty().append(e),jQuery("#qtyava_"+c).val(""),jQuery("#mrp_"+c).val(""),jQuery("#itemType_"+c).val(""),jQuery("#saItemTax_"+c+' option[value=""]').attr("selected","selected"),jQuery("#qty_"+c+' option[value="0"]').attr("selected","selected"))}),jQuery(".lotNo").on("change",function(a){var b=(itemRate=itemType="",jQuery(this).attr("index")),c=jQuery(this).val(),d=(jQuery("#qtyava_"+b),jQuery("#mrp_"+b),jQuery("#itemType_"+b),jQuery("#iname_"+b).val());if(""!==c){var e="",g=!1;if(jQuery(".lotNo").each(function(a,d){(e=$(this).val())===c&&parseInt(b)!==parseInt(a)&&(g=!0)}),g)return $("#lotNo_"+b).val(""),jQuery("#qtyava_"+b).val(""),jQuery("#qty_"+b).val(""),jQuery("#mrp_"+b).val(""),jQuery("#iname_"+b).val(""),jQuery("#barcode_"+b).val(""),bootbox.alert({message:"This Lot No. is already selected for `"+d+"`. A Lot No. must be unique and selected only once in the bill against the same item."}),!1;Object.keys(o[c]).length>0&&(jQuery("#qtyava_"+b).val(o[c].closingQty),jQuery("#qty_"+b).val(o[c].mOq),jQuery("#mrp_"+b).val(o[c].mrp),jQuery("#itemType_"+b).val(o[c].itemType),jQuery("#saItemTax_"+b+' option[value="'+o[c].taxPercent+'"]').attr("selected","selected"),f(b))}}),jQuery(".saleItemQty").on("blur",function(){var a=parseInt($(this).val()),b=jQuery(this).attr("index"),c=$("#lotNo_"+b),d=$("#qtyava_"+b).val(),e=jQuery("<option></option>").attr("value","").text("Choose");a>0&&parseFloat(a)<=parseFloat(d)?f(b):(bootbox.alert({message:"Transfer Qty. is more than Available Qty."}),jQuery(c).empty().append(e),jQuery("#qtyava_"+b).val(""),jQuery("#mrp_"+b).val(""),jQuery("#itemType_"+b).val(""),jQuery("#saItemTax_"+b+' option[value=""]').attr("selected","selected"),jQuery("#qty_"+b).val(""),jQuery("#qtyava_"+b).val(""),jQuery("#iname_"+b).val(""),jQuery("#grossAmount_"+b).text(""),f(b))})}if(jQuery(".inameAc").length>0&&$(".inameAc").autocomplete("/async/itemsAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,extraParams:{locationCode:function(){return $("#locationCode").length>0?$("#locationCode").val():$("#fromLocation").length>0?$("#fromLocation").val():""}},max:0}),jQuery(".brandAc").length>0&&$(".brandAc").autocomplete("/async/brandAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,extraParams:{locationCode:function(){return $("#locationCode").length>0?$("#locationCode").val():""}},max:0}),jQuery(".catAc").length>0&&$(".catAc").autocomplete("/async/catAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,extraParams:{locationCode:function(){return $("#locationCode").length>0?$("#locationCode").val():""}},max:0}),jQuery(".uomAc").length>0&&$(".uomAc").autocomplete("/async/uomAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,extraParams:{locationCode:function(){return $("#locationCode").length>0?$("#locationCode").val():""}},max:0}),jQuery(".cnameAc").length>0&&$(".cnameAc").autocomplete("/async/custAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,max:0}),jQuery(".suppnameAc").length>0&&$(".suppnameAc").autocomplete("/async/suppAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,max:0}),$("#customerForm").length>0&&$("#customerType").on("change",function(){"b2b"===$(this).val()?($("#bioContainer").hide(),$("#age").val(0),$("#ageCategory").val("years"),$("#gender").val("")):$("#bioContainer").show()}),$("#editPOAfterGRN").length>0&&$("#grnDelete").on("click",function(a){a.preventDefault(),bootbox.confirm("Are you sure. You want to delete and re-create GRN for this PO?",function(a){!0===a&&($(this).attr("disabled",!0),$("#editPOAfterGRN").submit())})}),$("#grnEntryForm").length>0&&jQuery("#grnCancel").on("click",function(a){if(1!=confirm("Are you sure. You want to close this page?"))return!1;window.location.href="/grn/list",a.preventDefault()}),$("#delInvoiceForm").length>0&&jQuery("#invoiceDelete").on("click",function(a){a.preventDefault(),bootbox.confirm("Are you sure. You want to delete this Invoice?",function(a){!0===a&&($(this).attr("disabled",!0),$("#delInvoiceForm").submit())})}),$("#inwardEntryForm").length>0&&(jQuery(".inwRcvdQty, .inwFreeQty, .inwItemRate, .inwItemDiscount").on("blur",function(a){var b=$(this).attr("id").split("_"),c=b[1];h(c);var d=$("#brandName_"+c).val(),e=$("#categoryName_"+c).val(),f=$("#uom_"+c).val(),g=($("#barcode_"+c).val(),$("#hsnSacCode"+c).val());if(""===d||""===e||""===f||""===g){var i=$("#itemName_"+c).val();jQuery.ajax("/async/itd?pn="+i+"&locationCode="+$("#locationCode").val(),{method:"GET",success:function(a){"success"===a.status&&($("#brandName_"+c).val(a.response.mfgName),$("#categoryName_"+c).val(a.response.catName),$("#uom_"+c).val(a.response.uom),$("#hsnSacCode_"+c).val(a.response.hsnSacCode),$("#barcode_"+c).val(a.response.barcode))},error:function(a){alert("An error occurred while fetching Item Information.")}})}}),jQuery("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").on("blur",function(a){var b=returnNumber(parseFloat($("#packingCharges").val())),c=returnNumber(parseFloat($("#shippingCharges").val())),d=returnNumber(parseFloat($("#insuranceCharges").val())),e=returnNumber(parseFloat($("#otherCharges").val())),f=totalTaxAmount=finalAmount=0,g=roundedNetPay=0;jQuery(".inwItemAmount").each(function(a,b){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(f+=iTotal)}),jQuery(".inwItemTaxAmount").each(function(a,b){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(totalTaxAmount+=iTotal)}),g=parseFloat(f+totalTaxAmount)+parseFloat(b)+parseFloat(c)+parseFloat(d)+parseFloat(e),roundedNetPay=Math.round(g),finalAmount=g-parseFloat(roundedNetPay.toFixed(2)),$("#inwItemsTotal").text(f.toFixed(2)),$("#inwItemTaxAmount").text(totalTaxAmount.toFixed(2)),$("#roundOff").text(finalAmount.toFixed(2)),$("#inwNetPay").text(roundedNetPay)}),jQuery(".inwItemTax").on("change",function(){var a=$(this).attr("id").split("_"),b=a[1];$("#inwItemTaxAmt_"+b).attr("data-rate",parseFloat($(this).val()).toFixed(2)),h(b)}),jQuery("#supplierID").on("change",function(a){var b=$(this).val();""===b?$("#supplierState, #supplierGSTNo, #supplyType").val(""):jQuery.ajax("/async/get-supplier-details?c="+b,{method:"GET",success:function(a){if("success"===a.status){var b=a.response.supplierDetails,c=$("#cs").val();$("#supplierState").val(b.stateCode),$("#supplierGSTNo").val(b.tinNo),c==b.stateCode?$("#supplyType").val("intra"):$("#supplyType").val("inter")}},error:function(a){alert("An error occurred while fetching Supplier Information.")}})}),jQuery("#inwCancel").on("click",function(a){if(1!=confirm("Are you sure. You want to close this page?"))return!1;window.location.href="/inward-entry/list",a.preventDefault()})),$("#outwardEntryForm").length>0){var o=[];$("#customerType").on("change",function(a){var b=$(this).val();"b2c"===b?($("#siOtherInfoWindow").hide(),$("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").val("")):"b2b"===b?($("#siOtherInfoWindow").show(),$("#name").addClass("cnameAc")):($("#siOtherInfoWindow").hide(),$("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").val(""))}),$("#SaveInvoice").on("click",function(a){a.preventDefault(),$(this).attr("disabled",!0),$(".cancelButton").attr("disabled",!0),$("#outwardEntryForm").submit()}),$("#saPaymentMethod").on("change",function(){var a=parseInt($(this).val());1===a?($("#containerCardNo, #containerAuthCode").show(),$("#containerWalletName, #containerWalletRef").hide()):3===a?($("#containerCrDays").show(),$("#containerCardNo, #containerAuthCode, #containerWalletName, #containerWalletRef").hide()):4===a?($("#containerWalletName, #containerWalletRef").show(),$("#containerCardNo, #containerAuthCode, #containerCrDays").hide()):$("#containerCardNo, #containerAuthCode, #containerCrDays, #containerWalletName, #containerWalletRef").hide(),2===a?($("#splitPaymentWindow").show(),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentCn, #cnNo, #splitPaymentWallet").attr("disabled",!1),$("#containerCardNo, #containerAuthCode, #containerWalletName, #containerWalletRef").show(),$("#containerCrDays").hide()):($("#splitPaymentCash, #splitPaymentCard, #splitPaymentCn, #cnNo, #splitPaymentWallet").val(""),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentCn, #cnNo, #splitPaymentWallet").attr("disabled",!0),$("#splitPaymentWindow").hide())}),$("#saPromoCode").on("change",function(){""!==$(this).val()?($("#SaveInvoice").html("<i class='fa fa-lemon-o'></i> Apply Promo Code &amp; Continue"),$("#SaveInvoice").attr("class","btn btn-danger")):($("#SaveInvoice").html("<i class='fa fa-save'></i> Save &amp; Print"),$("#SaveInvoice").attr("class","btn btn-primary"))}),jQuery(".saleItem").on("blur",function(a){var b=jQuery(this).val(),c=jQuery(this).attr("index"),d=$("#lotNo_"+c),e=jQuery("<option></option>").attr("value","").text("Choose");$(d).children("option").length;if(""!==b){var f=$("#locationCode").val();if(""==f)return alert("Please choose Store location first."),$("#hdg-reports").scrollTop(),document.getElementById("locationCode").focus(),!1;var g={itemname:b,locationCode:f};jQuery.ajax("/async/getAvailableQty",{data:g,method:"POST",success:function(a){Object.keys(a).length>0?(jQuery(d).empty().append(e),jQuery.each(a.response,function(a,b){o[b.lotNo]=b,jQuery(d).append(jQuery("<option></option>").attr("value",b.lotNo).text(b.lotNo+" [ Packing: "+b.mOq+" ]"))})):jQuery(uppElement).text("")},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}}),jQuery(".lotNo").on("change",function(a){var b=(itemRate=itemType="",parseInt(jQuery(this).attr("index"))),c=jQuery(this).val();jQuery("#qtyava_"+b),jQuery("#mrp_"+b),jQuery("#itemType_"+b);if(""!==c&&Object.keys(o[c]).length>0){var d="";if(jQuery(".lotNo").each(function(a,e){if((d=$(this).val())===c&&b!==a)return $("#lotNo_"+b).val(""),bootbox.alert({message:"This Lot No. is already selected.  A Lot No. must be unique and selected only once in the bill against the same item."}),!1}),jQuery("#qtyava_"+b).val(o[c].closingQty),jQuery("#qty_"+b).val(o[c].mOq),jQuery("#mrp_"+b).val(o[c].mrp),jQuery("#itemType_"+b).val(o[c].itemType),jQuery("#saItemTax_"+b+' option[value="'+o[c].taxPercent+'"]').attr("selected","selected"),returnNumber(parseFloat(o[c].discountAmount))>0)var e=returnNumber(parseFloat(o[c].discountAmount))*returnNumber(parseFloat(o[c].mOq));else var e=0;$("#discount_"+b).val(e.toFixed(2)),k(b)}}),$("#outwardEntryForm").on("blur",".saDiscount",function(a){k(jQuery(this).attr("index"))}),$("#outwardEntryForm").on("change",".taxCalcOption",function(){m()}),$("#outwardEntryForm").on("change",".saleItemQty",function(){var a=jQuery(this).attr("index"),b=returnNumber(parseFloat($("#qtyava_"+a).val())),c=returnNumber(parseFloat($(this).val()));if(0===$("#in").length&&c>b)return alert("Qty. not available"),$(this).val(""),$(this).focus(),!1;if(void 0!==o&&o.length>0){var c=$(this).val(),d=$("#lotNo_"+a).val();if(returnNumber(parseFloat(o[d].discountAmount))>0)var e=returnNumber(parseFloat(o[d].discountAmount))*returnNumber(parseFloat(c));else var e=0;$("#discount_"+a).val(e.toFixed(2))}k(a)}),$("#outwardEntryForm").on("change",".mrp",function(){k(jQuery(this).attr("index"))}),$("#refCode").on("blur",function(a){var b=returnNumber($(this).val());parseInt(b)>0?jQuery.ajax("/async/get-ref-details?refCode="+b,{success:function(a){if($("#refCodeStatus").show(),"success"===a.status){var b=a.response.memberDetails,c=b.memberName,d=b.mobileNo;$("#refMemberName").val(c),$("#refMemberMobile").val(d),$("#refCodeStatus").html('<b style="color:green;">Referral code is valid.</b>')}else $("#refCodeStatus").html('<b style="color:red;">Referral code is not valid.</b>'),$("#refMemberName").val(""),$("#refMemberMobile").val(""),$("#refCode").focus()},error:function(a){alert("Invalid referral code.")}}):($("#refCodeStatus").hide(),$("#refCodeStatus").html(""),$("#refMemberName").val(""),$("#refMemberMobile").val(""),$("#refCode").val(""))}),$("#shippingCharges, #insuranceCharges, #otherCharges").on("blur",function(a){m()})}if($("#salesReturnWindow").length>0&&$(".returnQty").on("blur",function(a){var b=$(this).attr("id").split("_")[1],c=parseFloat($("#returnRate_"+b).text()),d=parseFloat($(this).val()),e=parseFloat(c*d);$("#returnValue_"+b).text(e.toFixed(2)),n()}),$("#sendOtpBtn").length>0&&($("#sendOtpBtn").on("click",function(){sendOTP()}),$("#submit-fp").on("click",function(a){var b=$("#emailID").val(),c=$("#pass-fp").val(),d=$("#newpass-fp").val();if(""===b||""===c||""===d)return alert("Userid, OTP and New password fields are mandatory to Reset your password."),$("#emailID").focus(),!1;jQuery.ajax("/reset-password",{method:"POST",data:$("#forgotPassword").serialize(),success:function(a){!1===a.status?(alert(a.error),window.location.href="/forgot-password"):(alert("Password has been changed successfully."),window.location.href="/login")},error:function(a){alert("Unable to reset password. Please try again."),window.location.href="/forgot-password"}}),a.preventDefault()})),$("#uploadInventory").length>0&&$("#uploadInventory").on("click",function(a){if(!$("#fileName").val().length)return alert("Please choose a file to upload."),!1;$(this).attr("disabled",!0),$("#invRefresh").attr("disabled",!0),$("#reloadInfo").show(),$("#frmInventoryUpload").submit(),a.preventDefault()}),$("#dbContainer").length>0&&$("#daySales").length>0){jQuery.ajax("/async/day-sales",{method:"GET",success:function(a){if("success"===a.status){var b=a.response.daySales[0],c=parseFloat(b.cashSales),d=parseFloat(b.cardSales),e=parseFloat(b.splitSales),f=parseFloat(b.walletSales),g=parseFloat(b.creditSales),h=parseFloat(b.returnAmount),i=parseFloat(c+d+e+g+f)-h,j=parseFloat(b.cashInHand);$("#ds-cashsale").text(c.toFixed(2)),$("#ds-cardsale").text(d.toFixed(2)),$("#ds-walletsale").text(f.toFixed(2)),$("#ds-splitsale").text(e.toFixed(2)),$("#ds-creditsale").text(g.toFixed(2)),$("#ds-returns").text(h.toFixed(2)),$("#ds-netsale").text(i.toFixed(2)),$("#ds-cashinhand").text(j.toFixed(2))}},error:function(a){alert("An error occurred while fetching Day Sales")}})}if($("#sfGraphReload").on("click",function(a){var b=$("#sgf-month").val(),c=$("#sgf-year").val();$("#saleMonth").val(b),$("#saleYear").val(c),monthWiseSales()}),$("#offerEntryForm").length>0&&($("#offerCancel").on("click",function(a){if(1!=confirm("Are you sure. You want to close this page?"))return!1;window.location.href="/promo-offers/list",a.preventDefault()}),$("#offerType").on("change",function(a){var b=$(this).val();$("#itemName, #discountOnProduct, #totalProducts, #freeProducts, #itemName, #discountOnProduct").val(""),"a"===b?($("#aContainer").show(),$("#bContainer").hide(),$("#cContainer").hide()):"b"===b?($("#aContainer").hide(),$("#bContainer").show(),$("#cContainer").hide()):"c"===b?($("#aContainer").hide(),$("#bContainer").hide(),$("#cContainer").show()):($("#aContainer").hide(),$("#bContainer").hide(),$("#cContainer").hide())})),($("#paymentVocForm").length>0||$("#receiptVocForm").length>0)&&$("#paymentMode").on("change",function(a){var b=$(this).val();"b"===b||"p"===b?$("#refInfo").show():"c"===b&&$("#refInfo").hide()}),$("#receiptVocForm").length>0){var p=[];$("#custBillNos").on("click",function(a){a.preventDefault();var b=jQuery("#partyName").val(),c=$("#custBillNo"),d=jQuery("<option></option>").attr("value","").text("Choose");$(c).children("option").length;if(""!==b){var e={custName:b};jQuery.ajax("/async/getBillNos",{data:e,method:"POST",success:function(a){if("success"===a.status){var b=Object.keys(a.response).length;parseInt(b)>0&&(jQuery(c).empty().append(d),jQuery.each(a.response,function(a,b){p[b.billNo]=b,jQuery(c).append(jQuery("<option></option>").attr("value",encodeHTML(b.billNo)).text(b.billNo+" { "+b.balAmount+" }"))}),$("#custBillNo").attr("disabled",!1))}else"failed"===a.status&&alert(billsNos.reason)},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}}),$("#custBillNo").on("change",function(a){var b=$(this).val();""!==b&&Object.keys(p[b]).length>0&&jQuery("#amount").val(p[b].balAmount)})}if($("#debitVocEntryForm").length>0){var p=[];$("#supplierCode").on("change",function(a){a.preventDefault();var b=$(this).val(),c=$("#suppBillNo"),d=jQuery("<option></option>").attr("value","").text("Choose");$(c).children("option").length;if(""!==b){var e={suppCode:b};jQuery.ajax("/async/getSuppBillNos",{data:e,method:"POST",success:function(a){if("success"===a.status){var b=Object.keys(a.response).length;parseInt(b)>0&&(jQuery(c).empty().append(d),jQuery.each(a.response,function(a,b){p[b.billNo]=b,jQuery(c).append(jQuery("<option></option>").attr("value",encodeHTML(b.billNo)).text(b.billNo+" { "+b.balAmount+" }"))}))}else"failed"===a.status&&alert(billsNos.reason)},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}}),$("#suppBillNo").on("change",function(a){var b=$(this).val();""!==b&&Object.keys(p[b]).length>0&&jQuery("#amount").val(p[b].balAmount)})}}function sendOTP(a){if(!/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+.)+([a-zA-Z0-9]{2,4})+$/.test($("#emailID").val()))return $("#emailID").focus(),alert("Please enter a valid username."),!1;jQuery.ajax("/send-otp",{method:"POST",data:$("#forgotPassword").serialize(),success:function(b){if(!1===b.status)return alert(b.errortext),!1;!0===b.status?($("#success-msg-fp").show(),$("#success-msg-fp").html(b.message),$("#pass-fp").attr("disabled",!1),$("#submit-fp").attr("disabled",!1),$("#newpass-fp").attr("disabled",!1),$("#sendOtpBtn").attr("disabled",!0),"resend"===a&&alert("OTP has been resent successfully. Please use latest code to reset your password.")):($("#error-msg-fp").show(),$("#error-msg-fp").html(b.message),"resend"===a&&alert("Unable to resend OTP."))},error:function(a){return $("#emailID").focus(),alert("An error occurred while processing your request."),!1}})}function printSalesBill(a){var b="/print-sales-bill?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400").print()}function printSalesBillCombo(a){var b="/print-sales-bill-combo?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400").print()}function printSalesBillSmall(a){var b="/print-sales-bill-small?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400").print()}function printSalesBillGST(a){var b="/print-sales-bill-gst?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400").print()}function printGrn(a){var b="/print-grn/"+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400")}function printSalesReturnBill(a){var b="/print-sales-return-bill?returnCode="+a;window.open(b,"_blank","scrollbars=yes, titlebar=yes, resizable=yes, width=400, height=400")}function resetFilter(a){""!==a&&(window.location.href=a)}function monthWiseSales(){var a=$("#saleMonth").val(),b=$("#saleYear").val(),c=[],d=[],e=totSplitSales=totCardSales=totSales=totSalesReturns=totNetSales=0,f=totCreditSales=0;jQuery.ajax("/async/monthly-sales?saleMonth="+a+"&saleYear="+b,{method:"GET",success:function(a){"success"===a.status&&(jQuery.each(a.response.daywiseSales,function(a,b){var g=new Date(b.tranDate+"T12:00:30z"),h=parseInt(returnNumber(b.cardSales))+parseInt(returnNumber(b.cashSales))+parseInt(returnNumber(b.splitSales))+parseInt(returnNumber(b.creditSales))+parseInt(returnNumber(b.walletSales));c.push(g.getDate()),d.push(h),e+=parseFloat(returnNumber(b.cashSales)),totCardSales+=parseFloat(returnNumber(b.cardSales)),totSplitSales+=parseFloat(returnNumber(b.splitSales)),totCreditSales+=parseFloat(returnNumber(b.creditSales)),f+=parseFloat(returnNumber(b.walletSales)),totSalesReturns+=parseFloat(returnNumber(b.returnAmount)),totSales+=parseFloat(returnNumber(b.cashSales))+returnNumber(parseFloat(b.cardSales))+returnNumber(parseFloat(b.splitSales))+returnNumber(parseFloat(b.creditSales))+returnNumber(parseFloat(b.walletSales))}),totNetSales=parseFloat(returnNumber(totSales))-parseFloat(returnNumber(totSalesReturns)),$("#cs-cashsale").text(e.toFixed(2)),$("#cs-cardsale").text(totCardSales.toFixed(2)),$("#cs-walletsale").text(f.toFixed(2)),$("#cs-splitsale").text(totSplitSales.toFixed(2)),$("#cs-creditsale").text(totCreditSales.toFixed(2)),$("#cs-totals").text(totSales.toFixed(2)),$("#cs-sreturn").text(totSalesReturns.toFixed(2)),$("#cs-netsale").text(totNetSales.toFixed(2))),$("#salesGraph").empty(),$("#salesGraph").jqplot([d,c],{title:"",seriesDefaults:{showMarker:!0,renderer:$.jqplot.BarRenderer,pointLabels:{show:!0},rendererOptions:{varyBarColor:!0},showLine:!0},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:[]},yaxis:{showTicks:!0}},grid:{drawBorder:!1,shadow:!1}})},error:function(a){alert("An error occurred while loading Monthwise Sales")}})}function monthWiseSalesReturns(){var a=$("#saleMonth").val(),b=$("#saleYear").val(),c=[],d=[];jQuery.ajax("/async/monthly-sales?saleMonth="+a+"&saleYear="+b,{method:"GET",success:function(a){"success"===a.status&&jQuery.each(a.response.daywiseSales,function(a,b){var e=new Date(b.tranDate+"T12:00:30z");c.push(e.getDate()),d.push(parseInt(b.returnamount))}),$("#sreturnsGraph").jqplot([c,d],{title:"",seriesDefaults:{showMarker:!0,renderer:$.jqplot.BarRenderer,rendererOptions:{varyBarColor:!0}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,tickOptions:{showGridline:!0}}},grid:{drawBorder:!0,shadow:!1}})},error:function(a){alert("An error occurred while loading Monthwise Sales Returns")}})}function returnNumber(a){return isNaN(a)||0===a.length?0:a}function getGeoLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(successGeoLocation,failedGeoLocation):alert("Geolocation is not supported by this browser. Please update your Browser.")}function successGeoLocation(a){$("#gLat").val(a.coords.latitude),$("#gLng").val(a.coords.longitude),$("#gAcc").val(a.coords.accuracy)}function failedGeoLocation(a){1==a.code&&alert("You must Allow Location Access to proceed further.")}function encodeHTML(a){return a.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;").split("'").join("&#39;")}$(window).load(function(){if($(".se-pre-con").fadeOut("slow"),setTimeout(function(){if($("#bQ").length>0){(new Fingerprint2).get(function(a){$("#__bq_pub").val(a),$.post("/id__mapper",$("#bQ").serialize())})}},100),$("#qbMain").length>0)var a=setInterval(function(){$.ajax({type:"POST",url:"/__id__lo",success:function(b){"expired"===b&&(clearInterval(a),window.location.href="/force-logout")}})},1e4)}),function(a){if(void 0===a)throw new Error("window is undefined");a.onhashchange=function(){"!"!==a.location.hash&&(a.location.hash="!")}}(window),jQuery(document).ready(function(){initializeJS(),$("#dbContainer").length>0&&($("#monthwiseSales").length>0||$("#salesDayGraph").length>0)&&monthWiseSales()});