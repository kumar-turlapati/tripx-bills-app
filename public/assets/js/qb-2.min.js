/*! qb 11-07-2018 */

function initializeJS(){function a(a,b){var c=a.itemName,d=0,e=a.lotNo,f=a.mrp,g=a.taxPercent,h=a.availableQty,i=$("#tBodyowItems tr").length;if($("#paymentMethodWindow, #customerWindow, #owItemsTable, #saveWindow, #tFootowItems").show(),$("#tr_"+b).length>0){var j=$("#tr_"+b+" .saleItemQty").val(),k=Number(j)+1;$("#tr_"+b+" .saleItemQty").val(k)}else{d=0==i?1:i+1;var l=taxableAmount=parseFloat(1*f).toFixed(2),m='<tr id="tr_'+b+'" class="bcRow" index="'+d+'">',n='<td align="right" style="vertical-align:middle;">'+d+"</td>",o='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemName][]" id="iname_'+d+'" class="saleItem noEnterKey" index="'+d+'"  value="'+c+'" style="width:190px;" readonly/></td>',p='<td style="vertical-align:middle;"><input type="text" class="form-control lotNo" name="itemDetails[lotNo][]" id="lotNo_'+d+'" index="'+d+'" value="'+e+'"  readonly /></td>',q='<td style="vertical-align:middle;"><input type="text" class="qtyAvailable text-right noEnterKey" name="itemDetails[itemAvailQty][]" id="qtyava_'+d+'" index="'+d+'" value="'+h+'"  readonly  size="10" /></td>',r='<td style="vertical-align:middle;"><input type="text" class="form-control saleItemQty noEnterKey" name="itemDetails[itemSoldQty][]" id="qty_'+d+'" index="'+d+'" value="1" style="text-align:right;font-weight:bold;font-size:14px;border:1px dashed;" /></td>',s='<td style="vertical-align:middle;"><input type="text" class="mrp text-right noEnterKey" name="itemDetails[itemRate][]" id="mrp_'+d+'" index="'+d+'" value="'+f+'" size="10" /></td>',l='<td class="grossAmount" id="grossAmount_'+d+'" index="'+d+'" style="vertical-align:middle;text-align:right;">'+l+"</td>",t='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemDiscount][]" id="discount_'+d+'" size="10" class="saDiscount noEnterKey"  index="'+d+'"  /></td>',u='<td class="taxableAmt text-right" id="taxableAmt_'+d+'" index="'+d+'" style="vertical-align:middle;text-align:right;">'+taxableAmount+"</td>",v='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemTaxPercent][]" id="saItemTax_'+d+'" size="10" class="form-control saItemTax noEnterKey"  index="'+d+'" value="'+g+'"  /></td>',w='<td style="vertical-align:middle;text-align:center;"><div class="btn-actions-group"><a class="btn btn-danger deleteOwItem" href="javascript:void(0)" title="Delete Row" id="delrow_'+b+'"><i class="fa fa-times"></i></a></div></td>',x='<input type="hidden" class="taxAmount" id="taxAmount_'+d+'" value="" />',y='<input type="hidden" class="itemType" id="itemType_'+d+'" value="" />',z=m+n+o+p+q+r+s+l+t+u+v+w+x+y+"</tr>";$("#tBodyowItems").append(z)}$(".saleItemQty").trigger("change")}function b(a,b){var c=a.itemName,d=0,e=a.lotNo,f=a.mrp,g=(a.taxPercent,a.lc);if($("#loc_"+g).length>0)var h=$("#loc_"+g).val();else var h="";var i=(a.availableQty,$("#tBodyowItems tr").length);if($("#customerWindow, #owItemsTable, #saveWindow, #tFootowItems").show(),$("#tr_"+b).length>0){var j=$("#tr_"+b+" .saleItemQty").val(),k=Number(j)+1;$("#tr_"+b+" .saleItemQty").val(k)}else{d=0==i?1:i+1;var l=taxableAmount=parseFloat(1*f).toFixed(2),m='<tr id="tr_'+b+'" class="bcRow" index="'+d+'">',n='<td align="right" style="vertical-align:middle;" class="itemSlno">'+d+"</td>",o='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemName][]" id="iname_'+d+'" class="saleItem noEnterKey" index="'+d+'"  value="'+c+'" style="width:190px;" readonly/></td>',p='<td style="vertical-align:middle;"><input type="text" class="form-control lotNo" name="itemDetails[lotNo][]" id="lotNo_'+d+'" index="'+d+'" value="'+e+'"  readonly /></td>',q='<td style="vertical-align:middle;"><input type="text" class="form-control saleItemQty noEnterKey" name="itemDetails[itemSoldQty][]" id="qty_'+d+'" index="'+d+'" value="1" style="text-align:right;font-weight:bold;font-size:14px;border:1px dashed;" /></td>',r='<td style="vertical-align:middle;"><input type="text" class="mrp text-right noEnterKey" name="itemDetails[itemRate][]" id="mrp_'+d+'" index="'+d+'" value="'+f+'" size="10" /></td>',l='<td class="grossAmount" id="grossAmount_'+d+'" index="'+d+'" style="vertical-align:middle;text-align:right;">'+l+"</td>",s='<td style="vertical-align:middle;text-align:center;"><div class="btn-actions-group"><a class="btn btn-danger deleteOwItem" href="javascript:void(0)" title="Delete Row" id="delrow_'+b+'"><i class="fa fa-times"></i></a></div></td>',t='<input type="hidden" class="noEnterKey" name="itemDetails[barcode][]" id="barcode_'+d+'" index="'+d+'" value="'+b+'" size="13" />',u=m+n+o+p+q+r+l+s+t+"</tr>";$("#tBodyowItems").append(u)}$("#locationCode").val(h),$(".saleItemQty").trigger("change")}function c(a){var b=(totTaxAmount=0,roundedNetPay=netPay=0,parseFloat(returnNumber(jQuery("#qty_"+a).val()))),c=parseFloat(returnNumber(jQuery("#mrp_"+a).val())),f=parseFloat(returnNumber(jQuery("#saItemTax_"+a).val())),g=parseFloat(c*b).toFixed(2),h=(g*f/100).toFixed(2),i=$("#itemType_"+a).val();$("#taxAmount_"+a).val(h),$("#grossAmount_"+a).text(g),"p"===i&&d(a,g,b),e()}function d(a,b,c){parseFloat(c)>0&&jQuery.ajax("/async/get-tax-percent?taxableValue="+b+"&reqQty="+c,{success:function(b){if("success"===b.status){var c=parseFloat(b.taxPercent).toFixed(2);$("#saItemTax_"+a+' option[value="'+c+'"]').attr("selected","selected")}},error:function(a){alert("Unable to update applicable tax percent.")}})}function e(){var a=totTaxableAmount=totDiscount=totTaxAmount=0,b=(roundedNetPay=netPay=0,$("#taxCalcOption").val());jQuery(".grossAmount").each(function(b,c){iTotal=returnNumber(parseFloat(jQuery(this).text())),a+=iTotal}),"i"===b?totTaxAmount=0:jQuery(".taxAmount").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totTaxAmount+=iTotal}),$("#grossAmount").text(parseFloat(a).toFixed(2)),$("#gstAmount").text(parseFloat(totTaxAmount).toFixed(2)),netPay=parseFloat(a+totTaxAmount),roundedNetPay=Math.round(netPay),roundOff=(parseFloat(roundedNetPay)-netPay).toFixed(2),$("#roundOff").text(roundOff),$("#netPayTop").val(roundedNetPay.toFixed(2)),$("#netPayBottom").text(roundedNetPay.toFixed(2))}function f(a){var b=totalTaxAmount=finalAmount=0,c=roundedNetPay=0,d=parseFloat(returnNumber($("#inwRcvdQty_"+a).val())),e=parseFloat(returnNumber($("#inwFreeQty_"+a).val())),f=parseFloat(returnNumber($("#inwItemRate_"+a).val())),h=parseFloat(returnNumber($("#inwItemDiscount_"+a).val())),i=parseFloat(returnNumber($("#inwItemTax_"+a).val())),j=d-e,k=parseFloat(returnNumber(j*f)),l=parseFloat(returnNumber(k-h)),m=parseFloat(l*i/100).toFixed(2);$("#inwBillQty_"+a).val(j),$("#inwItemGrossAmount_"+a).val(k),$("#inwItemAmount_"+a).val(l),$("#inwItemTaxAmt_"+a).val(m),jQuery(".inwItemAmount").each(function(a,c){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(b+=iTotal)}),jQuery(".inwItemTaxAmount").each(function(a,b){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(totalTaxAmount+=iTotal)}),c=parseFloat(b+totalTaxAmount),roundedNetPay=Math.round(c),finalAmount=c-parseFloat(roundedNetPay.toFixed(2)),$("#inwItemsTotal").text(b.toFixed(2)),$("#inwItemTaxAmount").text(totalTaxAmount.toFixed(2)),$("#roundOff").text(finalAmount.toFixed(2)),$("#inwNetPay").text(roundedNetPay),g()}function g(){jQuery(".inwTaxPercents").each(function(a,b){var c=$(this).val(),d=$(this).attr("id"),e=totalTaxable=0;if($("input[data-rate='"+c+"']").each(function(a,b){if(parseFloat(returnNumber($(this).val()))>0){var c=$(this).attr("id").split("_"),d=c[1],f=$("#inwItemAmount_"+d).val();totalTaxable=parseFloat(totalTaxable)+parseFloat(f),e=parseFloat(e)+parseFloat($(this).val())}}),$("#taxAmount_"+d).val(e.toFixed(2)),"inter"===$("#supplyType").val())$("#taxable_"+d+"_igst_value").text(parseFloat(e).toFixed(2)),$("#taxable_"+d+"_cgst_value").text(""),$("#taxable_"+d+"_sgst_value").text("");else{var f=parseFloat(e/2).toFixed(2);$("#taxable_"+d+"_cgst_value").text(f),$("#taxable_"+d+"_sgst_value").text(f),$("#taxable_"+d+"_igst_value").text("")}$("#taxable_"+d+"_amount").text(totalTaxable)})}function h(a){var b=(totTaxableAmount=totDiscount=totTaxAmount=0,roundedNetPay=netPay=0,parseFloat(returnNumber(jQuery("#qty_"+a).val()))),c=parseFloat(returnNumber(jQuery("#mrp_"+a).val())),d=parseFloat(returnNumber(jQuery("#discount_"+a).val())),e=parseFloat(returnNumber(jQuery("#saItemTax_"+a).val())),f=parseFloat(c*b).toFixed(2),g=parseFloat(f-d).toFixed(2),h=(g*e/100).toFixed(2),k=$("#itemType_"+a).val();$("#taxAmount_"+a).val(h),$("#grossAmount_"+a).text(f),$("#taxableAmt_"+a).text(g),"p"===k&&i(a,g,b),j()}function i(a,b,c){parseFloat(c)>0&&jQuery.ajax("/async/get-tax-percent?taxableValue="+b+"&reqQty="+c,{success:function(b){if("success"===b.status){var c=parseFloat(b.taxPercent).toFixed(2);$("#saItemTax_"+a+' option[value="'+c+'"]').attr("selected","selected")}},error:function(a){alert("Unable to update applicable tax percent.")}})}function j(){var a=totTaxableAmount=totDiscount=totTaxAmount=0,b=(roundedNetPay=netPay=0,0),c=$("#taxCalcOption").val();jQuery(".grossAmount").each(function(b,c){iTotal=returnNumber(parseFloat(jQuery(this).text())),a+=iTotal}),jQuery(".saDiscount").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totDiscount+=iTotal}),jQuery(".taxableAmt").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).text())),totTaxableAmount+=iTotal}),jQuery(".saleItemQty").each(function(a,c){var d=jQuery(this).attr("index");""!==$("#iname_"+d).val()&&(qTotal=returnNumber(parseFloat(jQuery(this).val())),b+=qTotal)}),"i"===c?totTaxAmount=0:jQuery(".taxAmount").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totTaxAmount+=iTotal}),$("#grossAmount").text(parseFloat(a).toFixed(2)),$("#totDiscount").text(parseFloat(totDiscount).toFixed(2)),$("#taxableAmount").text(parseFloat(totTaxableAmount).toFixed(2)),$("#gstAmount").text(parseFloat(totTaxAmount).toFixed(2)),netPay=parseFloat(totTaxableAmount+totTaxAmount),roundedNetPay=Math.round(netPay),roundOff=(parseFloat(roundedNetPay)-netPay).toFixed(2),$("#roundOff").text(roundOff),$("#netPayTop").val(roundedNetPay.toFixed(2)),$("#netPayBottom").text(roundedNetPay.toFixed(2)),$("#totalItems").text(b)}function k(){var a=roundOff=netPay=0;jQuery(".itemReturnValue").each(function(b,c){iTotal=jQuery(this).text(),parseFloat(iTotal)>0&&(a+=parseFloat(iTotal))}),roundOff=parseFloat(Math.round(a)-a),netPay=parseFloat(a+roundOff),jQuery(".totalAmount").text(a.toFixed(2)),jQuery(".roundOff").text(roundOff.toFixed(2)),jQuery(".netPay").text(netPay.toFixed(2))}if(jQuery(".date").datepicker(),jQuery("#timepicker1").timepicker(),jQuery(".tooltips").tooltip(),jQuery(".popovers").popover(),jQuery("html").niceScroll({styler:"fb",cursorcolor:"#007AFF",cursorwidth:"6",cursorborderradius:"10px",background:"#F7F7F7",cursorborder:"",zindex:"1000"}),jQuery("#sidebar").niceScroll({styler:"fb",cursorcolor:"#007AFF",cursorwidth:"3",cursorborderradius:"10px",background:"#F7F7F7",cursorborder:""}),jQuery(".scroll-panel").niceScroll({styler:"fb",cursorcolor:"#007AFF",cursorwidth:"3",cursorborderradius:"10px",background:"#F7F7F7",cursorborder:""}),jQuery("#sidebar .sub-menu > a").click(function(){var a=jQuery(".sub-menu.open",jQuery("#sidebar"));jQuery(this).find(".menu-arrow").removeClass("arrow_carrot-right"),jQuery(".sub",a).slideUp(200);var b=jQuery(this).next();b.is(":visible")?(jQuery(this).find(".menu-arrow").addClass("arrow_carrot-right"),b.slideUp(200)):(jQuery(this).find(".menu-arrow").addClass("arrow_carrot-down"),b.slideDown(200));var c=jQuery(this).offset();diff=200-c.top,diff>0?jQuery("#sidebar").scrollTo("-="+Math.abs(diff),500):jQuery("#sidebar").scrollTo("+="+Math.abs(diff),500)}),jQuery(function(){function a(){var a=jQuery(window).width();a<=768&&(jQuery("#container").addClass("sidebar-close"),jQuery("#sidebar > ul").hide()),a>768&&(jQuery("#container").removeClass("sidebar-close"),jQuery("#sidebar > ul").show())}jQuery(window).on("load",a),jQuery(window).on("resize",a)}),jQuery(".toggle-nav").click(function(){!0===jQuery("#sidebar > ul").is(":visible")?(jQuery("#main-content").css({"margin-left":"0px"}),jQuery("#sidebar").css({"margin-left":"-180px"}),jQuery("#sidebar > ul").hide(),jQuery("#container").addClass("sidebar-closed")):(jQuery("#main-content").css({"margin-left":"180px"}),jQuery("#sidebar > ul").show(),jQuery("#sidebar").css({"margin-left":"0"}),jQuery("#container").removeClass("sidebar-closed"))}),$(document).on("keypress keydown keyup",".noEnterKey",function(a){if(13==a.keyCode)return a.preventDefault(),!1}),$("#checkAllOpBarcodes").length>0&&$("#checkAllOpBarcodes").on("click",function(a){var b=this;$(".requestedItem").each(function(a,c){$(b).prop("checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)})}),$("#owBarcode").length>0&&($("#owBarcode").on("keypress",function(b){if(13==b.keyCode){var c=$(this).val();if(13!==c.length)return alert("Invalid barcode"),!1;var d=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+c+"&locationCode="+d,{success:function(b){if("success"===b.status){Object.keys(b.response.bcDetails).length>0?(a(b.response.bcDetails,c),$("#owBarcode").val("")):alert("Barcode not found")}},error:function(a){alert("Barcode not found in the Selected store.")}}),b.preventDefault()}}),$("#tBodyowItems").on("click","a.deleteOwItem",function(a){var b=$(this).attr("id");bootbox.confirm("Are you sure. You want to remove this item?",function(a){if(!0===a&&""!==b){var c=b.split("_")[1],d=$("#tr_"+c);d.length>0&&(d.remove(),$("#tBodyowItems tr").length>0?$(".saleItemQty").trigger("change"):($("#totalItems, #grossAmount, #totDiscount, #taxableAmount, #gstAmount, #roundOff, #netPayBottom").text(""),$("#paymentMethodWindow, #customerWindow, #splitPaymentWindow, #saveWindow, #owItemsTable").hide(),$("#owBarcode").val("")))}})})),$("#indentBarcode").length>0&&($(".messageContainer").length>0&&$(".messageContainer").fadeOut(5e3),$("#indentBarcode").on("keypress",function(a){if(13==a.keyCode){var c=$(this).val(),d=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+c+"&locationCode="+d+"&sl=true&ind=true",{success:function(a){if("success"===a.status){if(Object.keys(a.response.bcDetails).length>0){if(a.response.bcDetails.availableQty<=0)return alert("Qty. not available"),$("#indentBarcode").focus(),$("#indentBarcode").val(""),!1;b(a.response.bcDetails,c),$("#indentBarcode").val("")}else alert("Barcode not found")}},error:function(a){}}),a.preventDefault()}}),$("#tBodyowItems").on("click","a.deleteOwItem",function(a){var b=$(this).attr("id");bootbox.confirm("Are you sure. You want to remove this item?",function(a){if(!0===a&&""!==b){var c=b.split("_")[1],d=$("#tr_"+c);if(d.length>0)if(d.remove(),$("#tBodyowItems tr").length>0){var e=1;$(".itemSlno").each(function(a,b){$(this).text(e),e++}),$(".saleItemQty").trigger("change")}else $("#totalItems, #grossAmount, #totDiscount, #taxableAmount, #gstAmount, #roundOff, #netPayBottom").text(""),$("#paymentMethodWindow, #customerWindow, #splitPaymentWindow, #saveWindow, #owItemsTable").hide(),$("#owBarcode").val("")}})})),$(".cancelButton").on("click",function(a){var b=$(this).attr("id");"stoCancel"===b?window.location.href="/stock-transfer/choose-location":"inwBulkUploadCancel"===b?window.location.href="/inward-entry/bulk-upload":"seWithBarcode"===b?window.location.href="/sales/entry-with-barcode":"ieWithBarcode"===b&&(window.location.href="/sales-indent/create"),a.preventDefault()}),jQuery(".delPcVoucher").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this Voucher?",function(a){!0===a&&(window.location.href=b)})}),$(".delAdjEntry").length>0&&jQuery(".delAdjEntry").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this adjustment entry?",function(a){!0===a&&(window.location.href=b)})}),$("#stockOutForm").length>0){var l=[];jQuery(".saleItem").on("blur",function(a){var b=jQuery(this).val(),c=jQuery(this).attr("index"),d=$("#lotNo_"+c),e=jQuery("<option></option>").attr("value","").text("Choose");if(""!==b){var f=$("#fromLocation").val(),g={itemname:b,locationCode:f};jQuery.ajax("/async/getAvailableQty",{data:g,method:"POST",success:function(a){if("success"===a.status){Object.keys(a).length>0?(jQuery(d).empty().append(e),jQuery.each(a.response,function(a,b){l[b.lotNo]=b,jQuery(d).append(jQuery("<option></option>").attr("value",b.lotNo).text(b.lotNo))})):jQuery(uppElement).text("")}},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}else 0===parseInt(b.length)&&(jQuery(d).empty().append(e),jQuery("#qtyava_"+c).val(""),jQuery("#mrp_"+c).val(""),jQuery("#itemType_"+c).val(""),jQuery("#saItemTax_"+c+' option[value=""]').attr("selected","selected"),jQuery("#qty_"+c+' option[value="0"]').attr("selected","selected"))}),jQuery(".lotNo").on("change",function(a){var b=(itemRate=itemType="",jQuery(this).attr("index")),d=jQuery(this).val();jQuery("#qtyava_"+b),jQuery("#mrp_"+b),jQuery("#itemType_"+b);""!==d&&Object.keys(l[d]).length>0&&(jQuery("#qtyava_"+b).val(l[d].closingQty),jQuery("#mrp_"+b).val(l[d].mrp),jQuery("#itemType_"+b).val(l[d].itemType),jQuery("#saItemTax_"+b+' option[value="'+l[d].taxPercent+'"]').attr("selected","selected"),c(b))}),jQuery(".saleItemQty").on("change",function(){var a=parseInt($(this).val()),b=jQuery(this).attr("index"),d=$("#lotNo_"+b),e=jQuery("<option></option>").attr("value","").text("Choose");a>0?c(b):(jQuery(d).empty().append(e),jQuery("#qtyava_"+b).val(""),jQuery("#mrp_"+b).val(""),jQuery("#itemType_"+b).val(""),jQuery("#saItemTax_"+b+' option[value=""]').attr("selected","selected"),jQuery("#qty_"+b+' option[value="0"]').attr("selected","selected"),jQuery("#iname_"+b).val(""),jQuery("#grossAmount_"+b).text(""))})}if(jQuery(".inameAc").length>0&&$(".inameAc").autocomplete("/async/itemsAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,max:0}),$("#customerForm").length>0&&$("#customerType").on("change",function(){"b"===$(this).val()?($("#bioContainer").hide(),$("#age").val(0),$("#ageCategory").val("years"),$("#gender").val("")):$("#bioContainer").show()}),$("#grnEntryForm").length>0&&jQuery("#grnCancel").on("click",function(a){if(1!=confirm("Are you sure. You want to close this page?"))return!1;window.location.href="/grn/list",a.preventDefault()}),$("#inwardEntryForm").length>0&&(jQuery(".inwRcvdQty, .inwFreeQty, .inwItemRate, .inwItemDiscount").on("blur",function(a){f($(this).attr("id").split("_")[1])}),jQuery(".inwItemTax").on("change",function(){var a=$(this).attr("id").split("_"),b=a[1];$("#inwItemTaxAmt_"+b).attr("data-rate",parseFloat($(this).val()).toFixed(2)),f(b)}),jQuery("#supplierID").on("change",function(a){var b=$(this).val();jQuery.ajax("/async/get-supplier-details?c="+b,{method:"GET",success:function(a){if("success"===a.status){var b=a.response.supplierDetails,c=$("#cs").val();$("#supplierState").val(b.stateCode),$("#supplierGSTNo").val(b.tinNo),c==b.stateCode?$("#supplyType").val("intra"):$("#supplyType").val("inter")}},error:function(a){alert("An error occurred while fetching Supplier Information.")}})}),jQuery("#inwCancel").on("click",function(a){if(1!=confirm("Are you sure. You want to close this page?"))return!1;window.location.href="/inward-entry/list",a.preventDefault()})),$("#outwardEntryForm").length>0){var l=[];$("#saPaymentMethod").on("change",function(){var a=parseInt($(this).val());1===a||2===a?$("#containerCardNo, #containerAuthCode").show():$("#containerCardNo, #containerAuthCode").hide(),2===a?($("#splitPaymentWindow").show(),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentCn, #cnNo").attr("disabled",!1)):($("#splitPaymentCash, #splitPaymentCard, #splitPaymentCn, #cnNo").val(""),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentCn, #cnNo").attr("disabled",!0),$("#splitPaymentWindow").hide())}),$("#saPromoCode").on("change",function(){""!==$(this).val()?($("#SaveInvoice").html("<i class='fa fa-lemon-o'></i> Apply Promo Code &amp; Continue"),$("#SaveInvoice").attr("class","btn btn-danger")):($("#SaveInvoice").html("<i class='fa fa-save'></i> Save &amp; Print"),$("#SaveInvoice").attr("class","btn btn-primary"))}),jQuery(".saleItem").on("blur",function(a){var b=jQuery(this).val(),c=jQuery(this).attr("index"),d=$("#lotNo_"+c),e=jQuery("<option></option>").attr("value","").text("Choose"),f=$(d).children("option").length;if(""!==b&&1===parseInt(f)){var g=$("#locationCode").val();if(""==g)return alert("Please choose Store location first."),$("#hdg-reports").scrollTop(),document.getElementById("locationCode").focus(),!1;var h={itemname:b,locationCode:g};jQuery.ajax("/async/getAvailableQty",{data:h,method:"POST",success:function(a){Object.keys(a).length>0?(jQuery(d).empty().append(e),jQuery.each(a.response,function(a,b){l[b.lotNo]=b,jQuery(d).append(jQuery("<option></option>").attr("value",b.lotNo).text(b.lotNo))})):jQuery(uppElement).text("")},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}}),jQuery(".lotNo").on("change",function(a){var b=(itemRate=itemType="",jQuery(this).attr("index")),c=jQuery(this).val();jQuery("#qtyava_"+b),jQuery("#mrp_"+b),jQuery("#itemType_"+b);""!==c&&Object.keys(l[c]).length>0&&(jQuery("#qtyava_"+b).val(l[c].closingQty),jQuery("#mrp_"+b).val(l[c].mrp),jQuery("#itemType_"+b).val(l[c].itemType),jQuery("#saItemTax_"+b+' option[value="'+l[c].taxPercent+'"]').attr("selected","selected"),h(b))}),$("#outwardEntryForm").on("blur",".saDiscount",function(a){h(jQuery(this).attr("index"))}),$("#outwardEntryForm").on("change",".taxCalcOption",function(){j()}),$("#outwardEntryForm").on("change",".saleItemQty",function(){h(jQuery(this).attr("index"))}),$("#refCode").on("blur",function(a){var b=returnNumber($(this).val());parseInt(b)>0?jQuery.ajax("/async/get-ref-details?refCode="+b,{success:function(a){if($("#refCodeStatus").show(),"success"===a.status){var b=a.response.memberDetails,c=b.memberName,d=b.mobileNo;$("#refMemberName").val(c),$("#refMemberMobile").val(d),$("#refCodeStatus").html('<b style="color:green;">Referral code is valid.</b>')}else $("#refCodeStatus").html('<b style="color:red;">Referral code is not valid.</b>'),$("#refMemberName").val(""),$("#refMemberMobile").val(""),$("#refCode").focus()},error:function(a){alert("Invalid referral code.")}}):($("#refCodeStatus").hide(),$("#refCodeStatus").html(""),$("#refMemberName").val(""),$("#refMemberMobile").val(""),$("#refCode").val(""))})}if($("#salesReturnWindow").length>0&&$(".returnQty").on("change",function(a){var b=$(this).attr("id").split("_")[1],c=parseFloat($("#returnRate_"+b).text()),d=parseFloat($(this).val()),e=parseFloat(c*d);$("#returnValue_"+b).text(e.toFixed(2)),k()}),$("#sendOtpBtn").length>0&&($("#sendOtpBtn").on("click",function(){sendOTP()}),$("#submit-fp").on("click",function(a){var b=$("#emailID").val(),c=$("#pass-fp").val(),d=$("#newpass-fp").val();if(""===b||""===c||""===d)return alert("Userid, OTP and New password fields are mandatory to Reset your password."),$("#emailID").focus(),!1;jQuery.ajax("/reset-password",{method:"POST",data:$("#forgotPassword").serialize(),success:function(a){!1===a.status?(alert(a.error),window.location.href="/forgot-password"):(alert("Password has been changed successfully."),window.location.href="/login")},error:function(a){alert("Unable to reset password. Please try again."),window.location.href="/forgot-password"}}),a.preventDefault()})),$("#uploadInventory").length>0&&$("#uploadInventory").on("click",function(a){if(!$("#fileName").val().length)return alert("Please choose a file to upload."),!1;$(this).attr("disabled",!0),$("#invRefresh").attr("disabled",!0),$("#reloadInfo").show(),$("#frmInventoryUpload").submit(),a.preventDefault()}),$("#dbContainer").length>0&&$("#daySales").length>0){jQuery.ajax("/async/day-sales",{method:"GET",success:function(a){if("success"===a.status){var b=a.response.daySales[0],c=parseFloat(b.cashSales),d=parseFloat(b.cardSales),e=parseFloat(b.splitSales),f=parseFloat(c+d+e),g=parseFloat(b.cashInHand);$("#ds-cashsale").text(c.toFixed(2)),$("#ds-cardsale").text(d.toFixed(2)),$("#ds-splitsale").text(e.toFixed(2)),$("#ds-netsale").text(f.toFixed(2)),$("#ds-cashinhand").text(g.toFixed(2))}},error:function(a){alert("An error occurred while fetching Day Sales")}})}$("#sfGraphReload").on("click",function(a){var b=$("#sgf-month").val(),c=$("#sgf-year").val();$("#saleMonth").val(b),$("#saleYear").val(c),monthWiseSales()}),$("#offerEntryForm").length>0&&($("#offerCancel").on("click",function(a){if(1!=confirm("Are you sure. You want to close this page?"))return!1;window.location.href="/promo-offers/entry",a.preventDefault()}),$("#offerType").on("change",function(a){var b=$(this).val();$("#itemName, #discountOnProduct, #totalProducts, #freeProducts, #itemName, #discountOnProduct").val(""),"a"===b?($("#aContainer").show(),$("#bContainer").hide(),$("#cContainer").hide()):"b"===b?($("#aContainer").hide(),$("#bContainer").show(),$("#cContainer").hide()):"c"===b?($("#aContainer").hide(),$("#bContainer").hide(),$("#cContainer").show()):($("#aContainer").hide(),$("#bContainer").hide(),$("#cContainer").hide())})),($("#paymentVocForm").length>0||$("#receiptVocForm").length>0)&&$("#paymentMode").on("change",function(a){var b=$(this).val();"b"===b||"p"===b?$("#refInfo").show():"c"===b&&$("#refInfo").hide()})}function sendOTP(a){if(!/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+.)+([a-zA-Z0-9]{2,4})+$/.test($("#emailID").val()))return $("#emailID").focus(),alert("Please enter a valid username."),!1;jQuery.ajax("/send-otp",{method:"POST",data:$("#forgotPassword").serialize(),success:function(b){if(!1===b.status)return alert(b.errortext),!1;!0===b.status?($("#success-msg-fp").show(),$("#success-msg-fp").html(b.message),$("#pass-fp").attr("disabled",!1),$("#submit-fp").attr("disabled",!1),$("#newpass-fp").attr("disabled",!1),$("#sendOtpBtn").attr("disabled",!0),"resend"===a&&alert("OTP has been resent successfully. Please use latest code to reset your password.")):($("#error-msg-fp").show(),$("#error-msg-fp").html(b.message),"resend"===a&&alert("Unable to resend OTP."))},error:function(a){return $("#emailID").focus(),alert("An error occurred while processing your request."),!1}})}function printSalesBill(a){var b="/print-sales-bill?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400")}function printSalesBillSmall(a){var b="/print-sales-bill-small?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400")}function printSalesBillGST(a){var b="/print-sales-bill-gst?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400")}function printGrn(a){var b="/print-grn/"+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400")}function printSalesReturnBill(a){var b="/print-sales-return-bill?returnCode="+a;window.open(b,"_blank","scrollbars=yes, titlebar=yes, resizable=yes, width=400, height=400")}function resetFilter(a){""!==a&&(window.location.href=a)}function monthWiseSales(){var a=$("#saleMonth").val(),b=$("#saleYear").val(),c=[],d=[],e=totSplitSales=totCardSales=totSales=totSalesReturns=totNetSales=0;jQuery.ajax("/async/monthly-sales?saleMonth="+a+"&saleYear="+b,{method:"GET",success:function(a){"success"===a.status&&(jQuery.each(a.response.daywiseSales,function(a,b){var f=new Date(b.tranDate+"T12:00:30z"),g=parseInt(returnNumber(b.cardSales))+parseInt(returnNumber(b.cashSales))+parseInt(returnNumber(b.splitSales));c.push(f.getDate()),d.push(g),e+=parseFloat(returnNumber(b.cashSales)),totCardSales+=parseFloat(returnNumber(b.cardSales)),totSplitSales+=parseFloat(returnNumber(b.splitSales)),totSales+=parseFloat(returnNumber(b.cashSales))+returnNumber(parseFloat(b.cardSales))+returnNumber(parseFloat(b.splitSales))}),totNetSales=parseFloat(totSales)-parseFloat(totSalesReturns),$("#cs-cashsale").text(e.toFixed(2)),$("#cs-cardsale").text(totCardSales.toFixed(2)),$("#cs-splitsale").text(totSplitSales.toFixed(2)),$("#cs-totals").text(totSales.toFixed(2)),$("#cs-returns").text(totSalesReturns.toFixed(2)),$("#cs-netsale").text(totNetSales.toFixed(2))),$("#salesGraph").empty(),$("#salesGraph").jqplot([d,c],{title:"",seriesDefaults:{showMarker:!0,renderer:$.jqplot.BarRenderer,pointLabels:{show:!0},rendererOptions:{varyBarColor:!0},showLine:!0},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:[]},yaxis:{showTicks:!0}},grid:{drawBorder:!1,shadow:!1}})},error:function(a){alert("An error occurred while loading Monthwise Sales")}})}function monthWiseSalesReturns(){var a=$("#saleMonth").val(),b=$("#saleYear").val(),c=[],d=[];jQuery.ajax("/async/monthly-sales?saleMonth="+a+"&saleYear="+b,{method:"GET",success:function(a){"success"===a.status&&jQuery.each(a.response.daywiseSales,function(a,b){var e=new Date(b.tranDate+"T12:00:30z");c.push(e.getDate()),d.push(parseInt(b.returnamount))}),$("#sreturnsGraph").jqplot([c,d],{title:"",seriesDefaults:{showMarker:!0,renderer:$.jqplot.BarRenderer,rendererOptions:{varyBarColor:!0}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,tickOptions:{showGridline:!0}}},grid:{drawBorder:!0,shadow:!1}})},error:function(a){alert("An error occurred while loading Monthwise Sales Returns")}})}function returnNumber(a){return isNaN(a)||0===a.length?0:a}$(window).load(function(){$(".se-pre-con").fadeOut("slow"),setTimeout(function(){(new Fingerprint2).get(function(a){$("#__bq_pub").val(a),$.post("/id__mapper",$("#bQ").serialize())})},100)}),jQuery(document).ready(function(){initializeJS(),$("#dbContainer").length>0&&($("#monthwiseSales").length>0||$("#salesDayGraph").length>0)&&monthWiseSales()});