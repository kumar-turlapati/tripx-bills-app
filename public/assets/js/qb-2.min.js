/*! qb 05-10-2020 */

function initializeJS(){function a(a,c){var d=$("#cicode_"+a).val();jQuery.ajax("/async/getComboItemDetails",{type:"POST",data:$("#comboBillEntry").serialize(),beforeSend:function(){""!==d&&($("#inameTd_"+a).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#qtyavaTd_"+a).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#mrpTd_"+a).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#grossAmountTd_"+a).html('<img src="/assets/img/wait.gif" alt="Wait.." />'))},success:function(d){if("success"===d.status){var e=netPay=roundedNetPay=0,f=d.response.comboItemAvaQtys,g=d.response.comboItemMrps,h=d.response.comboItemDiscounts,j=d.response.comboItemNames,k=d.response.comboItemAmounts;for(i=0;i<6;i++)if(i in j&&""!==j[i])if($("#iname_"+i).val(j[i]),$("#inameTd_"+i).text(j[i]),$("#qtyava_"+i).val(f[i]),$("#qtyavaTd_"+i).html('<i class="fa fa-cubes" aria-hidden="true"></i> '+f[i]),$("#mrp_"+i).val(g[i]),$("#mrpTd_"+i).html('<i class="fa fa-inr" aria-hidden="true"></i> '+parseFloat(g[i]).toFixed(2)),$("#discount_"+i).val(h[i]),$("#grossAmountTd_"+i).html('<i class="fa fa-inr" aria-hidden="true"></i> '+parseFloat(k[i]).toFixed(2)),netPay+=parseFloat(k[i]),roundedNetPay=Math.round(netPay),e=parseFloat(roundedNetPay)-netPay,$(".grossAmount").text(netPay.toFixed(2)),$(".roundOff").text(e.toFixed(2)),$(".netPay").text(roundedNetPay.toFixed(2)),"fromQty"===c){var l=parseInt(a)+1;$("#cicode_"+l).focus()}else $("#qty_"+a).focus();else b(i)}else alert("Invalid combo code !"),$("#inameTd_"+a).html(""),$("#qtyavaTd_"+a).html(""),$("#mrpTd_"+a).html(""),$("#grossAmountTd_"+a).html("")},error:function(b){$("#inameTd_"+a).html(""),$("#qtyavaTd_"+a).html(""),$("#mrpTd_"+a).html(""),$("#grossAmountTd_"+a).html(""),alert("Item code not found in the Selected store.")}})}function b(a){$("#inameTd_"+a).text(""),$("#qtyavaTd_"+a).text(""),$("#mrpTd_"+a).text(""),$("#grossAmountTd_"+a).text(""),$("#iname_"+a).val(""),$("#qtyava_"+a).val(""),$("#mrp_"+a).val(""),$("#discount_"+a).val(""),$("#qty_"+a).val("")}function c(a,b,c){var d=a.itemName,e=0,f=a.lotNo,g=a.taxPercent,h=a.availableQty,i=(a.upp,a.mOq),j=a.cno,k=a.hsnSacCode,l=a.discountAmount,n=(1*parseFloat(i)).toFixed(2),o=$("#customerType").val(),p=$("#tBodyowItems tr").length,q=a.itemType;if("wholesale"===c)var r=a.wholesalePrice;else if("online"===c)var r=a.onlinePrice;else if("ex"===c)var r=a.exMill;else var r=a.mrp;if($("#editKey").length>0)var s=$("#editKey").val();else var s=0;if($("#dKey").length>0)var t=$("#dKey").val();else var t=1;if($("#paymentMethodWindow, #customerWindow, #owItemsTable, #saveWindow, #tFootowItems, #remarksWindow").show(),"b2c"===o?$("#siOtherInfoWindow").hide():"b2b"===o?$("#siOtherInfoWindow").show():$("#siOtherInfoWindow").hide(),$("#tr_"+b+"_"+f).length>0){var u="#tr_"+b+"_"+f,v=$(u+" .saleItemQty").val(),w=parseFloat(v)+parseFloat(n),x=$(u).attr("index");$(u+" .saleItemQty").val(w.toFixed(2)),m(x)}else{e=0==p?1:p+1;var y=taxableAmount=parseFloat(1*r).toFixed(2),z='<tr id="tr_'+b+"_"+f+'" class="bcRow" index="'+e+'">',A='<td align="right" style="vertical-align:middle;" class="itemSlno">'+e+"</td>",B='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemName][]" id="iname_'+e+'" class="saleItem noEnterKey" size="30" index="'+e+'"  value="'+d+'" style="width:190px;" readonly/></td>',C='<td style="vertical-align:middle;"><input type="text" class="form-control lotNo" name="itemDetails[lotNo][]" id="lotNo_'+e+'" index="'+e+'" value="'+f+'"  readonly />';C+=""!==j?'<span style="font-size:11px;text-align:center;font-weight:bold;color:#FC4445">CASE: '+j+"</span></td>":"</td>";var D='<td style="vertical-align:middle;"><input type="text" class="qtyAvailable text-right noEnterKey" name="itemDetails[itemAvailQty][]" id="qtyava_'+e+'" index="'+e+'" value="'+h+'"  readonly  size="10" /></td>',E='<td style="vertical-align:middle;"><input type="text" class="form-control saleItemQty noEnterKey" name="itemDetails[itemSoldQty][]" id="qty_'+e+'" index="'+e+'" value="'+n+'" style="text-align:right;font-weight:bold;font-size:14px;border:1px dashed;" /></td>',F='<td style="vertical-align:middle;"><input type="text" class="mrp text-right noEnterKey" name="itemDetails[itemRate][]" id="mrp_'+e+'" index="'+e+'" value="'+r+'" size="10"';0===parseInt(s)&&"p"===q&&(F+=" readonly"),F+=" /></td>";var y='<td class="grossAmount" id="grossAmount_'+e+'" index="'+e+'" style="vertical-align:middle;text-align:right;">'+y+"</td>",G='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemDiscount][]" id="discount_'+e+'" size="10" class="saDiscount noEnterKey" index="'+e+'" value="'+l+'"';0===parseInt(t)&&(G+=" readonly"),G+=" /></td>";var H='<td class="taxableAmt text-right" id="taxableAmt_'+e+'" index="'+e+'" style="vertical-align:middle;text-align:right;">'+taxableAmount+"</td>",I='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemTaxPercent][]" id="saItemTax_'+e+'" size="10" class="form-control saItemTax noEnterKey"  index="'+e+'" value="'+g+'"  /></td>',J='<td style="vertical-align:middle;text-align:center;"><div class="btn-actions-group"><a class="btn btn-danger deleteOwItem" href="javascript:void(0)" title="Delete Row" id="delrow_'+b+"_"+f+'"><i class="fa fa-times"></i></a></div></td>',K='<input type="hidden" class="taxAmount" id="taxAmount_'+e+'" value="" />',L='<input type="hidden" class="itemType" name="itemDetails[itemType][]" id="itemType_'+e+'" value="'+q+'" />',M='<input type="hidden" class="hsnSacCode" id="hsnSac_'+e+'" value="'+k+'" />',N=z+A+B+C+D+E+F+y+G+H+I+J+K+L+M+"</tr>";$("#tBodyowItems").append(N)}m(e)}function d(a,b){var c=a.itemName,d=0,e=a.lotNo,f=(a.taxPercent,a.availableQty,a.upp,a.mOq,a.cno),g=(a.hsnSacCode,a.discountAmount,$("#customerType").val(),$("#tBodyowItems tr").length),h=(a.itemType,parseFloat(x[e]).toFixed(2)),i=w[e];if($("#tr_"+b+"_"+e).length>0){var j="#tr_"+b+"_"+e,k=$(j+" .saleItemQty").val(),l=parseFloat(k)+parseFloat(h);$(j).attr("index");$(j+" .saleItemQty").val(l.toFixed(2))}else{d=0==g?1:g+1;var m=(taxableAmount=parseFloat(1*i).toFixed(2),'<tr id="tr_'+b+"_"+e+'" class="bcRow" index="'+d+'">'),n='<td align="right" style="vertical-align:middle;font-size:14px;" class="itemSlno">'+d+"</td>",o='<td style="vertical-align:middle;font-size:14px;">'+c+"</td>",p='<td style="vertical-align:middle;font-size:14px;">'+e;p+=""!==f?'<span style="font-size:11px;text-align:center;font-weight:bold;color:#FC4445">CASE: '+f+"</span></td>":"</td>";var q='<input type="hidden" value="'+e+'" name="itemDetails[lotNo][]" />',r='<td style="vertical-align:middle;text-align:right;font-size:14px;">'+h+"</td>",s='<td style="vertical-align:middle;font-size:14px;text-align:right;">'+i+"</td>",t=m+n+o+p+r+s+q+"</tr>";$("#tBodyowItems").append(t)}}function e(a){var b=!1,c=a.itemName,d=parseFloat(a.availableQty).toFixed(2),e=a.lotNo,f=a.cno,g=parseFloat(a.mOq).toFixed(2),i=parseFloat(a.taxPercent).toFixed(2),j=parseFloat(a.mrp).toFixed(2),k=parseFloat(1*g).toFixed(2),l=parseFloat(j*k).toFixed(2),m=$("#lotNo_"+C),b=!1,n=null,o=selectedLotNo=null;if(jQuery(".lotNo").each(function(a,c){selectedLotNo=$(this).val(),o=$(this).attr("id"),selectedLotNo===e&&C!==a&&(b=!0,n=a)}),b){$("#barcode_"+C).focus().val("");var p=n,q=parseFloat($("#qty_"+p).val()),r=parseFloat(k)+parseFloat(q),l=parseFloat(j*r).toFixed(2);parseFloat($("#qtyava_"+p).val());if(!(r<=d))return alert("Available  Qty. is less than Transfer Qty!! Please check."),!1;$("#qty_"+p).val(r),$("#grossAmount_"+p).text(l),h(p)}else{$("#iname_"+C).attr("readonly","readonly"),$("#iname_"+C).val(c),$("#qtyava_"+C).val(d),$("#cno_"+C).text(f),$("#qty_"+C).val(k),$("#mrp_"+C).val(j),$("#grossAmount_"+C).text(l),$("#saItemTax_"+C+' option[value="'+i+'"]').attr("selected","selected"),$("#qtyava_"+C).attr("readonly","readonly"),$("#mrp_"+C).attr("readonly","readonly"),jQuery(m).html(jQuery("<option></option>").attr("value",e).text(e)),h(C);var s=C+1;$("#barcode_"+s).focus()}}function f(){var a=totalAmount=0;$(".saleItemQty").each(function(b,c){a+=returnNumber(parseFloat($(this).val()))}),$(".grossAmount").each(function(a,b){totalAmount+=returnNumber(parseFloat($(this).text()))}),a=a.toFixed(2),totalAmount=totalAmount.toFixed(2),$("#totalItems, #indentScannedQty").text(a),$("#grossAmount").text(totalAmount)}function g(a,b,c){var d=a.itemName,e=0,g=a.lotNo,h=(a.taxPercent,a.lc),i=(a.upp,a.mOq),j=(1*parseFloat(i)).toFixed(2);if($("#loc_"+h).length>0)var k=$("#loc_"+h).val();else var k="";var l=(a.availableQty,$("#tBodyowItems tr").length);if("wholesale"===c)var m=a.wholesalePrice;else if("online"===c)var m=a.onlinePrice;else if("ex"===c)var m=a.exMill;else var m=a.mrp;if($("#customerWindow, #owItemsTable, #saveWindow, #tFootowItems").show(),$("#tr_"+b+"_"+g).length>0){var n="#tr_"+b+"_"+g,o=$(n).attr("index"),p=$(n+" .saleItemQty").val(),q=parseFloat(p)+parseFloat(j),r=parseFloat(parseFloat(q)*parseFloat(m)).toFixed(2);$(n+" .saleItemQty").val(q),$("#grossAmount_"+o).text(r)}else{e=0==l?1:l+1;var r=taxableAmount=parseFloat(m*i).toFixed(2),s='<tr id="tr_'+b+"_"+g+'" class="bcRow" index="'+e+'">',t='<td align="right" style="vertical-align:middle;" class="itemSlno">'+e+"</td>",u='<td style="vertical-align:middle;"><input type="text" name="itemDetails[itemName][]" id="iname_'+e+'" class="saleItem noEnterKey" index="'+e+'"  value="'+d+'" size="30" readonly/></td>',v='<td style="vertical-align:middle;"><input type="text" class="form-control lotNo" name="itemDetails[lotNo][]" id="lotNo_'+e+'" index="'+e+'" value="'+g+'"  readonly /></td>',w='<td style="vertical-align:middle;"><input type="text" class="form-control saleItemQty noEnterKey" name="itemDetails[itemSoldQty][]" id="qty_'+e+'" index="'+e+'" value="'+j+'" style="text-align:right;font-weight:bold;font-size:14px;border:1px dashed;" readonly="readonly" /></td>',x='<td style="vertical-align:middle;text-align:center;"><input type="text" class="mrp text-right noEnterKey" name="itemDetails[itemRate][]" id="mrp_'+e+'" index="'+e+'" value="'+m+'" size="10" /></td>',r='<td class="grossAmount" id="grossAmount_'+e+'" index="'+e+'" style="vertical-align:middle;text-align:right;">'+r+"</td>",y='<td style="vertical-align:middle;text-align:center;"><div class="btn-actions-group"><a class="btn btn-danger deleteOwItem" href="javascript:void(0)" title="Delete Row" id="delrow_'+b+"_"+g+'"><i class="fa fa-times"></i></a></div></td>',z='<input type="hidden" class="noEnterKey" name="itemDetails[barcode][]" id="barcode_'+e+'" index="'+e+'" value="'+b+'" size="13" />',A=s+t+u+v+w+x+r+y+z+"</tr>";$("#tBodyowItems").append(A)}$("#locationCode").val(k),f()}function h(a){var b=(totTaxAmount=0,roundedNetPay=netPay=0,parseFloat(returnNumber(jQuery("#qty_"+a).val()))),c=parseFloat(returnNumber(jQuery("#mrp_"+a).val())),d=parseFloat(returnNumber(jQuery("#saItemTax_"+a).val())),e=parseFloat(c*b).toFixed(2),f=(e*d/100).toFixed(2);$("#itemType_"+a).val();$("#taxAmount_"+a).val(f),$("#grossAmount_"+a).text(e),$("#saItemTax_"+a+' option[value="'+d+'"]').attr("selected","selected"),j()}function j(){var a=totTaxableAmount=totDiscount=totTaxAmount=0,b=(roundedNetPay=netPay=0,insuranceCharges=otherCharges=0),c=totTransferQty=0,d=$("#taxCalcOption").val();jQuery(".grossAmount").each(function(b,c){iTotal=returnNumber(parseFloat(jQuery(this).text())),a+=iTotal}),jQuery(".qtyAvailable").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),c+=iTotal}),jQuery(".saleItemQty").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totTransferQty+=iTotal}),"i"===d?totTaxAmount=0:jQuery(".taxAmount").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totTaxAmount+=iTotal}),$("#grossAmount").text(parseFloat(a).toFixed(2)),$("#gstAmount").text(parseFloat(totTaxAmount).toFixed(2)),$(".stAvaQty").text(parseFloat(c).toFixed(2)),$(".stTraQty").text(parseFloat(totTransferQty).toFixed(2)),netPay=parseFloat(a+totTaxAmount+b+insuranceCharges+otherCharges),roundedNetPay=Math.round(netPay),roundOff=(parseFloat(roundedNetPay)-netPay).toFixed(2),$("#roundOff").text(roundOff),$("#netPayTop").val(roundedNetPay.toFixed(2)),$("#netPayBottom").text(roundedNetPay.toFixed(2))}function k(a){var b=totalTaxAmount=finalAmount=0,c=roundedNetPay=0,d=parseFloat(returnNumber($("#inwRcvdQty_"+a).val())),e=parseFloat(returnNumber($("#inwFreeQty_"+a).val())),f=parseFloat(returnNumber($("#inwItemRate_"+a).val())),g=parseFloat(returnNumber($("#inwItemDiscount_"+a).val())),h=parseFloat(returnNumber($("#inwItemTax_"+a).val())),i=parseFloat(returnNumber($("#packed_"+a).val())),j=(d-e)*i,k=parseFloat(returnNumber(j*f)),m=parseFloat(returnNumber(k-g)),n=parseFloat(m*h/100).toFixed(2),o=returnNumber(parseFloat($("#packingCharges").val())),p=returnNumber(parseFloat($("#shippingCharges").val())),q=returnNumber(parseFloat($("#insuranceCharges").val())),r=returnNumber(parseFloat($("#otherCharges").val()));$("#inwBillQty_"+a).val(j),$("#inwItemGrossAmount_"+a).val(k),$("#inwItemAmount_"+a).val(m),$("#inwItemTaxAmt_"+a).val(n),jQuery(".inwItemAmount").each(function(a,c){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(b+=iTotal)}),jQuery(".inwItemTaxAmount").each(function(a,b){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(totalTaxAmount+=iTotal)}),c=parseFloat(b+totalTaxAmount)+parseFloat(o)+parseFloat(p)+parseFloat(q)+parseFloat(r),roundedNetPay=Math.round(c),finalAmount=c-parseFloat(roundedNetPay.toFixed(2)),$("#inwItemsTotal").text(b.toFixed(2)),$("#inwItemTaxAmount").text(totalTaxAmount.toFixed(2)),$("#roundOff").text(finalAmount.toFixed(2)),$("#inwNetPay").text(roundedNetPay),l()}function l(){jQuery(".inwTaxPercents").each(function(a,b){var c=$(this).val(),d=$(this).attr("id"),e=totalTaxable=0;if($("input[data-rate='"+c+"']").each(function(a,b){if(parseFloat(returnNumber($(this).val()))>0){var c=$(this).attr("id").split("_"),d=c[1],f=$("#inwItemAmount_"+d).val();totalTaxable=(parseFloat(totalTaxable)+parseFloat(f)).toFixed(2),e=(parseFloat(e)+parseFloat($(this).val())).toFixed(2)}}),$("#taxAmount_"+d).val(parseFloat(e).toFixed(2)),"inter"===$("#supplyType").val())$("#taxable_"+d+"_igst_value").text(parseFloat(e).toFixed(2)),$("#taxable_"+d+"_cgst_value").text(""),$("#taxable_"+d+"_sgst_value").text("");else{var f=parseFloat(e/2).toFixed(2);$("#taxable_"+d+"_cgst_value").text(f),$("#taxable_"+d+"_sgst_value").text(f),$("#taxable_"+d+"_igst_value").text("")}$("#taxable_"+d+"_amount").text(totalTaxable)})}function m(a){var b=(totTaxableAmount=totDiscount=totTaxAmount=0,roundedNetPay=netPay=0,parseFloat(returnNumber(jQuery("#qty_"+a).val()))),c=parseFloat(returnNumber(jQuery("#mrp_"+a).val())),d=parseFloat(returnNumber(jQuery("#discount_"+a).val())),e=parseFloat(returnNumber(jQuery("#saItemTax_"+a).val())),f=parseFloat(c*b).toFixed(2),g=parseFloat(f-d).toFixed(2),h=(g*e/100).toFixed(2);$("#itemType_"+a).val();$("#taxAmount_"+a).val(h),$("#grossAmount_"+a).text(f),$("#taxableAmt_"+a).text(g),n(a,g,b),o()}function n(a,b,c){if(parseFloat(c)>0){var d=$("#hsnSac_"+a).val();jQuery.ajax("/async/get-tax-percent?taxableValue="+b+"&reqQty="+c+"&hsn="+d+"&dm=cl",{success:function(b){if("success"===b.status){var c=parseFloat(b.taxPercent).toFixed(2);$("#saItemTax_"+a).val(c)}},error:function(a){alert("Unable to update applicable tax percent.")}})}}function o(){var a=totTaxableAmount=totDiscount=totTaxAmount=0,b=(roundedNetPay=netPay=0,0),c=e=f=0,d=returnNumber(parseFloat($("#packingCharges").val())),c=returnNumber(parseFloat($("#shippingCharges").val())),e=returnNumber(parseFloat($("#insuranceCharges").val())),f=returnNumber(parseFloat($("#otherCharges").val())),g=$("#taxCalcOption").val();jQuery(".grossAmount").each(function(b,c){iTotal=returnNumber(parseFloat(jQuery(this).text())),a+=iTotal}),jQuery(".saDiscount").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totDiscount+=iTotal}),jQuery(".taxableAmt").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).text())),totTaxableAmount+=iTotal}),jQuery(".saleItemQty").each(function(a,c){var d=jQuery(this).attr("index");jQuery(this).attr("index");""!==$("#iname_"+d).val()&&"p"===$("#itemType_"+d).val()&&(qTotal=returnNumber(parseFloat(jQuery(this).val())),b+=qTotal)}),"i"===g?totTaxAmount=0:jQuery(".taxAmount").each(function(a,b){iTotal=returnNumber(parseFloat(jQuery(this).val())),totTaxAmount+=iTotal}),$("#grossAmount").text(parseFloat(a).toFixed(2)),$("#totDiscount").text(parseFloat(totDiscount).toFixed(2)),$("#taxableAmount").text(parseFloat(totTaxableAmount).toFixed(2)),$("#gstAmount").text(parseFloat(totTaxAmount).toFixed(2)),netPay=parseFloat(totTaxableAmount+totTaxAmount+d+c+e+f),roundedNetPay=Math.round(netPay),roundOff=(parseFloat(roundedNetPay)-netPay).toFixed(2),$("#roundOff").text(roundOff),$("#netPayTop").val(roundedNetPay.toFixed(2)),$("#netPayBottom").text(roundedNetPay.toFixed(2)),$("#totalItems").text(b.toFixed(2))}function p(a){var b=returnNumber(parseFloat($("#qty_"+a).val())),c=returnNumber(parseFloat($("#mrp_"+a).val())),d=returnNumber(parseFloat($("#saItemTax_"+a).val()));if("i"===$("#taxCalcOption").val())var e=Math.round(b*c,2),f=e,g=0;else var e=Math.round(b*c,2),g=Math.round(e*d/100,2),f=e+g;$("#taxable_"+a).text(e.toFixed(2)),$("#taxAmount_"+a).text(g.toFixed(2)),$("#totalAmount_"+a).text(f.toFixed(2)),q()}function q(){var a=totalGST=totalAmount=0;jQuery(".rowTaxable").each(function(b,c){var d=jQuery(this).text(),e=$("#taxAmount_"+b).text(),f=$("#totalAmount_"+b).text();a+=returnNumber(parseFloat(d)),totalGST+=returnNumber(parseFloat(e)),totalAmount+=returnNumber(parseFloat(f))}),$(".totalTaxable").text(a.toFixed(2)),$(".totalGST").text(totalGST.toFixed(2)),$(".totalAmount").text(totalAmount.toFixed(2)),$("#cnValue").val(totalAmount.toFixed(2))}function r(a){var b=returnNumber(parseFloat($("#qty_"+a).val())),c=returnNumber(parseFloat($("#purchaseRate_"+a).val())),d=returnNumber(parseFloat($("#dnItemTax_"+a).val()));if("i"===$("#taxCalcOption").val())var e=Math.round(b*c,2),f=e,g=0;else var e=Math.round(b*c,2),g=Math.round(e*d/100,2),f=e+g;e>0?$("#taxable_"+a).text(e.toFixed(2)):$("#taxable_"+a).text(""),g>0?$("#taxAmount_"+a).text(g.toFixed(2)):$("#taxAmount_"+a).text(""),f>0?$("#totalAmount_"+a).text(f.toFixed(2)):$("#totalAmount_"+a).text(""),s()}function s(){var a=totalGST=totalAmount=0;jQuery(".rowTaxable").each(function(b,c){var d=jQuery(this).text(),e=$("#taxAmount_"+b).text(),f=$("#totalAmount_"+b).text();a+=returnNumber(parseFloat(d)),totalGST+=returnNumber(parseFloat(e)),totalAmount+=returnNumber(parseFloat(f))}),$(".totalTaxable").text(a.toFixed(2)),$(".totalGST").text(totalGST.toFixed(2)),$(".totalAmount").text(totalAmount.toFixed(2)),$("#dnValue").val(totalAmount.toFixed(2))}function t(a){var b=!1,c=a.itemName,d=parseFloat(a.availableQty).toFixed(2),e=a.lotNo,f=(a.cno,parseFloat(a.mOq).toFixed(2)),g=parseFloat(a.taxPercent).toFixed(2),h=parseFloat(a.mrpDn).toFixed(2),i=parseFloat(1*f).toFixed(2),j=parseFloat(h*i).toFixed(2),k=$("#lotNo_"+C),b=!1,l=null,m=selectedLotNo=null;if(jQuery(".lotNo").each(function(a,c){selectedLotNo=$(this).val(),m=$(this).attr("id"),selectedLotNo===e&&C!==a&&(b=!0,l=a)}),b){$("#barcode_"+C).focus().val("");var n=l,o=parseFloat($("#qty_"+n).val()),p=parseFloat(i)+parseFloat(o),j=parseFloat(mrp*p).toFixed(2);parseFloat($("#qtyava_"+n).val());if(!(p<=d))return alert("Available  Qty. is less than Transfer Qty!! Please check."),!1;$("#qty_"+n).val(p),$("#grossAmount_"+n).text(j),r(n)}else{$("#iname_"+C).attr("readonly","readonly"),$("#iname_"+C).val(c),$("#qtyava_"+C).val(d),$("#qty_"+C).val(i),$("#purchaseRate_"+C).val(h),$("#grossAmount_"+C).text(j),$("#dnItemTax_"+C+' option[value="'+g+'"]').attr("selected","selected"),$("#qtyava_"+C).attr("readonly","readonly"),$("#mrp_"+C).attr("readonly","readonly"),jQuery(k).html(jQuery("<option></option>").attr("value",e).text(e)),r(C);var q=C+1;$("#barcode_"+q).focus()}}function u(){var a=roundOff=netPay=0;jQuery(".itemReturnValue").each(function(b,c){iTotal=jQuery(this).text(),parseFloat(iTotal)>0&&(a+=parseFloat(iTotal))}),roundOff=parseFloat(Math.round(a)-a),netPay=parseFloat(a+roundOff),jQuery(".totalAmount").text(a.toFixed(2)),jQuery(".roundOff").text(roundOff.toFixed(2)),jQuery(".netPay").text(netPay.toFixed(2))}if(jQuery(".date").datepicker(),jQuery(".date").datepicker({format:"dd/mm/yyyy"}).on("changeDate",function(a){jQuery(this).datepicker("hide")}),jQuery("#timepicker1").timepicker(),jQuery(".tooltips").tooltip(),jQuery(".popovers").popover(),jQuery("html").niceScroll({styler:"fb",cursorcolor:"#007AFF",cursorwidth:"6",cursorborderradius:"10px",background:"#F7F7F7",cursorborder:"",zindex:"1000"}),jQuery("#sidebar").niceScroll({styler:"fb",cursorcolor:"#007AFF",cursorwidth:"3",cursorborderradius:"10px",background:"#F7F7F7",cursorborder:""}),jQuery(".scroll-panel").niceScroll({styler:"fb",cursorcolor:"#007AFF",cursorwidth:"3",cursorborderradius:"10px",background:"#F7F7F7",cursorborder:""}),jQuery("#sidebar .sub-menu > a").click(function(){var a=jQuery(".sub-menu.open",jQuery("#sidebar"));jQuery(this).find(".menu-arrow").removeClass("arrow_carrot-right"),jQuery(".sub",a).slideUp(200);var b=jQuery(this).next();b.is(":visible")?(jQuery(this).find(".menu-arrow").addClass("arrow_carrot-right"),b.slideUp(200)):(jQuery(this).find(".menu-arrow").addClass("arrow_carrot-down"),b.slideDown(200));var c=jQuery(this).offset();diff=200-c.top,diff>0?jQuery("#sidebar").scrollTo("-="+Math.abs(diff),500):jQuery("#sidebar").scrollTo("+="+Math.abs(diff),500)}),jQuery(function(){function a(){var a=jQuery(window).width();a<=768&&(jQuery("#container").addClass("sidebar-close"),jQuery("#sidebar > ul").hide()),a>768&&(jQuery("#container").removeClass("sidebar-close"),jQuery("#sidebar > ul").show())}jQuery(window).on("load",a),jQuery(window).on("resize",a)}),jQuery(".toggle-nav").click(function(){!0===jQuery("#sidebar > ul").is(":visible")?(jQuery("#main-content").css({"margin-left":"0px"}),jQuery("#sidebar").css({"margin-left":"-180px"}),jQuery("#sidebar > ul").hide(),jQuery("#container").addClass("sidebar-closed")):(jQuery("#main-content").css({"margin-left":"180px"}),jQuery("#sidebar > ul").show(),jQuery("#sidebar").css({"margin-left":"0"}),jQuery("#container").removeClass("sidebar-closed"))}),$(document).on("keypress keydown keyup",".noEnterKey",function(a){if(13==a.keyCode)return a.preventDefault(),!1}),$("#cashVoucherForm").length>0&&$("#action").on("change",function(a){"payment"===$(this).val()?$("#cnNo").attr("disabled",!1):$("#cnNo").attr("disabled",!0)}),$("#appContentRedirectionContainer").length>0&&$("#enableRedirection").on("change",function(a){var b=$(this).val();1===parseInt(b)?$("#appContentRedirectionContainer").show():($("#appContentRedirectionContainer").hide(),$("#catalogName").val(""),$("#itemName").val(""))}),$(".postSc2CB").length>0&&$(".postSc2CB").on("click",function(a){var b=$(this).attr("id"),c=b.split("_")[1];if($("#dt_"+c).length>0&&$("#amt_"+c).length>0){var d=$("#dt_"+c).val(),e=$("#amt_"+c).val(),f=$("#locationCode").val(),g="dt="+d+"&amt="+e+"&locationCode="+f;if(""===f)return bootbox.alert({message:"Invalid location code."}),!1;jQuery.ajax("/fin/post-sales2cb",{type:"POST",data:g,beforeSend:function(){$("#ps_"+c).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#vn_"+c).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$("#vd_"+c).html('<img src="/assets/img/wait.gif" alt="Wait.." />'),$(".postSc2CB").attr("disabled",!0)},success:function(a){$(".postSc2CB").attr("disabled",!1),a.status?(bootbox.alert({message:"Transaction posted successfully with Voucher No. `"+a.vocNo+"`"}),$("#ps_"+c).html('<span style="color:green;font-weight:bold;font-size:14px;">Posted</span>'),$("#vn_"+c).html('<span style="color:green;font-weight:bold;font-size:14px;">'+a.vocNo+"</span>"),$("#vd_"+c).html(""),$("#btn_"+c).remove()):(bootbox.alert({message:a.errorMessage}),$("#ps_"+c).html(""),$("#vn_"+c).html(""),$("#vd_"+c).html(""))},error:function(a){$(".postSc2CB").attr("disabled",!1),bootbox.alert({message:"Unable to process your request."})}})}a.preventDefault()}),$("#galleryForm").length>0&&($(".showImage").on("click",function(){var a=$(this).find("img").attr("src"),b=$(this).attr("title");$("#imagePreview").attr("src",a),$("#modal-title").text(b),$("#imagemodal").modal("show")}),$("#inputType").on("change",function(a){"barcode"===$(this).val()?($("#barcodeInput").show(),$("#imgBarcode").focus()):$("#barcodeInput").hide()})),$("#removeDuplicates").length>0&&$("#removeDuplicates").on("change",function(a){a.preventDefault();var b=parseInt($(this).val());0===b?$("#duplicatesDiv, #maErrorId").hide():1===b&&$("#duplicatesDiv").show()}),$("#comboBillEntry").length>0&&($("#SaveCombo").on("click",function(a){a.preventDefault(),$(this).attr("disabled",!0),$(".cancelButton").attr("disabled",!0),$("#comboBillEntry").submit()}),$("#comboDiscount").on("keypress",function(b){13==b.keyCode&&(a(0),b.preventDefault())}),$("#comPaymentMethod").on("change",function(){var a=parseInt(returnNumber($(this).val()));1===a?($("#comboCardDetails").show(),$("#comboWalletDetails, #comboSplitPaymentMethods").hide(),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentWallet, #splitPaymentCn, #cnNo, #walletID, #walletRefNo").val("")):2===a?($("#comboSplitPaymentMethods").show(),$("#comboWalletDetails, #comboCardDetails").hide(),$("#cardNo, #authCode, #walletID, #walletRefNo").val("")):4===a?($("#comboWalletDetails").show(),$("#comboCardDetails, #comboSplitPaymentMethods").hide(),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentWallet, #splitPaymentCn, #cnNo, #cardNo, #authCode").val("")):($("#comboCardDetails, #comboSplitPaymentMethods, #comboWalletDetails").hide(),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentWallet, #splitPaymentCn, #cnNo, #walletID, #walletRefNo, #cardNo, #authCode").val(""))}),$(".comboItemCode").on("keypress",function(c){if(13==c.keyCode){var d=$(this).attr("id").split("_")[1],e=$(this).val();if(""===e)return!1;if(e.length>0){$("#cbarcode_"+d).attr("disabled",!0),e.length<2?(e="0"+e,$(this).val(e)):b(d),$("#rowError_"+d).hide();var d=($("#locationCode").val(),$(this).attr("id").split("_")[1]);returnNumber($("#qty_"+d).val())<=0&&$(".comboItemCode").each(function(a,b){var c=$(this).val(),f=$(this).attr("id").split("_")[1];if(c==e&&f!==d){var g=parseInt(returnNumber($("#qty_"+f).val())),h=parseInt(g)+1;return $("#qty_"+f).val(h),$("#cicode_"+d).val(""),d=f,!1}}),a(d),c.preventDefault()}}}),$(".comboItemCode").on("keyup",function(c){if(8==c.keyCode){if($(this).val().length<=0){var d=$(this).attr("id").split("_")[1];b(d),a(d)}}}),$(".comboItemQty").on("keypress",function(b){var c=$(this).attr("id").split("_")[1];if(13==b.keyCode){var d=parseFloat(returnNumber($(this).val()));parseInt(c);if(!(d>0))return!1;a(c,"fromQty"),b.preventDefault()}})),$("#dfyDashboard").length>0&&$.post("/async/finyDefault",$("#dfyDashboard").serialize()),$("#checkAllOpBarcodes").length>0&&$("#checkAllOpBarcodes").on("click",function(a){var b=this;$(".requestedItem").each(function(a,c){$(b).prop("checked")?$(this).prop("checked",!0):$(this).prop("checked",!1)})}),$("#productsList").length>0&&$(".plRackNumbers").Tabledit({url:"/async/updateRackNo",editButton:!1,deleteButton:!1,hideIdentifier:!1,columns:{identifier:[1,"itemCode"],editable:[[3,"rackNumber"]]},onDraw:function(){$('[name="rackNumber"]').length>0&&$('[name="rackNumber"]').attr("title","Add / Update Rack no. and hit Enter key to Save.")},onSuccess:function(a,b,c){if("success"===a.status)var d=a.response.updateMessage;else if("failed"===a.status)var d="Error: "+a.errorcode+", "+a.errortext;else var d="Unknown Error.";bootbox.alert({message:d})}}),$("#bulkUpdateSellingPriceFrm").length>0&&$("#bulkUpdateSellingPriceSubmit").on("click",function(a){a.preventDefault(),$("#bulkUpdateSellingPriceSubmit, #bulkUpdateSellingPrice").attr("disabled",!0),$("#bulkUpdateSellingPriceFrm").submit()}),$("#discountForm").length>0&&$(".itemdiscounts").length>0&&$(".itemdiscounts").Tabledit({url:"/async/sdiscount",deleteButton:!1,hideIdentifier:!1,columns:{identifier:[1,"inLotNo"],editable:[[5,"discountPercent"],[7,"endDate"]]},onDraw:function(){},onAjax:function(a,b){var c=new URLSearchParams(b),d=c.get("inLotNo"),e=d.split("____")[1],f=returnNumber(parseFloat(c.get("discountPercent"))),g=(returnNumber(parseFloat(c.get("discountAmount"))),c.get("endDate"),returnNumber(parseFloat($("#mrp_"+e).text())));if(!(f>0&&f<=100))return bootbox.alert({message:"Please add a valid discount percent."}),!1;var h=(g*f/100).toFixed(2);if(!(h>0))return bootbox.alert({message:"Invalid Discount Percent. Must be between 1 - 100 !"}),!1;$("#da_"+e).text(h)},onSuccess:function(a,b,c){if("success"===a.status)var d="Discount added successfully.";else if("failed"===a.status)var d="Error: "+a.errorcode+", "+a.errortext;else var d="Unknown Error.";bootbox.alert({message:d})}}),$("#stockAuditItems").length>0&&($("#itemnames").Tabledit({url:"/async/auditQty?locationCode="+$("#locationCode").val()+"&aC="+$("#aC").val(),editButton:!1,deleteButton:!1,hideIdentifier:!1,columns:{identifier:[1,"itemName"],editable:[[5,"phyQty"]]}}),$(".tabledit-input").on("keypress keydown keyup",function(a){13==a.keyCode&&a.preventDefault()}),$("#saLockSubmit").on("click",function(a){a.preventDefault(),bootbox.confirm("Are you sure. You want to Lock and Submit the Audit?",function(a){!0===a&&($("#stockAuditItems").append('<input type="hidden" name="op" value="saLockSubmit" />'),$(this).attr("disabled",!0),$("#stockAuditItems").submit())})}),$("#saPhyQty").on("click",function(a){a.preventDefault(),$("#stockAuditItems").append('<input type="hidden" name="op" value="saPhyQty" />'),$(this).html('<i class="fa fa-recycle"></i> Processing, Please Wait....'),$(this).attr("disabled",!0),$("#filterSubmit, #filterReset, #printAuditReport").attr("disabled",!0),$("#stockAuditItems").submit()}),$("#printAuditReport").on("click",function(a){a.preventDefault();var b=$("#aC").val();window.location.href="/stock-audit/print/"+b})),$("#owBarcode").length>0){$("#showServiceCode").on("click",function(a){a.preventDefault(),$("#serviceCode").show(),$("#owBarcode, #showServiceCode").hide(),$("#scanText").text("Service Code"),$("#showBarcode").show()}),$("#scanWindowMainButton").on("click",function(a){a.preventDefault(),$("#name").val().length>0?$("#scanWindowMainDiv, #scanWindowTr").show():bootbox.alert({message:"Customer name is mandatory :("})}),$("#showBarcode").on("click",function(a){a.preventDefault(),$("#owBarcode").show(),$("#serviceCode, #showBarcode").hide(),$("#scanText").text("Scan Barcode"),$("#showServiceCode").show()}),$("#serviceCode").on("keypress",function(a){if(13==a.keyCode){var b=$("#serviceCode").val(),d=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?sc="+b+"&locationCode="+d,{success:function(a){if("success"===a.status){if(Object.keys(a.response.bcDetails).length>0){var d="";jQuery.each(a.response.bcDetails,function(a,b){y[b.lotNo]=b,d=b.itemName});var e=a.response.bcDetails[0],f="[ "+b+" ] "+d;$("#lastScannedSaleItem").html(f),c(e,b,""),$("#serviceCode").val("")}else alert("Service code not found")}else alert("[ "+b+" ] Service code is not available."),$("#serviceCode").val("")},error:function(a){alert("Service code not found in the Selected Store or Location.")}}),a.preventDefault()}}),$("#customerType").on("change",function(a){if($("#tBodyowItems tr").length>0){var b=$(this).val();"b2c"===b?($("#siOtherInfoWindow").hide(),$("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").val("")):"b2b"===b?($("#siOtherInfoWindow").show(),$("#name").addClass("cnameAc")):($("#siOtherInfoWindow").hide(),$("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").val(""))}else $(this).val("b2c"),alert("Scan Barcode first.")}),$(document).on("click","#selectedDualLotNo",function(){$("#dualLotModal").modal("hide")
;var a=$("#billingRate").val(),b=$('[name="dualLotRadios"]:checked').val(),d=$("#owBarcode").val(),e=y[b],f="[ "+d+" ] "+e.itemName;""!==e.cno&&(f+='<span style="font-size: 12px;padding-left:5px;">CASE No: '+e.cno+"</span>"),$("#lastScannedSaleItem").html(f),c(e,d,a),$("#owBarcode").val("")}),$(document).on("click","#selectedDualLotNoCancel",function(){$("#dualLotModal").modal("hide"),$("#owBarcode").focus().val("")});var v=[];$('input[name="indentItems"]').each(function(a,b){v[a]=$(this).val()}),$("#owBarcode").on("keypress",function(a){var b=$("#billingRate").val();if(13==a.keyCode){var d=$(this).val(),e=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+d+"&locationCode="+e,{success:function(a){if("success"===a.status){var e=Object.keys(a.response.bcDetails).length;if(e>0){var f="";if(jQuery.each(a.response.bcDetails,function(a,b){y[b.lotNo]=b,f=b.itemName}),v.length>0&&!v.includes(f))return alert("Scanned item [ "+f+" ] does not exists in the Indent."),$("#owBarcode").val(""),!1;if(1===e){var g=a.response.bcDetails[0],h="[ "+d+" ] "+f;""!==g.cno&&(h+='<span style="font-size: 12px;padding-left:5px;">CASE No: '+g.cno+"</span>"),$("#lastScannedSaleItem").html(h),c(g,d,b),$("#owBarcode").val("")}else{$("#dualLotNosTitle").text(f);var i="<form>";i+='<div class="table-responsive">',i+='<table class="table table-striped table-hover font12" id="dualLotNosTable" style="margin-bottom:0px;">',i+="<thead><tr>",i+="<th>&nbsp;</th>",i+='<th style="text-align: center;">Lot No.</th>',i+='<th style="text-align: center;">Batch No.</th>',i+='<th style="text-align: center;">Cno/Box No.</th>',i+='<th style="text-align: center;">Available</th>',i+="</tr></thead>",i+="<tbody>",jQuery.each(a.response.bcDetails,function(a,b){var c=b.lotNo,d=b.batchNo,e=b.availableQty,f=b.cno;i+="<tr>",i+='<td style="vertical-align: middle; padding-left: 10px;" align="center">',i+='<input type="radio" name="dualLotRadios" value="'+c+'" style="visibility: visible; margin-top:0px;" />',i+="</td>",i+='<td style="vertical-align: middle">'+c+"</td>",i+='<td style="vertical-align: middle">'+d+"</td>",i+='<td style="vertical-align: middle">'+f+"</td>",i+='<td style="vertical-align: middle">'+e+"</td>",i+="</tr>"}),i+="</tbody>",i+="</table>",i+="</div>",$("#dualLots").html(i),$("#dualLotModal").modal("show")}}else alert("Barcode not found")}else alert("[ "+d+" ] Barcode is not available or out of stock."),$("#owBarcode").val("")},error:function(a){alert("Barcode not found in the Selected store.")}}),a.preventDefault()}}),$("#tBodyowItems").on("click","a.deleteOwItem",function(a){var b=$(this).attr("id");bootbox.confirm("Are you sure. You want to remove this item?",function(a){if(!0===a&&""!==b){var c=b.split("_"),d=$("#tr_"+c[1]+"_"+c[2]);if(d.length>0)if(d.remove(),$("#tBodyowItems tr").length>0){var e=1;$(".itemSlno").each(function(a,b){$(this).text(e),e++}),$(".saleItemQty").trigger("change")}else $("#totalItems, #grossAmount, #totDiscount, #taxableAmount, #gstAmount, #roundOff, #netPayBottom").text(""),$("#paymentMethodWindow, #customerWindow, #splitPaymentWindow, #saveWindow, #owItemsTable, #siOtherInfoWindow, #remarksWindow").hide(),$("#owBarcode").val(""),$("#lastScannedSaleItem").text("")}})})}if($("#gpBarcode").length>0){var w=[],x=[];jQuery.each(gpLotNos,function(a,b){w[b]=gpRates[a]}),jQuery.each(gpLotNos,function(a,b){x[b]=gpQtys[a]}),$(document).on("click","#selectedDualLotNo",function(){$("#dualLotModal").modal("hide");var a=$("#billingRate").val(),b=$('[name="dualLotRadios"]:checked').val(),d=$("#gpBarcode").val(),e=y[b],f="[ "+d+" ] "+e.itemName;""!==e.cno&&(f+='<span style="font-size: 12px;padding-left:5px;">CASE No: '+e.cno+"</span>"),$("#lastScannedSaleItem").html(f),c(e,d,a),$("#gpBarcode").val("")}),$(document).on("click","#selectedDualLotNoCancel",function(){$("#dualLotModal").modal("hide"),$("#gpBarcode").focus().val("")}),$("#gpBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val();$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?qtyZero=true&bc="+b+"&locationCode="+$("#locationCode").val(),{success:function(a){if("success"===a.status){var c=Object.keys(a.response.bcDetails).length;if(c>0){var e="";if(jQuery.each(a.response.bcDetails,function(a,b){e=b.itemName}),1===c){var f=a.response.bcDetails[0];if(void 0===w[f.lotNo])return alert("Invalid item (or) item does not exists in this Invoice !"),$("#gpBarcode").val(""),$("#genGp").attr("disabled",!0),!1;$("#genGp").attr("disabled",!1);var g="[ "+b+" ] "+e;""!==f.cno&&(g+='<span style="font-size: 12px;padding-left:5px;">CASE No: '+f.cno+"</span>"),$("#lastScannedSaleItem").html(g),$("#gpItemsTable, #gpInvoiceInfo, #gpActionButtons").show(),d(f,b),$("#gpBarcode").val("")}else{$("#dualLotNosTitle").text(e);var h="<form>";h+='<div class="table-responsive">',h+='<table class="table table-striped table-hover font12" id="dualLotNosTable" style="margin-bottom:0px;">',h+="<thead><tr>",h+="<th>&nbsp;</th>",h+='<th style="text-align: center;">Lot No.</th>',h+='<th style="text-align: center;">Batch No.</th>',h+='<th style="text-align: center;">Cno/Box No.</th>',h+='<th style="text-align: center;">Available</th>',h+="</tr></thead>",h+="<tbody>",jQuery.each(a.response.bcDetails,function(a,b){var c=b.lotNo,d=b.batchNo,e=b.availableQty,f=b.cno;h+="<tr>",h+='<td style="vertical-align: middle; padding-left: 10px;" align="center">',h+='<input type="radio" name="dualLotRadios" value="'+c+'" style="visibility: visible; margin-top:0px;" />',h+="</td>",h+='<td style="vertical-align: middle">'+c+"</td>",h+='<td style="vertical-align: middle">'+d+"</td>",h+='<td style="vertical-align: middle">'+f+"</td>",h+='<td style="vertical-align: middle">'+e+"</td>",h+="</tr>"}),h+="</tbody>",h+="</table>",h+="</div>",$("#dualLots").html(h),$("#dualLotModal").modal("show")}}else alert("Barcode not found")}else alert("[ "+b+" ] Barcode is not available or out of stock."),$("#gpBarcode").val("")},error:function(a){alert("Barcode not found in the Selected store.")}}),a.preventDefault()}}),$("#tBodyowItems").on("click","a.deleteOwItem",function(a){var b=$(this).attr("id");bootbox.confirm("Are you sure. You want to remove this item?",function(a){if(!0===a&&""!==b){var c=b.split("_"),d=$("#tr_"+c[1]+"_"+c[2]);if(d.length>0)if(d.remove(),$("#tBodyowItems tr").length>0){var e=1;$(".itemSlno").each(function(a,b){$(this).text(e),e++}),$(".saleItemQty").trigger("change")}else $("#totalItems, #grossAmount, #totDiscount, #taxableAmount, #gstAmount, #roundOff, #netPayBottom").text(""),$("#paymentMethodWindow, #customerWindow, #splitPaymentWindow, #saveWindow, #owItemsTable, #siOtherInfoWindow, #remarksWindow").hide(),$("#owBarcode").val(""),$("#lastScannedSaleItem").text("")}})})}if($("#addAdjEntryFrm").length>0){var y=[];$(document).on("click","#modalAdjustmentSelect",function(){$("#modalAdustment").modal("hide");var a=($("#billingRate").val(),$('[name="dualLotRadios"]:checked').val()),b=($("#adjBarcode").val(),y[a]);$("#itemName").val(b.itemName),$("#lotNo").val(b.lotNo),$("#adjQty").val(parseFloat(b.availableQty).toFixed(2)),$("#adjBarcode").val("")}),$(document).on("click","#modalAdjustmentCancel",function(){$("#modalAdustment").modal("hide"),$("#adjBarcode").focus().val("")}),$("#adjBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val(),c=$("#locationCode").val();if(""===c)return alert("Choose a Store first."),!1;var c=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+b+"&locationCode="+c+"&qtyZero=true",{success:function(a){if("success"===a.status){var b=Object.keys(a.response.bcDetails).length;if(b>0){var c="";if(jQuery.each(a.response.bcDetails,function(a,b){y[b.lotNo]=b,c=b.itemName}),1===b)z=a.response.bcDetails[0],$("#itemName").val(z.itemName),$("#lotNo").val(z.lotNo),$("#adjQty").val(parseFloat(z.availableQty).toFixed(2)),$("#adjBarcode").val(""),$("#adjBarcode").focus();else{$("#dualLotNosTitle").text(c);var d="<form>";d+='<div class="table-responsive">',d+='<table class="table table-striped table-hover font12" id="dualLotNosTable" style="margin-bottom:0px;">',d+="<thead><tr>",d+="<th>&nbsp;</th>",d+='<th style="text-align: center;">Lot No.</th>',d+='<th style="text-align: center;">Batch No.</th>',d+='<th style="text-align: center;">Cno/Box No.</th>',d+='<th style="text-align: center;">Available</th>',d+="</tr></thead>",d+="<tbody>",jQuery.each(a.response.bcDetails,function(a,b){var c=b.lotNo,e=b.batchNo,f=b.availableQty,g=b.cno;d+="<tr>",d+='<td style="vertical-align: middle; padding-left: 10px;" align="center">',d+='<input type="radio" name="dualLotRadios" value="'+c+'" style="visibility: visible; margin-top:0px;" />',d+="</td>",d+='<td style="vertical-align: middle">'+c+"</td>",d+='<td style="vertical-align: middle">'+e+"</td>",d+='<td style="vertical-align: middle">'+g+"</td>",d+='<td style="vertical-align: middle">'+f+"</td>",d+="</tr>"}),d+="</tbody>",d+="</table>",d+="</div>",$("#modalAdjustmentLotNos").html(d),$("#modalAdustment").modal("show")}}else alert("Barcode not found")}},error:function(a){alert("Barcode not found in the Selected store.")}})}a.preventDefault()}),$("#adjSave").on("click",function(a){$(this).attr("disabled",!0),$("#adjSave, #adjCancel").attr("disabled",!0),$("#addAdjEntryFrm").submit()})}if(jQuery(".delGatepass").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this Gatepass?",function(a){!0===a&&(window.location.href=b)})}),$("#galleryForm").length>0&&($("#imgBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val(),c=$("#locationCode").val();if(13!==b.length)return alert("Invalid barcode"),!1;if(""===c)return alert("Choose a Store first."),!1;var c=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+b+"&locationCode="+c,{success:function(a){if("success"===a.status){if(Object.keys(a.response.bcDetails).length>0){var b=a.response.bcDetails.itemName,c=a.response.bcDetails.lotNo,d=a.response.bcDetails.itemSku,e=a.response.bcDetails.itemSleeve,f=a.response.bcDetails.itemStylecode,g=a.response.bcDetails.itemColor;$("#itemName, #itemDescription").val(b),$("#lotNo").val(c),$("#itemSku").val(d),$("#itemStylecode").val(f),$("#itemColor").val(g),$("#itemSleeve").val(e),$("#imgBarcode").val(""),$("#imgBarcode").focus()}else alert("Barcode is not valid.")}else alert("Barcode not found.")},error:function(a){alert("Barcode not found in the Selected store.")}})}a.preventDefault()}),$("#imgUpload").on("click",function(a){$(this).attr("disabled",!0),$("#imgUpload, #imgUploadCancel").attr("disabled",!0),$("#galleryForm").submit()}),$(".showImage").on("click",function(){var a=$(this).find("img").attr("src"),b=$(this).attr("title");$("#imagePreview").attr("src",a),$("#modal-title").text(b),$("#imagemodal").modal("show")}),$("#inputType").on("change",function(a){"barcode"===$(this).val()?($("#barcodeInput").show(),$("#imgBarcode").focus()):$("#barcodeInput").hide()})),$(".transBarcode").length>0){var y=[],z=null,A="",B="",C="";$(document).on("click","#modalStockTransferSelect",function(){$("#modalStockTransfer").modal("hide");var a=$('[name="dualLotRadios"]:checked').val();z=y[a],e(z)}),$(document).on("click","#modalStockTransferCancel",function(){$("#dualLotModal").modal("hide"),$("#owBarcode").focus().val("")}),$(".transBarcode").on("blur",function(a){var b=$(this).val(),c=$(this).attr("id"),d=c.split("_")[1];""===b&&$("#iname_"+d).removeAttr("readonly")}),$(".transBarcode").on("keypress",function(a){if(13==a.keyCode){A=$(this).val(),B=$(this).attr("id"),C=parseInt(B.split("_")[1]);var b=$("#fromLocation").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+A+"&locationCode="+b,{success:function(a){if("success"===a.status){var b=Object.keys(a.response.bcDetails).length;if(b>0){var c="";if(jQuery.each(a.response.bcDetails,function(a,b){y[b.lotNo]=b,c=b.itemName}),1===b)z=a.response.bcDetails[0],e(z);else{$("#dualLotNosTitle").text(c);var d="<form>";d+='<div class="table-responsive">',d+='<table class="table table-striped table-hover font12" id="dualLotNosTable" style="margin-bottom:0px;">',d+="<thead><tr>",d+="<th>&nbsp;</th>",d+='<th style="text-align: center;">Lot No.</th>',d+='<th style="text-align: center;">Batch No.</th>',d+='<th style="text-align: center;">Cno/Box No.</th>',d+='<th style="text-align: center;">Available</th>',d+="</tr></thead>",d+="<tbody>",jQuery.each(a.response.bcDetails,function(a,b){var c=b.lotNo,e=b.batchNo,f=b.availableQty,g=b.cno;d+="<tr>",d+='<td style="vertical-align: middle; padding-left: 10px;" align="center">',d+='<input type="radio" name="dualLotRadios" value="'+c+'" style="visibility: visible; margin-top:0px;" />',d+="</td>",d+='<td style="vertical-align: middle">'+c+"</td>",d+='<td style="vertical-align: middle">'+e+"</td>",d+='<td style="vertical-align: middle">'+g+"</td>",d+='<td style="vertical-align: middle">'+f+"</td>",d+="</tr>"}),d+="</tbody>",d+="</table>",d+="</div>",$("#modalStockTransferLotNos").html(d),$("#modalStockTransfer").modal("show")}}else alert("Barcode not found")}},error:function(a){alert("Barcode not found in the Selected store.")}}),a.preventDefault()}})}if($("#stBarcode").length>0&&$("#stBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val(),c=$("#locationCode").val(),d=$("#transferCode").val(),e=0,f=parseFloat($("#trTransQty").text());e<f?jQuery.ajax("/async/getTrDetailsByCode?barcode="+b+"&locationCode="+c+"&transferCode="+d,{beforeSend:function(){$("#stBarcode").attr("disabled",!0),$("#stBarcode").val("Validating Barcode. Please wait...")},success:function(a){if("success"===a.status){e+=parseFloat(a.qty),f=parseFloat($("#trTransQty").text());var b=parseFloat(f-e);if(0==b)$("#stBarcode").attr("disabled",!0),bootbox.alert({message:"Scanning completed. Click on Save Button / స్కానింగ్ పూర్తి ఐనది. ఈ బదిలీ సేవ్ చేయటానికి అంగీకరణ బటన్ ప్రెస్ చెయ్యండి."}),$("#stBarcode").val(""),$("#trScannedQty").text(e.toFixed(2)),$("#trDiff").text(b.toFixed(2));else if(b<0){$("#stBarcode").attr("disabled",!0);alert("Scanned Qty. is more than actual Transfer Qty. and it is invalid. Please Rescan Again / స్కాన్ చేసిన సరుకు అసలు ట్రాన్స్ఫర్ చేయబడిన సరుకు కన్నా ఎక్కువగా ఉన్నది. ఇది చెల్లదు. మీరు మరల సరి చూసుకొని స్కాన్ చేయ గలరు."),$("#transferCode").length>0?window.location.href="/stock-transfer/validate/"+$("#transferCode").val():window.location.href="/stock-transfer/list"}else $("#trScannedQty").text(e.toFixed(2)),$("#trDiff").text(b.toFixed(2)),$("#stBarcode").attr("disabled",!1),$("#stBarcode").val(""),$("#stBarcode").focus()}else bootbox.alert({message:a.error}),$("#stBarcode").attr("disabled",!1),$("#stBarcode").val(""),$("#stBarcode").focus()},error:function(a){bootbox.alert({message:"Barcode not found in this transfer. Please check. / మీరు స్కాన్ చేసిన బార్ కోడ్ ఈ ట్రాన్స్ఫర్ ఆర్డర్  లో లేదు. దయచేసి సరి చూసుకోండి."}),$("#stBarcode").attr("disabled",!1),$("#stBarcode").val(""),$("#stBarcode").focus()}}):bootbox.alert({message:"Scanning completed already. Click on Save Button / స్కానింగ్ పూర్తి ఐనది. ఈ బదిలీ సేవ్ చేయటానికి అంగీకరణ బటన్ ప్రెస్ చెయ్యండి."}),a.preventDefault()}}),$("#indentBarcode").length>0){var y=[];$(document).on("click","#selectedDualLotNoIndentCancel",function(){$("#dualLotModalIndent").modal("hide"),$("#indentBarcode").focus().val("")}),$(document).on("click","#selectedDualLotNoIndent",function(){$("#dualLotModalIndent").modal("hide");var a=$("#billingRate").val(),b=$('[name="dualLotRadios"]:checked').val(),c=$("#indentBarcode").val(),d=y[b],e="[ "+c+" ] "+d.itemName;""!==d.cno&&(e+='<span style="font-size: 12px;padding-left:5px;">CASE No: '+d.cno+"</span>"),$("#lastScannedSaleItem").html(e),g(d,c,a),$("#indentBarcode").focus().val("")}),$(".messageContainer").length>0&&$(".messageContainer").fadeOut(5e3),$("#billingRate").length>0&&$("#billingRate").on("change",function(){window.location.href="/sales-indent/create?br="+$("#billingRate").val()}),$("#indentBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val(),c=$("#locationCode").val(),d=$("#billingRate").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+b+"&locationCode="+c+"&sl=true&ind=true",{success:function(a){if("success"===a.status){var c=Object.keys(a.response.bcDetails).length;if(c>0){var e="";if(jQuery.each(a.response.bcDetails,function(a,b){y[b.lotNo]=b,e=b.itemName}),1===c){var f=a.response.bcDetails[0],h="[ "+b+" ] "+e;""!==f.cno&&(h+='<span style="font-size: 12px;padding-left:5px;">CASE No: '+f.cno+"</span>"),$("#lastScannedSaleItem").html(h),g(f,b,d),$("#indentBarcode").val("")}else{$("#dualLotNosTitleIndent").text(e);var i="<form>";i+='<div class="table-responsive">',i+='<table class="table table-striped table-hover font12" id="dualLotNosTable" style="margin-bottom:0px;">',i+="<thead><tr>",i+="<th>&nbsp;</th>",i+='<th style="text-align: center;">Lot No.</th>',i+='<th style="text-align: center;">Batch No.</th>',i+='<th style="text-align: center;">Cno/Box No.</th>',i+='<th style="text-align: center;">Available</th>',i+="</tr></thead>",i+="<tbody>",jQuery.each(a.response.bcDetails,function(a,b){var c=b.lotNo,d=b.batchNo,e=b.availableQty,f=b.cno;i+="<tr>",i+='<td style="vertical-align: middle; padding-left: 10px;" align="center">',i+='<input type="radio" name="dualLotRadios" value="'+c+'" style="visibility: visible; margin-top:0px;" />',i+="</td>",i+='<td style="vertical-align: middle">'+c+"</td>",i+='<td style="vertical-align: middle">'+d+"</td>",i+='<td style="vertical-align: middle">'+f+"</td>",i+='<td style="vertical-align: middle">'+e+"</td>",i+="</tr>"}),i+="</tbody>",i+="</table>",i+="</div>",$("#dualLotsIndent").html(i),$("#dualLotModalIndent").modal("show")}}else alert("Barcode not found")}else{var j=a.reason;alert("[ "+b+" ] "+j),$("#indentBarcode").focus(),$("#indentBarcode").val("")}},error:function(a){alert("An error occurred while fetching Barcode")}}),a.preventDefault()}}),$("#tBodyowItems").on("click","a.deleteOwItem",function(a){var b=$(this).attr("id");bootbox.confirm("Are you sure. You want to remove this item?",function(a){if(!0===a&&""!==b){var c=b.split("_"),d=$("#tr_"+c[1]+"_"+c[2]);if(d.length>0)if(d.remove(),$("#tBodyowItems tr").length>0){var e=1;$(".itemSlno").each(function(a,b){$(this).text(e),e++}),f()}else $("#totalItems, #grossAmount, #totDiscount, #taxableAmount, #gstAmount, #roundOff, #netPayBottom").text(""),$("#paymentMethodWindow, #customerWindow, #splitPaymentWindow, #saveWindow, #owItemsTable").hide(),$("#owBarcode").val(""),$("#indentScannedQty, #lastScannedSaleItem").text("")}})})}if($("#salesIndentMobileV").length>0){var y=[];$("#mobileIndentItem").on("click",function(a){a.preventDefault();var b=jQuery("#itemName").val(),c=jQuery("<option></option>").attr("value","").text("Choose");if(""!==b){var d={itemName:b};jQuery.ajax("/async/getItemBatchesByCode",{data:d,method:"POST",success:function(a){if("success"===a.status){var b=Object.keys(a).length,d=jQuery("#lotNo");b>0&&(d.empty().append(c),jQuery.each(a.response.bcDetails,function(a,b){y[b.lotNo]=b,jQuery(d).append(jQuery("<option></option>").attr("value",b.lotNo).text(b.mOq+" [ Available: "+b.availableQty+" ]"))}),$(".itemOtherInfo, .formButtons").show())}else alert("Item not available.")},error:function(a){alert("An error occurred while fetching Available Qty.")}})}else 0===parseInt(b.length)&&alert("Item name required.")}),$(".indentOrderQty").on("blur",function(a){var b=jQuery("#lotNo").val(),c=returnNumber(parseFloat($("#orderQty").val()));if(b in y&&c>0){var d=returnNumber(parseFloat(y[b].availableQty)),e=returnNumber(parseFloat(y[b].mOq)),f=returnNumber(parseFloat(y[b].mrp));if((c=returnNumber(parseFloat(c*e).toFixed(2)))>d)return alert("Order Qty. must be less than or equal to available Qty."),$(this).val(""),$(this).focus(),!1;$("#mrp").val(f),$("#orderQty").val(c)}})}if($(".cancelButton").on("click",function(a){a.preventDefault(),$(this).attr("disabled",!0),$(".cancelOp").attr("disabled",!0);var b=$(this).attr("id");if("stoCancel"===b)window.location.href="/stock-transfer/choose-location";else if("inwBulkUploadCancel"===b)window.location.href="/inward-entry/bulk-upload";else if("seWithBarcode"===b)window.location.href="/sales/entry-with-barcode";else if("seWoBarcode"===b)window.location.href="/sales/entry";else if("scombos"===b)window.location.href="/sales-entry/combos";else if("ieWithBarcode"===b)window.location.href="/sales-indent/create";else if("uploadCustomers"===b)window.location.href="/upload-debtors";else if("uploadSuppliers"===b)window.location.href="/upload-creditors";else if("validateStButton"===b)window.location.href="/stock-transfer/register";else if("shippingPage"===b)window.location.href="/sales/list";else if("stransfer"===b)window.location.href="/stock-transfer/register";else if("comboCancel"===b)window.location.href="/sales-combo/add";else if("adjCancel"===b)window.location.href="/inventory/stock-adjustment";else if("imgUploadCancel"===b)window.location.href="/gallery/create";else if("imgUpdateCancel"===b){var c=$("#gc").val(),d=$("#lc").val();window.location.href="/gallery/update/"+d+"/"+c}else"catalogAddCancel"===b?window.location.href="/catalog/create":"catalogUpdateCancel"===b?window.location.href="/catalog/list":"manCreditNoteCancel"===b?window.location.href="/fin/credit-note/create":"manDebitNoteCancel"===b?window.location.href="/fin/debit-note/create":"arIndentStatus"===b?window.location.href="/sales-indents/list":"bulkUpdateSellingPrice"===b?window.location.href="/inventory/change-selling-price":"leadCreate"===b?window.location.href="/lead/create":"leadUpdate"===b?window.location.href="/leads/list":"leadImport"===b?window.location.href="/lead/import":"taskSave"===b?window.location.href="/task/create":"appointmentSave"===b?window.location.href="/appointment/create":"appointmentUpdate"===b?window.location.href="/appointments/list":"genGpCancel"===b?window.location.href="/get-invoice-no":"ecomCatCancel"===b?window.location.href="/ecom/category/create":"ecomCreateAppCancel"===b&&(window.location.href="/ecom/app-content/create")}),jQuery(".delPcVoucher").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this Voucher?",function(a){!0===a&&(window.location.href=b)})}),$(".delAdjEntry").length>0&&jQuery(".delAdjEntry").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this adjustment entry?",function(a){!0===a&&(window.location.href=b)})}),$(".delStransfer").length>0&&jQuery(".delStransfer").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this Stock transfer?",function(a){!0===a&&(window.location.href=b)})}),$(".delCatalog").length>0&&jQuery(".delCatalog").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to delete this Catalog?",function(a){!0===a&&(window.location.href=b)})}),$(".delGallery").length>0&&jQuery(".delGallery").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to delete this Gallery?",function(a){!0===a&&(window.location.href=b)})}),$(".delEcomSubcat").length>0&&jQuery(".delEcomSubcat").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to delete this Category?",function(a){!0===a&&(window.location.href=b)})}),$(".delEcomContent").length>0&&jQuery(".delEcomContent").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to delete this Content?",function(a){!0===a&&(window.location.href=b)})}),$(".delCNote").length>0&&jQuery(".delCNote").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to delete this Credit Note?",function(a){!0===a&&(window.location.href=b)})}),$(".delDNote").length>0&&jQuery(".delDNote").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to delete this Debit note?",function(a){!0===a&&(window.location.href=b)})}),$(".taskDelete").length>0&&jQuery(".taskDelete").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to delete this Task?",function(a){!0===a&&(window.location.href=b)})}),$(".appointmentDelete").length>0&&jQuery(".appointmentDelete").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to delete this Appointment?",function(a){!0===a&&(window.location.href=b)})}),$(".leadDelete").length>0&&jQuery(".leadDelete").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to delete this Lead?",function(a){!0===a&&(window.location.href=b)})}),$(".addItemToCatalog").length>0&&$(".addItemToCatalog").on("click",function(a){a.preventDefault();var b=$(this).attr("href");if(!(b.length>0))return!1;var c=b.split("/");jQuery.ajax("/async-catalogitem",{data:{lc:c[0],cc:c[1],ic:c[2]},method:"POST",success:function(a){"success"===a.status?(alert("Item added to Catalog successfully :)"),window.location.reload(!0)):"failed"===a.status&&alert(a.reason)},error:function(a){alert("An error occurred while add Item to Catalog :(")}})}),$(".removeItemFromCatalog").length>0&&$(".removeItemFromCatalog").on("click",function(a){a.preventDefault();var b=$(this).attr("href");if(!(b.length>0))return!1;jQuery.ajax("/async-catalogitem-remove",{data:{ic:b},method:"POST",success:function(a){"success"===a.status?(alert("Item removed from Catalog successfully :)"),window.location.reload(!0)):"failed"===a.status&&alert(a.reason)},error:function(a){alert("An error occurred while removing item from Catalog :(")}})}),$(".delDiscount").length>0&&jQuery(".delDiscount").on("click",function(a){a.preventDefault();var b=jQuery(this).attr("href");bootbox.confirm("Are you sure. You want to remove this Discount entry?",function(a){!0===a&&(window.location.href=b)})}),$("#searchPurchaseBills").length>0&&$("#searchBy").on("change",function(a){"itemname"===$(this).val()?($("#svProducts").show(),$("#svAll").hide()):($("#svProducts").hide(),$("#svAll").show()),$("#searchValue, #searchValueP").val("")}),$("#stockOutForm").length>0){var y=[];$("#transferSubmitBtn").on("click",function(a){$(this).attr("disabled",!0),$("#stransfer").attr("disabled",!0),$("#stockOutForm").submit()}),jQuery(".saleItem").on("blur",function(a){var b=jQuery(this).val(),c=jQuery(this).attr("index"),d=$("#lotNo_"+c),e=jQuery("<option></option>").attr("value","").text("Choose");if(""!==b){var f=$("#fromLocation").val(),g={itemname:b,locationCode:f};jQuery.ajax("/async/getAvailableQty",{data:g,method:"POST",success:function(a){if("success"===a.status){Object.keys(a).length>0?(jQuery(d).empty().append(e),jQuery.each(a.response,function(a,b){var c=b.cno,e=b.lotNo;""!==c&&(e+=" [ CASE: "+c+" ]"),y[b.lotNo]=b,jQuery(d).append(jQuery("<option></option>").attr("value",b.lotNo).text(e))})):jQuery(uppElement).text("")}},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}else 0===parseInt(b.length)&&(jQuery(d).empty().append(e),jQuery("#qtyava_"+c).val(""),jQuery("#mrp_"+c).val(""),jQuery("#itemType_"+c).val(""),jQuery("#saItemTax_"+c+' option[value=""]').attr("selected","selected"),jQuery("#qty_"+c).val(""))}),jQuery(".lotNo").on("change",function(a){var b=(itemRate=itemType="",jQuery(this).attr("index")),c=jQuery(this).val(),d=(jQuery("#qtyava_"+b),jQuery("#mrp_"+b),jQuery("#itemType_"+b),jQuery("#iname_"+b).val());if(""!==c){var e="",f=!1;if(jQuery(".lotNo").each(function(a,d){(e=$(this).val())===c&&parseInt(b)!==parseInt(a)&&(f=!0)}),f)return $("#lotNo_"+b).val(""),jQuery("#qtyava_"+b).val(""),jQuery("#qty_"+b).val(""),jQuery("#mrp_"+b).val(""),jQuery("#iname_"+b).val(""),jQuery("#barcode_"+b).val(""),bootbox.alert({message:"This Lot No. is already selected for `"+d+"`. A Lot No. must be unique and selected only once in the bill against the same item."}),!1;Object.keys(y[c]).length>0&&(jQuery("#qtyava_"+b).val(y[c].closingQty),jQuery("#qty_"+b).val(y[c].mOq),jQuery("#mrp_"+b).val(y[c].mrp),jQuery("#itemType_"+b).val(y[c].itemType),jQuery("#saItemTax_"+b+' option[value="'+y[c].taxPercent+'"]').attr("selected","selected"),h(b))}}),jQuery(".saleItemQty").on("blur",function(){var a=parseInt($(this).val()),b=jQuery(this).attr("index"),c=$("#lotNo_"+b),d=$("#qtyava_"+b).val(),e=jQuery("<option></option>").attr("value","").text("Choose");a>0&&parseFloat(a)<=parseFloat(d)?h(b):(bootbox.alert({message:"Transfer Qty. is more than Available Qty."}),jQuery(c).empty().append(e),jQuery("#qtyava_"+b).val(""),jQuery("#mrp_"+b).val(""),jQuery("#itemType_"+b).val(""),jQuery("#saItemTax_"+b+' option[value=""]').attr("selected","selected"),jQuery("#qty_"+b).val(""),jQuery("#qtyava_"+b).val(""),jQuery("#iname_"+b).val(""),jQuery("#grossAmount_"+b).text(""),h(b))})}if(jQuery(".inameAc").length>0&&$(".inameAc").autocomplete("/async/itemsAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,extraParams:{locationCode:function(){return $("#locationCode").length>0?$("#locationCode").val():$("#fromLocation").length>0?$("#fromLocation").val():""}},max:0}),jQuery(".catalogAc").length>0&&$(".catalogAc").autocomplete("/async/catalogAc",{width:342,cacheLength:0,selectFirst:!1,minChars:2,max:0}),jQuery(".catalogItemAc").length>0&&$(".catalogItemAc").autocomplete("/async/catalogItemAc",{width:342,cacheLength:0,selectFirst:!1,minChars:2,max:0}),jQuery(".brandAc").length>0&&$(".brandAc").autocomplete("/async/brandAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,extraParams:{locationCode:function(){return $("#locationCode").length>0?$("#locationCode").val():""}},max:0}),jQuery(".catAc").length>0&&$(".catAc").autocomplete("/async/catAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,extraParams:{locationCode:function(){return $("#locationCode").length>0?$("#locationCode").val():""}},max:0}),jQuery(".uomAc").length>0&&$(".uomAc").autocomplete("/async/uomAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,extraParams:{locationCode:function(){return $("#locationCode").length>0?$("#locationCode").val():""}},max:0}),jQuery(".cnameAc").length>0&&$(".cnameAc").autocomplete("/async/custAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,max:0}),jQuery(".suppnameAc").length>0&&$(".suppnameAc").autocomplete("/async/suppAc",{width:300,cacheLength:0,selectFirst:!1,minChars:1,max:0}),$("#customerForm").length>0&&$("#customerType").on("change",function(){"b2b"===$(this).val()?($("#bioContainer").hide(),$("#age").val(0),$("#ageCategory").val("years"),$("#gender").val("")):$("#bioContainer").show()}),$("#editPOAfterGRN").length>0&&$("#grnDelete").on("click",function(a){a.preventDefault(),bootbox.confirm("Are you sure. You want to delete and re-create GRN for this PO?",function(a){!0===a&&($(this).attr("disabled",!0),$("#editPOAfterGRN").submit())})}),$("#grnEntryForm").length>0&&jQuery("#grnCancel").on("click",function(a){if(1!=confirm("Are you sure. You want to close this page?"))return!1;window.location.href="/grn/list",a.preventDefault()}),$("#delInvoiceForm").length>0&&jQuery("#invoiceDelete").on("click",function(a){a.preventDefault(),bootbox.confirm("Are you sure. You want to delete this Invoice?",function(a){!0===a&&($(this).attr("disabled",!0),$("#delInvoiceForm").submit())})}),$("#inwardEntryForm").length>0&&(jQuery(".inwRcvdQty, .inwFreeQty, .inwItemRate, .inwItemDiscount").on("blur",function(a){var b=$(this).attr("id").split("_"),c=b[1];k(c);var d=$("#brandName_"+c).val(),e=$("#categoryName_"+c).val(),f=$("#uom_"+c).val(),g=($("#barcode_"+c).val(),$("#hsnSacCode"+c).val());if(""===d||""===e||""===f||""===g){var h=$("#itemName_"+c).val();jQuery.ajax("/async/itd?pn="+h+"&locationCode="+$("#locationCode").val(),{method:"GET",success:function(a){
"success"===a.status&&($("#brandName_"+c).val(a.response.mfgName),$("#categoryName_"+c).val(a.response.catName),$("#uom_"+c).val(a.response.uom),$("#hsnSacCode_"+c).val(a.response.hsnSacCode),$("#barcode_"+c).val(a.response.barcode))},error:function(a){alert("An error occurred while fetching Item Information.")}})}}),jQuery("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").on("blur",function(a){var b=returnNumber(parseFloat($("#packingCharges").val())),c=returnNumber(parseFloat($("#shippingCharges").val())),d=returnNumber(parseFloat($("#insuranceCharges").val())),e=returnNumber(parseFloat($("#otherCharges").val())),f=totalTaxAmount=finalAmount=0,g=roundedNetPay=0;jQuery(".inwItemAmount").each(function(a,b){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(f+=iTotal)}),jQuery(".inwItemTaxAmount").each(function(a,b){0===jQuery(this).val().length?iTotal=0:iTotal=parseFloat(returnNumber(jQuery(this).val())),iTotal>0&&(totalTaxAmount+=iTotal)}),g=parseFloat(f+totalTaxAmount)+parseFloat(b)+parseFloat(c)+parseFloat(d)+parseFloat(e),roundedNetPay=Math.round(g),finalAmount=g-parseFloat(roundedNetPay.toFixed(2)),$("#inwItemsTotal").text(f.toFixed(2)),$("#inwItemTaxAmount").text(totalTaxAmount.toFixed(2)),$("#roundOff").text(finalAmount.toFixed(2)),$("#inwNetPay").text(roundedNetPay)}),jQuery(".inwItemTax").on("change",function(){var a=$(this).attr("id").split("_"),b=a[1];$("#inwItemTaxAmt_"+b).attr("data-rate",parseFloat($(this).val()).toFixed(2)),k(b)}),jQuery("#supplierID").on("change",function(a){var b=$(this).val();""===b?$("#supplierState, #supplierGSTNo, #supplyType").val(""):jQuery.ajax("/async/get-supplier-details?c="+b,{method:"GET",success:function(a){if("success"===a.status){var b=a.response.supplierDetails,c=$("#cs").val();$("#supplierState").val(b.stateCode),$("#supplierGSTNo").val(b.tinNo),c==b.stateCode?$("#supplyType").val("intra"):$("#supplyType").val("inter")}},error:function(a){alert("An error occurred while fetching Supplier Information.")}})}),jQuery("#inwCancel").on("click",function(a){if(1!=confirm("Are you sure. You want to close this page?"))return!1;window.location.href="/inward-entry/list",a.preventDefault()})),$("#outwardEntryForm").length>0){var y=[];$("#customerType").on("change",function(a){var b=$(this).val();"b2c"===b?($("#siOtherInfoWindow").hide(),$("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").val("")):"b2b"===b?($("#siOtherInfoWindow").show(),$("#name").addClass("cnameAc")):($("#siOtherInfoWindow").hide(),$("#packingCharges, #shippingCharges, #insuranceCharges, #otherCharges").val(""))}),$("#SaveInvoice").on("click",function(a){a.preventDefault(),$(this).attr("disabled",!0),$(".cancelButton").attr("disabled",!0),$("#outwardEntryForm").submit()}),$("#saPaymentMethod").on("change",function(){var a=parseInt($(this).val());1===a?($("#containerCardNo, #containerAuthCode").show(),$("#containerWalletName, #containerWalletRef").hide()):3===a?($("#containerCrDays").show(),$("#containerCardNo, #containerAuthCode, #containerWalletName, #containerWalletRef").hide()):4===a?($("#containerWalletName, #containerWalletRef").show(),$("#containerCardNo, #containerAuthCode, #containerCrDays").hide()):$("#containerCardNo, #containerAuthCode, #containerCrDays, #containerWalletName, #containerWalletRef").hide(),2===a?($("#splitPaymentWindow").show(),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentCn, #cnNo, #splitPaymentWallet").attr("disabled",!1),$("#containerCardNo, #containerAuthCode, #containerWalletName, #containerWalletRef").show(),$("#containerCrDays").hide()):($("#splitPaymentCash, #splitPaymentCard, #splitPaymentCn, #cnNo, #splitPaymentWallet").val(""),$("#splitPaymentCash, #splitPaymentCard, #splitPaymentCn, #cnNo, #splitPaymentWallet").attr("disabled",!0),$("#splitPaymentWindow").hide())}),$("#saPromoCode").on("change",function(){""!==$(this).val()?($("#SaveInvoice").html("<i class='fa fa-lemon-o'></i> Apply Promo Code &amp; Continue"),$("#SaveInvoice").attr("class","btn btn-danger")):($("#SaveInvoice").html("<i class='fa fa-save'></i> Save &amp; Print"),$("#SaveInvoice").attr("class","btn btn-primary"))}),jQuery(".saleItem").on("blur",function(a){var b=jQuery(this).val(),c=jQuery(this).attr("index"),d=$("#lotNo_"+c),e=jQuery("<option></option>").attr("value","").text("Choose");$(d).children("option").length;if(""!==b){var f=$("#locationCode").val();if(""==f)return alert("Please choose Store location first."),$("#hdg-reports").scrollTop(),document.getElementById("locationCode").focus(),!1;var g={itemname:b,locationCode:f};jQuery.ajax("/async/getAvailableQty",{data:g,method:"POST",success:function(a){Object.keys(a).length>0?(jQuery(d).empty().append(e),jQuery.each(a.response,function(a,b){y[b.lotNo]=b,jQuery(d).append(jQuery("<option></option>").attr("value",b.lotNo).text(b.lotNo+" [ Packing: "+b.mOq+" ]"))})):jQuery(uppElement).text("")},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}}),jQuery(".lotNo").on("change",function(a){var b=(itemRate=itemType="",parseInt(jQuery(this).attr("index"))),c=jQuery(this).val(),d=(jQuery("#qtyava_"+b),jQuery("#mrp_"+b),jQuery("#itemType_"+b),$("#billingRate").val());if(""!==c&&Object.keys(y[c]).length>0){var e="";if(jQuery(".lotNo").each(function(a,d){if((e=$(this).val())===c&&b!==a)return $("#lotNo_"+b).val(""),bootbox.alert({message:"This Lot No. is already selected.  A Lot No. must be unique and selected only once in the bill against the same item."}),!1}),jQuery("#qtyava_"+b).val(y[c].closingQty),jQuery("#qty_"+b).val(y[c].mOq),"wholesale"===d?jQuery("#mrp_"+b).val(y[c].wholesalePrice):"online"===d?jQuery("#mrp_"+b).val(y[c].onlinePrice):"ex"===d?jQuery("#mrp_"+b).val(y[c].mrpDn):jQuery("#mrp_"+b).val(y[c].mrp),jQuery("#itemType_"+b).val(y[c].itemType),jQuery("#saItemTax_"+b+' option[value="'+y[c].taxPercent+'"]').attr("selected","selected"),returnNumber(parseFloat(y[c].discountAmount))>0)var f=returnNumber(parseFloat(y[c].discountAmount))*returnNumber(parseFloat(y[c].mOq));else var f=0;$("#discount_"+b).val(f.toFixed(2)),m(b)}}),$("#outwardEntryForm").on("blur",".saDiscount",function(a){m(jQuery(this).attr("index"))}),$("#outwardEntryForm").on("change",".taxCalcOption",function(){o()}),$("#outwardEntryForm").on("change",".saleItemQty",function(){var a=jQuery(this).attr("index"),b=returnNumber(parseFloat($("#qtyava_"+a).val())),c=$("#itemType_"+a).val(),d=returnNumber(parseFloat($(this).val()));if(0===$("#in").length&&d>b&&"p"===c)return alert("Qty. not available"),$(this).val(""),$(this).focus(),!1;if(void 0!==y&&y.length>0){var d=$(this).val(),e=$("#lotNo_"+a).val();if(returnNumber(parseFloat(y[e].discountAmount))>0)var f=returnNumber(parseFloat(y[e].discountAmount))*returnNumber(parseFloat(d));else var f=0;$("#discount_"+a).val(f.toFixed(2))}m(a)}),$("#outwardEntryForm").on("change",".mrp",function(){m(jQuery(this).attr("index"))}),$("#refCode").on("blur",function(a){var b=returnNumber($(this).val());parseInt(b)>0?jQuery.ajax("/async/get-ref-details?refCode="+b,{success:function(a){if($("#refCodeStatus").show(),"success"===a.status){var b=a.response.memberDetails,c=b.memberName,d=b.mobileNo;$("#refMemberName").val(c),$("#refMemberMobile").val(d),$("#refCodeStatus").html('<b style="color:green;">Referral code is valid.</b>')}else $("#refCodeStatus").html('<b style="color:red;">Referral code is not valid.</b>'),$("#refMemberName").val(""),$("#refMemberMobile").val(""),$("#refCode").focus()},error:function(a){alert("Invalid referral code.")}}):($("#refCodeStatus").hide(),$("#refCodeStatus").html(""),$("#refMemberName").val(""),$("#refMemberMobile").val(""),$("#refCode").val(""))}),$("#shippingCharges, #insuranceCharges, #otherCharges").on("blur",function(a){o()})}if($("#manCreditNoteForm").length>0&&($("#manCreditNoteForm").on("change",".saleItemQty",function(){p(jQuery(this).attr("index"))}),$("#manCreditNoteForm").on("change",".mrp",function(){p(jQuery(this).attr("index"))}),$("#manCreditNoteForm").on("change",".saItemTax",function(){p(jQuery(this).attr("index"))}),$("#manCreditNoteForm").on("change","#taxCalcOption",function(){var a=(totalsGST=totalsItems=0,$(this).val());$("#manCreditNoteForm .saleItemQty").each(function(b){var c=b+1,d=returnNumber(parseFloat($("#qty_"+c).val())),e=returnNumber(parseFloat($("#mrp_"+c).val())),f=returnNumber(parseFloat($("#saItemTax_"+c).val()));if("i"===a)var g=Math.round(d*e,2),h=g,i=0;else var g=Math.round(d*e,2),i=Math.round(g*f/100,2),h=g+i;d>0&&e>0&&($("#taxable_"+c).text(g.toFixed(2)),$("#taxAmount_"+c).text(i.toFixed(2)),$("#totalAmount_"+c).text(h.toFixed(2)))}),q()}),$("#manCreditNoteForm").on("change",".mCreditNoteType",function(){if("wo"===jQuery(this).val()){for($("#mCnOptionalFields").hide(),$("#mCnItems").hide(),$("#cnValue").val(""),i=0;i<10;i++){var a=i+1;$("#iname_"+a).val(""),$("#qty_"+a).val(""),$("#mrp_"+a).val(""),$("#purchaseRate_"+a).val(""),$("#saItemTax_"+a).val(""),$("#taxable_"+a).text(""),$("#taxAmount_"+a).text(""),$("#totalAmount_"+a).text("")}$(".totalTaxable, .totalGST, .totalAmount").text("")}else $("#mCnOptionalFields").show(),$("#mCnItems").show()}),$("#manCreditNoteSubmit").on("click",function(a){$(this).attr("disabled",!0),$("#manCreditNoteCancel").attr("disabled",!0),$("#manCreditNoteForm").submit()})),$("#manDebitNoteForm").length>0){if($("#manDebitNoteForm").on("blur",".dnReturnQty",function(){r(jQuery(this).attr("index"))}),$("#manDebitNoteForm").on("blur",".purchaseRate",function(){r(jQuery(this).attr("index"))}),$("#manDebitNoteForm").on("change",".dnItemTax",function(){r(jQuery(this).attr("index"))}),$("#manDebitNoteForm").on("change","#taxCalcOption",function(){var a=(totalsGST=totalsItems=0,$(this).val());$("#manDebitNoteForm .dnReturnQty").each(function(b){var c=b,d=returnNumber(parseFloat($("#qty_"+c).val())),e=returnNumber(parseFloat($("#purchaseRate_"+c).val())),f=returnNumber(parseFloat($("#dnItemTax_"+c).val()));if("i"===a)var g=Math.round(d*e,2),h=g,i=0;else var g=Math.round(d*e,2),i=Math.round(g*f/100,2),h=g+i;d>0&&e>0&&($("#taxable_"+c).text(g.toFixed(2)),$("#taxAmount_"+c).text(i.toFixed(2)),$("#totalAmount_"+c).text(h.toFixed(2)))}),s()}),$("#manDebitNoteForm").on("change",".mDebitNoteType",function(){if("wo"===jQuery(this).val()){for($("#mDnOptionalFields").hide(),$("#mDnItems").hide(),$("#cnValue").val(""),i=0;i<15;i++){var a=i+1;$("#iname_"+a).val(""),$("#qty_"+a).val(""),$("#mrp_"+a).val(""),$("#purchaseRate_"+a).val(""),$("#saItemTax_"+a).val(""),$("#taxable_"+a).text(""),$("#taxAmount_"+a).text(""),$("#totalAmount_"+a).text("")}$(".totalTaxable, .totalGST, .totalAmount").text("")}else $("#mDnOptionalFields").show(),$("#mDnItems").show()}),$("#manDebitNoteSubmit").on("click",function(a){$(this).attr("disabled",!0),$("#manDebitNoteCancel").attr("disabled",!0),$("#manDebitNoteForm").submit()}),$(".manDnBarcode").length>0){var y=[],z=null,A="",B="",C="";$(document).on("click","#modalManDebitNoteCancel",function(){$("#modalManualDebitNote").modal("hide");var a=$('[name="dualLotRadios"]:checked').val();z=y[a],t(z)}),$(document).on("click","#modalManDebitNoteSelect",function(){$("#dualLotModal").modal("hide"),$("#owBarcode").focus().val("")}),$(".transBarcode").on("blur",function(a){var b=$(this).val(),c=$(this).attr("id"),d=c.split("_")[1];""===b&&$("#iname_"+d).removeAttr("readonly")}),$(".manDnBarcode").on("keypress",function(a){if(13==a.keyCode){A=$(this).val(),B=$(this).attr("id"),C=parseInt(B.split("_")[1]);var b=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+A+"&locationCode="+b,{success:function(a){if("success"===a.status){var b=Object.keys(a.response.bcDetails).length;if(b>0){var c="";if(jQuery.each(a.response.bcDetails,function(a,b){y[b.lotNo]=b,c=b.itemName}),1===b)z=a.response.bcDetails[0],t(z);else{$("#dualLotNosTitle").text(c);var d="<form>";d+='<div class="table-responsive">',d+='<table class="table table-striped table-hover font12" id="dualLotNosTable" style="margin-bottom:0px;">',d+="<thead><tr>",d+="<th>&nbsp;</th>",d+='<th style="text-align: center;">Lot No.</th>',d+='<th style="text-align: center;">Batch No.</th>',d+='<th style="text-align: center;">Cno/Box No.</th>',d+='<th style="text-align: center;">Available</th>',d+="</tr></thead>",d+="<tbody>",jQuery.each(a.response.bcDetails,function(a,b){var c=b.lotNo,e=b.batchNo,f=b.availableQty,g=b.cno;d+="<tr>",d+='<td style="vertical-align: middle; padding-left: 10px;" align="center">',d+='<input type="radio" name="dualLotRadios" value="'+c+'" style="visibility: visible; margin-top:0px;" />',d+="</td>",d+='<td style="vertical-align: middle">'+c+"</td>",d+='<td style="vertical-align: middle">'+e+"</td>",d+='<td style="vertical-align: middle">'+g+"</td>",d+='<td style="vertical-align: middle">'+f+"</td>",d+="</tr>"}),d+="</tbody>",d+="</table>",d+="</div>",$("#modalStockTransferLotNos").html(d),$("#modalStockTransfer").modal("show")}}else alert("Barcode not found")}else alert("Invalid Barcode / Barcode does not exists")},error:function(a){alert("Barcode not found in the Selected store.")}}),a.preventDefault()}})}$("#manDebitNoteForm").on("blur",".dnItem",function(){var a=jQuery(this).val(),b=jQuery(this).attr("index"),c=$("#lotNo_"+b),d=$("#barcode_"+b).val(),e=jQuery("<option></option>").attr("value","").text("Choose");if(a.length>0&&0===d.length){var f=$("#locationCode").val(),g={itemname:a,locationCode:f};jQuery.ajax("/async/getAvailableQty",{data:g,method:"POST",success:function(a){if("success"===a.status){Object.keys(a).length>0?(jQuery(c).empty().append(e),jQuery.each(a.response,function(a,b){var d=b.cno,e=b.lotNo;""!==d&&(e+=" [ CASE: "+d+" ]"),y[b.lotNo]=b,jQuery(c).append(jQuery("<option></option>").attr("value",b.lotNo).text(e))})):jQuery(uppElement).text("")}},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}else 0===parseInt(a.length)&&(jQuery(c).empty().append(e),jQuery("#qtyava_"+b).val(""),jQuery("#purchaseRate_"+b).val(""),jQuery("#dnItemTax_"+b+' option[value=""]').attr("selected","selected"),jQuery("#qty_"+b).val(""),r(b))}),$("#manDebitNoteForm").on("change",".lotNo",function(){var a=(itemRate=itemType="",jQuery(this).attr("index")),b=jQuery(this).val(),c=(jQuery("#qtyava_"+a),jQuery("#purchaseRate_"+a),jQuery("#iname_"+a).val());if(""!==b){var d="",e=!1;if(jQuery(".lotNo").each(function(c,f){(d=$(this).val())===b&&parseInt(a)!==parseInt(c)&&(e=!0)}),e)return $("#lotNo_"+a).val(""),jQuery("#qtyava_"+a).val(""),jQuery("#qty_"+a).val(""),jQuery("#purchaseRate_"+a).val(""),jQuery("#iname_"+a).val(""),jQuery("#barcode_"+a).val(""),bootbox.alert({message:"This Lot No. is already selected for `"+c+"`. A Lot No. must be unique and selected only once in the bill against the same item."}),!1;Object.keys(y[b]).length>0&&(jQuery("#qtyava_"+a).val(y[b].closingQty),jQuery("#qty_"+a).val(y[b].mOq),jQuery("#purchaseRate_"+a).val(y[b].mrp),jQuery("#dnItemTax_"+a+' option[value="'+y[b].taxPercent+'"]').attr("selected","selected"),r(a))}})}if($("#salesReturnWindow").length>0&&($("#srBarcode").length>0&&($("#srBarcode").focus(),$("#srBarcode").on("keypress",function(a){if(13==a.keyCode){var b=$(this).val(),c=$("#locationCode").val();if(13!==b.length)return alert("Invalid barcode"),!1;if(""===c)return alert("Choose a Store first."),!1;var c=$("#locationCode").val();jQuery.ajax("/async/getItemDetailsByCode?bc="+b+"&locationCode="+c+"&qtyZero=true",{success:function(a){if("success"===a.status){var b=Object.keys(a.response.bcDetails).length,c=moQ="";if(b>0){var d=(a.response.bcDetails.itemName,a.response.bcDetails.lotNo);if($("#salesReturnTable tr").each(function(){var a=$(this).find(".returnLotNo");a.text()===d&&(c=a.attr("id").split("_")[1])}),parseInt(c)>=0){var e=parseFloat(returnNumber($("#returnason_"+c).text())),f=parseFloat(returnNumber($("#sold_"+c).text())),g=parseFloat(returnNumber(f-e)).toFixed(2);$("#returnQty_"+c).val(g),$("#srBarcode").val(""),$(".returnQty").trigger("blur")}else alert("Barcode not found in this Invoice.")}else alert("Barcode not found")}},error:function(a){alert("Barcode not found in the Selected store.")}})}a.preventDefault()})),$(".returnQty").on("blur",function(a){var b=$(this).attr("id").split("_")[1],c=parseFloat(returnNumber($("#returnRate_"+b).text())),d=parseFloat(returnNumber($("#sold_"+b).text())),e=parseFloat(returnNumber($("#returnason_"+b).text())),f=parseFloat(returnNumber($(this).val()));if(f>0&&f>d-e)return alert("Return Qty. is greater than available Qty. for return."),$(this).val(""),$(this).focus(),!1;var g=parseFloat(returnNumber(c*f));$("#returnValue_"+b).text(g.toFixed(2)),u()})),$("#sendOtpBtn").length>0&&($("#sendOtpBtn").on("click",function(){sendOTP()}),$("#submit-fp").on("click",function(a){var b=$("#emailID").val(),c=$("#pass-fp").val(),d=$("#newpass-fp").val();if(""===b||""===c||""===d)return alert("Userid, OTP and New password fields are mandatory to Reset your password."),$("#emailID").focus(),!1;jQuery.ajax("/reset-password",{method:"POST",data:$("#forgotPassword").serialize(),success:function(a){!1===a.status?(alert(a.error),window.location.href="/forgot-password"):(alert("Password has been changed successfully."),window.location.href="/login")},error:function(a){alert("Unable to reset password. Please try again."),window.location.href="/forgot-password"}}),a.preventDefault()})),$("#uploadInventory").length>0&&$("#uploadInventory").on("click",function(a){if(!$("#fileName").val().length)return alert("Please choose a file to upload."),!1;$(this).attr("disabled",!0),$("#invRefresh").attr("disabled",!0),$("#reloadInfo").show(),$("#frmInventoryUpload").submit(),a.preventDefault()}),$("#dbContainer").length>0&&$("#daySales").length>0){jQuery.ajax("/async/day-sales",{method:"GET",success:function(a){if("success"===a.status){var b=a.response.daySales[0],c=parseFloat(b.cashSales),d=parseFloat(b.cardSales),e=parseFloat(b.splitSales),f=parseFloat(b.walletSales),g=parseFloat(b.creditSales),h=parseFloat(b.returnAmount),i=parseFloat(c+d+e+g+f)-h,j=parseFloat(b.cashReceipts),k=parseFloat(b.cashPayments),l=parseFloat(parseFloat(b.cashInHand)+parseFloat(b.cashReceipts)-parseFloat(b.cashPayments));$("#ds-cashsale").text(c.toFixed(2)),$("#ds-cardsale").text(d.toFixed(2)),$("#ds-walletsale").text(f.toFixed(2)),$("#ds-splitsale").text(e.toFixed(2)),$("#ds-creditsale").text(g.toFixed(2)),$("#ds-returns").text(h.toFixed(2)),$("#ds-netsale").text(i.toFixed(2)),$("#ds-cashinhand").text(l.toFixed(2)),$("#ds-cashpayments").text(k.toFixed(2)),$("#ds-cashreceipts").text(j.toFixed(2))}},error:function(a){alert("An error occurred while fetching Day Sales")}})}if($("#sfGraphReload").on("click",function(a){var b=$("#sgf-month").val(),c=$("#sgf-year").val();$("#saleMonth").val(b),$("#saleYear").val(c),monthWiseSales()}),$("#offerEntryForm").length>0&&($("#offerCancel").on("click",function(a){if(1!=confirm("Are you sure. You want to close this page?"))return!1;window.location.href="/promo-offers/list",a.preventDefault()}),$("#offerType").on("change",function(a){var b=$(this).val();$("#itemName, #discountOnProduct, #totalProducts, #freeProducts, #itemName, #discountOnProduct").val(""),"a"===b?($("#aContainer").show(),$("#bContainer").hide(),$("#cContainer").hide()):"b"===b?($("#aContainer").hide(),$("#bContainer").show(),$("#cContainer").hide()):"c"===b?($("#aContainer").hide(),$("#bContainer").hide(),$("#cContainer").show()):($("#aContainer").hide(),$("#bContainer").hide(),$("#cContainer").hide())})),($("#paymentVocForm").length>0||$("#receiptVocForm").length>0)&&$("#paymentMode").on("change",function(a){var b=$(this).val();"b"===b||"p"===b?$("#refInfo").show():"c"===b&&$("#refInfo").hide()}),$("#receiptVocForm").length>0){var D=[];$("#custBillNos").on("click",function(a){a.preventDefault();var b=jQuery("#partyName").val(),c=$("#custBillNo"),d=jQuery("<option></option>").attr("value","").text("Choose");$(c).children("option").length;if(""!==b){var e={custName:b};jQuery.ajax("/async/getBillNos",{data:e,method:"POST",success:function(a){if("success"===a.status){var b=Object.keys(a.response).length;parseInt(b)>0&&(jQuery(c).empty().append(d),jQuery.each(a.response,function(a,b){D[b.billNo]=b,jQuery(c).append(jQuery("<option></option>").attr("value",encodeHTML(b.billNo)).text(b.billNo+" { "+b.balAmount+" }"))}),$("#custBillNo").attr("disabled",!1))}else"failed"===a.status&&alert(billsNos.reason)},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}}),$("#custBillNo").on("change",function(a){var b=$(this).val();""!==b&&Object.keys(D[b]).length>0&&jQuery("#amount").val(D[b].balAmount)})}if($("#debitVocEntryForm").length>0){var D=[];$("#supplierCode").on("change",function(a){a.preventDefault();var b=$(this).val(),c=$("#suppBillNo"),d=jQuery("<option></option>").attr("value","").text("Choose");$(c).children("option").length;if(""!==b){var e={suppCode:b};jQuery.ajax("/async/getSuppBillNos",{data:e,method:"POST",success:function(a){if("success"===a.status){var b=Object.keys(a.response).length;parseInt(b)>0&&(jQuery(c).empty().append(d),jQuery.each(a.response,function(a,b){D[b.billNo]=b,jQuery(c).append(jQuery("<option></option>").attr("value",encodeHTML(b.billNo)).text(b.billNo+" { "+b.balAmount+" }"))}))}else"failed"===a.status&&alert(billsNos.reason)},error:function(a){alert("An error occurred while fetching Batch Nos.")}})}}),$("#suppBillNo").on("change",function(a){var b=$(this).val();""!==b&&Object.keys(D[b]).length>0&&jQuery("#amount").val(D[b].balAmount)})}}function sendOTP(a){if(!/^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+.)+([a-zA-Z0-9]{2,4})+$/.test($("#emailID").val()))return $("#emailID").focus(),alert("Please enter a valid username."),!1;jQuery.ajax("/send-otp",{method:"POST",data:$("#forgotPassword").serialize(),success:function(b){if(!1===b.status)return bootbox.alert({message:b.message}),!1;!0===b.status?($("#success-msg-fp").show(),$("#success-msg-fp").html(b.message),$("#pass-fp").attr("disabled",!1),$("#submit-fp").attr("disabled",!1),$("#newpass-fp").attr("disabled",!1),$("#sendOtpBtn").attr("disabled",!0),$("#resendOTPLink").show(),"resend"===a&&alert("OTP has been resent successfully. Please use latest code to reset your password.")):($("#error-msg-fp").show(),$("#error-msg-fp").html(b.message),"resend"===a&&alert("Unable to resend OTP."))},error:function(a){return $("#emailID").focus(),alert("An error occurred while processing your request."),!1}})}function printSalesBill(a){var b="/print-sales-bill?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400").print()}function printSalesBillCombo(a){var b="/print-sales-bill-combo?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400").print()}function printSalesBillSmall(a){var b="/print-sales-bill-small?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400").print()}function printSalesBillGST(a){var b="/print-sales-bill-gst?billNo="+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400").print()}function printGrn(a){var b="/print-grn/"+a;window.open(b,"_blank","scrollbars=yes,titlebar=yes,resizable=yes,width=400,height=400")}function printSalesReturnBill(a){var b="/print-sales-return-bill?returnCode="+a;window.open(b,"_blank","scrollbars=yes, titlebar=yes, resizable=yes, width=400, height=400")}function resetFilter(a){""!==a&&(window.location.href=a)}function monthWiseSales(){var a=$("#saleMonth").val(),b=$("#saleYear").val(),c=[],d=[],e=totSplitSales=totCardSales=totSales=totSalesReturns=totNetSales=0,f=totCreditSales=0;jQuery.ajax("/async/monthly-sales?saleMonth="+a+"&saleYear="+b,{method:"GET",success:function(a){"success"===a.status&&(jQuery.each(a.response.daywiseSales,function(a,b){var g=new Date(b.tranDate+"T12:00:30z"),h=parseInt(returnNumber(b.cardSales))+parseInt(returnNumber(b.cashSales))+parseInt(returnNumber(b.splitSales))+parseInt(returnNumber(b.creditSales))+parseInt(returnNumber(b.walletSales));c.push(g.getDate()),d.push(h),e+=parseFloat(returnNumber(b.cashSales)),totCardSales+=parseFloat(returnNumber(b.cardSales)),totSplitSales+=parseFloat(returnNumber(b.splitSales)),totCreditSales+=parseFloat(returnNumber(b.creditSales)),f+=parseFloat(returnNumber(b.walletSales)),totSalesReturns+=parseFloat(returnNumber(b.returnAmount)),totSales+=parseFloat(returnNumber(b.cashSales))+returnNumber(parseFloat(b.cardSales))+returnNumber(parseFloat(b.splitSales))+returnNumber(parseFloat(b.creditSales))+returnNumber(parseFloat(b.walletSales))}),totNetSales=parseFloat(returnNumber(totSales))-parseFloat(returnNumber(totSalesReturns)),$("#cs-cashsale").text(e.toFixed(2)),$("#cs-cardsale").text(totCardSales.toFixed(2)),$("#cs-walletsale").text(f.toFixed(2)),$("#cs-splitsale").text(totSplitSales.toFixed(2)),$("#cs-creditsale").text(totCreditSales.toFixed(2)),$("#cs-totals").text(totSales.toFixed(2)),$("#cs-sreturn").text(totSalesReturns.toFixed(2)),$("#cs-netsale").text(totNetSales.toFixed(2))),$("#salesGraph").empty(),$("#salesGraph").jqplot([d,c],{title:"",seriesDefaults:{showMarker:!0,renderer:$.jqplot.BarRenderer,pointLabels:{show:!0},rendererOptions:{varyBarColor:!0},showLine:!0},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:[]},yaxis:{showTicks:!0}},grid:{drawBorder:!1,shadow:!1}})},error:function(a){alert("An error occurred while loading Monthwise Sales")}})}function monthWiseSalesReturns(){var a=$("#saleMonth").val(),b=$("#saleYear").val(),c=[],d=[];jQuery.ajax("/async/monthly-sales?saleMonth="+a+"&saleYear="+b,{method:"GET",success:function(a){"success"===a.status&&jQuery.each(a.response.daywiseSales,function(a,b){var e=new Date(b.tranDate+"T12:00:30z");c.push(e.getDate()),d.push(parseInt(b.returnamount))}),$("#sreturnsGraph").jqplot([c,d],{title:"",seriesDefaults:{showMarker:!0,renderer:$.jqplot.BarRenderer,rendererOptions:{varyBarColor:!0}},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,tickOptions:{showGridline:!0}}},grid:{drawBorder:!0,shadow:!1}})},error:function(a){alert("An error occurred while loading Monthwise Sales Returns")}})}function returnNumber(a){return isNaN(a)||0===a.length?0:a}function getGeoLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(successGeoLocation,failedGeoLocation):alert("Geolocation is not supported by this browser. Please update your Browser.")}function successGeoLocation(a){$("#gLat").val(a.coords.latitude),$("#gLng").val(a.coords.longitude),$("#gAcc").val(a.coords.accuracy)}function failedGeoLocation(a){1==a.code&&alert("You must Allow Location Access to proceed further.")}function encodeHTML(a){return a.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;").split("'").join("&#39;")}$(window).load(function(){var a=window.location.pathname;if($(".se-pre-con").fadeOut("slow"),setTimeout(function(){if($("#bQ").length>0){(new Fingerprint2).get(function(a){$("#__bq_pub").val(a),$.post("/id__mapper",$("#bQ").serialize())})}},100),$("#qbMain").length>0&&"/forgot-password"!==a)var b=setInterval(function(){$.ajax({type:"POST",url:"/__id__lo",success:function(a){"expired"===a&&(clearInterval(b),window.location.href="/force-logout")}})},1e4)}),function(a){if(void 0===a)throw new Error("window is undefined");a.onhashchange=function(){"!"!==a.location.hash&&(a.location.hash="!")}}(window),jQuery(document).ready(function(){initializeJS(),$("#dbContainer").length>0&&($("#monthwiseSales").length>0||$("#salesDayGraph").length>0)&&monthWiseSales()});